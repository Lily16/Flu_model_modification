---
title: "Implementation of school closure in the epidemiological model"
author: "Aurelie Nerin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Implementation of school closure}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r,include=F}

library(fluEvidenceSynthesis)
library(odin)
library(plyr)
library(pander)
library(ggplot2)
load(file="polymod_UK_4_Aurelie.R")
load(file="polymod_UK_hol_4_Aurelie.R")

```

#  Introduction 

Young people have more contacts than adults especially in places like school ideal for transmission of diseases like influenza. We studied in the vignette `First solution school closure` the benefits of closing school during an epidemy. In this vignette, we will add the possibilty of school closure in the epidemiological model and realize the simulation on an example for seasonal flu and the pandemic flu. 

#  Parameters of the model 

## Division of the population in seven age groups 

In the United Kingdom, the education system is divided into 4 schools : 

-	Pre-school (for children between 3 and 5 years old)
-	Primary school (for children between 6 and 12 years old)
-	Secondary school (for children between 13 and 16 years old) 
-	High school (for children between 17 and 18 years old)

That's why we create the seven following age groups to see the effects of school closures: <0-2>, <3-5>, <6-12>, <13-16>, <17-18>, <19-64>, > 65.

We then divide the age groups into 2 risks groups: low risk and high risk people. 

```{r,cache=T}

# Population divided by age (0 years old, 1 years old, etc.)
data(demography) 

#Creation of seven age groups to test the efficiency of school closure : <0-2>, <3-5>, <6-12>, <13-16>, <17-18>, <19-64>, > 65

age_groups_school_closure <- stratify_by_age(demography,limits = c(3,6,13,17,19,65))
pander(age_groups_school_closure)

#Creation of two risk groups (low risk and high risk)
population <- stratify_by_risk( age_groups_school_closure, matrix(c(0.01,0.01,0.01,0.01,0.01,0.01,0.4),nrow=1))

```

## Initial infected

The number of people infected at the beginning of the season, again separated into age groups and risk groups.

```{r}

ag <- c(1000,1000,1000,1000,1000,1000,1000)
initial.infected <- stratify_by_risk( ag, matrix(c(0.01,0.01,0.01,0.01,0.01,0.01,0.4),nrow=1)) 

```

## Vaccination calendar

In this vignette, we will use two vaccination calendars: the first one will be a normal calendar for the seasonal flu but the second one for the pandemic flu will be empty (uptake of vaccine calendar and efficacy of the vaccine are 0). 

Indeed, in case of pandemic, there is no vaccine available and it takes between 5 and 6 months to specialists to create a new vaccine. 

```{r}

#Vaccination calendar for seasonal flu 

cov2<-NULL
cov2 <- coverage[,c("Under.65","Under.65","Under.65","Under.65","Under.65","Under.65","X65","at.risk.under.65","at.risk.under.65","at.risk.under.65","at.risk.under.65","at.risk.under.65","at.risk.under.65","X65")]/100.0
names(cov2)[1]<- "0-2"
names(cov2)[2]<- "3-5"
names(cov2)[3]<- "6-12"
names(cov2)[4]<- "13-16"
names(cov2)[5]<- "17-18"
names(cov2)[6]<- "19-64"
names(cov2)[7]<- "65+"
names(cov2)[8]<- "0-2 at risk"
names(cov2)[9]<- "3-5 at risk"
names(cov2)[10]<- "6-12 at risk"
names(cov2)[11]<- "13-16 at risk"
names(cov2)[12]<- "17-18 at risk"
names(cov2)[13]<- "19-64 at risk"
names(cov2)[14]<- "65+ at risk"

vaccine_calendar_s <- as_vaccination_calendar(efficacy = c(0.7, 0.7, 0.7,0.7, 0.7, 0.7,0.4), dates = coverage$Date,coverage = cov2, no_age_groups = 7, no_risk_groups = 2)


#Vaccination calendar for pandemic flu 

cov2p <- NULL
cov2p <- rep(c(0,0,0,0,0,0,0,0,0,0,0,0,0,0),19)
cov2p <- matrix(cov2p,nrow = 19)
cov2p <- data.frame(cov2p)
names(cov2p)[1]<- "0-2"
names(cov2p)[2]<- "3-5"
names(cov2p)[3]<- "6-12"
names(cov2p)[4]<- "13-16"
names(cov2p)[5]<- "17-18"
names(cov2p)[6]<- "19-64"
names(cov2p)[7]<- "65+"
names(cov2p)[8]<- "0-2 at risk"
names(cov2p)[9]<- "3-5 at risk"
names(cov2p)[10]<- "6-12 at risk"
names(cov2p)[11]<- "13-16 at risk"
names(cov2p)[12]<- "17-18 at risk"
names(cov2p)[13]<- "19-64 at risk"
names(cov2p)[14]<- "65+ at risk"

vaccine_calendar_p <- as_vaccination_calendar(
  efficacy = c(0,0,0,0,0,0,0),
  dates = coverage$Date,coverage = cov2p, no_age_groups = 7, no_risk_groups =2)

```


## Epidemiological parameters

Different parameter values in the epidemiological model. We assume susceptibility is different for the different age groups, while transmissibility is the same for each age group. Infection_delays are the average time going from exposed to infected and from infected to recovered.

```{r}

#Parameters for seasonal flu 

transmissibility_s <- 0.17
susceptibility_s <- c(0.7,0.7,0.7,0.7,0.7,0.7,0.3)
infection_delays_s <- c(0.8,1.8)

#Parameters for pandemic flu 
transmissibility_p <- 0.15
susceptibility_p <- c(1,1,1,1,1,1,1)
infection_delays_p <- c(0.8,1.8)

```

#  Contact matrix

We create two contact matrices : 

- one for the simulation without school closure : `contacts_no_closure` using the non-holiday polymod data `polymod_uk_school`
- one for the simulation with school closure : `contacts_closure` using the holiday polymod data `polymod_uk_holiday`


```{r}

#Creation of polymod_data modelling school closure 

#Data frame polymod_uk for no school closure 
polymod_uk_school <- data.frame(polymod_UK)
polymod_uk_holiday <-data.frame(polymod_UK_hol)
names(polymod_uk_school)[1]<-"V1"
names(polymod_uk_school)[2]<-"V2"
names(polymod_uk_holiday)[1]<-"V1"

#Creation of contact matrix 

#Contact matrix with no school closure 
contacts_no_closure <- contact_matrix(as.matrix(polymod_uk_school),demography,age_group_limits = as.numeric(c(3,6,13,17,19,65)))
contacts_no_closure <-cbind(contacts_no_closure,contacts_no_closure)
contacts_no_closure <- rbind(contacts_no_closure,contacts_no_closure)
pander(contacts_no_closure)

contacts_closure <- contact_matrix(as.matrix(polymod_uk_holiday),demography,age_group_limits = as.numeric(c(3,6,13,17,19,65)))
contacts_closure <- cbind(contacts_closure,contacts_closure)
contacts_closure <- rbind(contacts_closure,contacts_closure)
pander(contacts_closure)

```

#  Modification of the epidemiological model 

We modify the epidemiological model by changing the calculation of the parameter $\lambda_i$ used in the following SEIR model: 

\begin{equation}\begin{split}
\frac{dS_{ik}}{dt} & = -\lambda_i S_{ik} \\
\frac{dE_{ik}^1}{dt} & = \lambda_i S_{ik} -\gamma_1 E_{ik}^1 \\
\frac{dE_{ik}^2}{dt} & = \gamma_1 \left(E_{ik}^1 -E_{ik}^2 \right) \\
\frac{dI_{ik}^1}{dt} & = \gamma_1 E_{ik}^2 -\gamma_2 I_{ik}^1 \\
\frac{dI_{ik}^2}{dt} & = \gamma_2 \left( I_{ik}^1 - I_{ik}^2 \right) \\
\frac{dR_{ik}}{dt} & = \gamma_2 I_{ik}^2
\end{split}\end{equation}
\noindent

We create `gen_seeiir_ag_vacc_closure` with 7 new variables: 

- `date_begin_closure` the beginning date of school closure 
- `date_end_closure` the end date of school closure 
- `dates_seq` the sequence of the dates used in the vaccination calendar 
- `cij_nc` the contact matrix when there is no school closure 
- `cij_c` the contact matrix when there is school closure 
- `sij_nc` the transmission matrix when there is no school closure 
- `sij_c` the transmission matrix when there is school closure 

In `gen_seeiir_ag_vacc_closure`, $\lambda_i$ is calculated using different transmission matrices depending on the date `dates_seq[i]`: 

- if `dates_seq[i]`is before `date_begin_closure` or if it is after `date_end_closure`, we use the transmission matrix `sij_nc` to calculate $\lambda_i$ 
- if `dates_seq[i]`is between `date_begin_closure` and  `date_end_closure`, we use the transmission matrix `sij_c` to calculate $\lambda_i$. 

```{r}
gen_seeiir_ag_vacc_closure <- odin::odin({
  # Number of groups
  no_groups <- user()
  
  # INITIAL CONDITIONS
  # Population size by age/risk group
  pop[] <- user()
  # Initial infection by age/risk group
  I0[] <- user()
  
  # MODEL PARAMETERS
  # Susceptibility
  susc[] <- user()
  
  # Transmissibility
  trans <- user()
  
  # Latent periods
  gamma1 <- user()
  gamma2 <- user()
  
  #Beginning and end of school closure 
  date_begin_closure <- user()
  date_end_closure <- user()
 
  # Vaccine related variables 
  dates_seq[] <- user()
  dates[] <- user()
  calendar[,] <- user()
  
  # efficacy
  alpha[] <- user()
  
  # Contact matrix without school closure 
  cij_nc[,] <- user()
  
  # Contact matrix with school closure 
  cij_c[,] <- user()
  
  # Force of infection
    lambda[] <- if (dates_seq[i] >= date_begin_closure)
      (if(dates_seq[i] <= date_end_closure)(trans * susc[i] * (sum(sij_c[i,]))) 
       else (trans * susc[i] * (sum(sij_nc[i,])))) 
      else (trans * susc[i] * (sum(sij_nc[i,])))
  
  # Vaccination. The rate is a step function that changes at each date according
  # to the passed calendar
  vI[] <- interpolate(dates, calendar, "constant")
  # Vaccination is given as a fraction vaccination, here we scale it to 
  # a rate
  sumN[] <- if (vI[i]>0) (S[i]+E1[i]+E2[i]+I1[i]+I2[i]+R[i]) else 0
  v[] <- if (sumN[i]>0) vI[i]*pop[i]/sumN[i] else 0
  
  # Transmission matrix without school closure 
  sij_nc[,] <- cij_nc[i,j] * (I1[j] + I2[j] + I1v[j] + I2v[j])
  
  # Transmission matrix with school closure 
  sij_c[,] <- cij_c[i,j] * (I1[j] + I2[j] + I1v[j] + I2v[j])
  
  # Newly infected
  newInf[] <- lambda[i] * S[i]
  newInfv[] <- lambda[i] * Sv[i]
  
  # THE DERIVATIVES OF THE SEEIIR MODEL
  # Derivatives of the not vaccinated group
  deriv(S[]) <- -newInf[i] - v[i] * S[i]
  deriv(E1[]) <- newInf[i] - gamma1 * E1[i] - v[i] * E1[i]
  deriv(E2[]) <- gamma1 * (E1[i] - E2[i]) - v[i] * E2[i]
  deriv(I1[]) <- gamma1 * E2[i]  - gamma2 * I1[i] - v[i] * I1[i]
  deriv(I2[]) <- gamma2 * (I1[i] - I2[i]) - v[i] * I2[i]
  deriv(R[]) <- gamma2 * I2[i] - v[i] * R[i]
  
  # Derivatives vaccination group
  deriv(Sv[]) <- -newInfv[i] + v[i] * (1-alpha[i]) * S[i]
  deriv(E1v[]) <- newInfv[i] - gamma1 * E1v[i] + v[i] * E1[i]
  deriv(E2v[]) <- gamma1 * (E1v[i] - E2v[i]) + v[i] * E2[i]
  deriv(I1v[]) <- gamma1 * E2v[i]  - gamma2 * I1v[i] + v[i] * I1[i]
  deriv(I2v[]) <- gamma2 * (I1v[i] - I2v[i]) + v[i] * I2[i]
  deriv(Rv[]) <- gamma2 * I2v[i] + v[i] * (R[i] + alpha[i] * S[i])
  
  # Tracking the cumulative amount of infections over time for output of incidence
  deriv(cumI[]) <- newInf[i] + newInfv[i]
  
  # Initial value of the variables
  initial(S[1:no_groups]) <- pop[i] - I0[i]
  initial(E1[1:no_groups]) <- 0
  initial(E2[1:no_groups]) <- 0
  initial(I1[1:no_groups]) <- I0[i]
  initial(I2[1:no_groups]) <- 0
  initial(R[1:no_groups]) <- 0
  initial(cumI[1:no_groups]) <- 0
  
  initial(Sv[1:no_groups]) <- 0
  initial(E1v[1:no_groups]) <- 0
  initial(E2v[1:no_groups]) <- 0
  initial(I1v[1:no_groups]) <- 0
  initial(I2v[1:no_groups]) <- 0
  initial(Rv[1:no_groups]) <- 0
  
  # Set dimension of all variables/parameters
  dim(dates_seq) <- user()
  dim(dates) <- user()
  dim(calendar) <- user()
 
  dim(pop) <- no_groups
  dim(I0) <- no_groups
  dim(susc) <- no_groups
  dim(lambda) <- no_groups
  dim(v) <- no_groups
  dim(vI) <- no_groups
  dim(sumN) <- no_groups  
  dim(alpha) <- no_groups
  dim(cij_nc) <- c(no_groups, no_groups)
  dim(sij_nc) <- c(no_groups, no_groups)
  dim(cij_c) <- c(no_groups, no_groups)
  dim(sij_c) <- c(no_groups, no_groups)
  
  dim(S) <- no_groups
  dim(E1) <- no_groups
  dim(E2) <- no_groups
  dim(I1) <- no_groups
  dim(I2) <- no_groups
  dim(R) <- no_groups
  dim(Sv) <- no_groups
  dim(E1v) <- no_groups
  dim(E2v) <- no_groups
  dim(I1v) <- no_groups
  dim(I2v) <- no_groups
  dim(Rv) <- no_groups
  dim(cumI) <- no_groups
  dim(newInf) <- no_groups
  dim(newInfv) <- no_groups
}, verbose = F)

```

Instead of using `infectionODEs`which only allows one contact matrix, we will use another function `infection_odin_closure`which has two contact matrices in argument: 

- one for days without school closure 
- one for days with school closure. 

It also has two new arguments: 

- `date_begin_closure` which is the start date of school closure following the beginning of a serious epidemy of flu 
- `date_end_closure` which is the day schools reopen. 

Here is the new function `infection_odin_closure`: 

```{r}

infection_odin_closure <- function(population, initial_infected, vaccine_calendar,contact_matrix_school,contact_matrix_closure, susceptibility, transmissibility, infection_delays, interval, date_begin_closure = 0, date_end_closure = 0) {
  # Extract the date used from the vaccine calendar
  begin_date <- as.Date(paste0(format(vaccine_calendar$dates[1], "%Y"),"-09-01"))
  end_date <- begin_date + 7*52
  t <- as.numeric(seq(begin_date, end_date, interval))
  dates_seq <- seq(begin_date, end_date, interval)
  date_begin_closure <- date_begin_closure
  date_end_closure <- date_end_closure 

  N<-length(dates_seq)-1
  
  no_groups <- length(population)
  no_risk_groups <- 2
  no_age_groups <- no_groups/no_risk_groups

  cij_nc <- contact_matrix_school
  cij_c <- contact_matrix_closure

  calendar <- vaccine_calendar$calendar[c(nrow(vaccine_calendar$calendar),1:nrow(vaccine_calendar$calendar)),]
  dates <- as.numeric(c(dates_seq[1], vaccine_calendar$dates))
  
  
  # Set the parameter values
  mod <- gen_seeiir_ag_vacc_closure(no_groups = no_groups, cij_nc =  cij_nc,cij_c =  cij_c, trans = transmissibility,pop = population,I0 = initial_infected,susc = rep(susceptibility,no_risk_groups),alpha = vaccine_calendar$efficacy[1:no_groups],dates = dates,dates_seq=dates_seq,calendar = calendar[,1:no_groups],
gamma1 = 2/infection_delays[1], gamma2 = 2/infection_delays[2],date_begin_closure=date_begin_closure,date_end_closure=date_end_closure)
  y <- mod$run(t, hmax = NULL, method = "euler", hini = 0.25, atol = 1)
  
  # Only return new infections by week, ignore the rest
  y <- y[, (ncol(y) - no_groups + 1):ncol(y)]
  
  # Returning the differences in cumulative infections from one week to the other
  y <- data.frame(y[2:(nrow(y)), ] - y[1:(nrow(y) - 1), ])
  
  #Cleanup and add Time column
  for (i in 1:ncol(y)){
    colnames(y)[i] <-paste0("V",i)
  }
  mutate(y, Time = as.Date(t[1:nrow(y)], origin = "1970-01-01"))
}
```
#  Example of school closure  

We will now use the new function `infection_odin_closure`to compare the number of people infected when there is no school closure and when there is a period of school closure during the outbreak. 

In this example, we will consider an epidemy which started the 23rd of September. In case of school closure, the schools will be closed for one month: between the 30th of September and the 30th of October. This means the beginning of school closure will be a week after the beginning of the epidemy. 

The necessity of this quick actions will be shown later when comparing the results for different start dates of school closures. 

## Example for seasonal flu 

```{r}

#Result in case of no school closure 

odes_no_closure_s <- infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7)

pander(head(odes_no_closure_s))

#Result in case of school closure from 2007-09-30 to 2007-10-30

odes_closure_s <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-30"))

pander(head(odes_closure_s))

```

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Without school closure 

fraction.infected_nc_s <- odes_no_closure_s
fraction.infected_nc_s$V1 <- fraction.infected_nc_s$V1/population[1]
fraction.infected_nc_s$V2 <- fraction.infected_nc_s$V2/population[2]
fraction.infected_nc_s$V3 <- fraction.infected_nc_s$V3/population[3]
fraction.infected_nc_s$V4 <- fraction.infected_nc_s$V4/population[4]
fraction.infected_nc_s$V5 <- fraction.infected_nc_s$V5/population[5]
fraction.infected_nc_s$V6 <- fraction.infected_nc_s$V6/population[6]
fraction.infected_nc_s$V7 <- fraction.infected_nc_s$V7/population[7]
fraction.infected_nc_s$V8 <- fraction.infected_nc_s$V8/population[8]
fraction.infected_nc_s$V9 <- fraction.infected_nc_s$V9/population[9]
fraction.infected_nc_s$V10 <- fraction.infected_nc_s$V10/population[10]
fraction.infected_nc_s$V11 <- fraction.infected_nc_s$V11/population[11]
fraction.infected_nc_s$V12 <- fraction.infected_nc_s$V12/population[12]
fraction.infected_nc_s$V13 <- fraction.infected_nc_s$V13/population[13]
fraction.infected_nc_s$V14 <- fraction.infected_nc_s$V14/population[14]

#With school closure 

fraction.infected_c_s <- odes_closure_s
fraction.infected_c_s$V1 <- fraction.infected_c_s$V1/population[1]
fraction.infected_c_s$V2 <- fraction.infected_c_s$V2/population[2]
fraction.infected_c_s$V3 <- fraction.infected_c_s$V3/population[3]
fraction.infected_c_s$V4 <- fraction.infected_c_s$V4/population[4]
fraction.infected_c_s$V5 <- fraction.infected_c_s$V5/population[5]
fraction.infected_c_s$V6 <- fraction.infected_c_s$V6/population[6]
fraction.infected_c_s$V7 <- fraction.infected_c_s$V7/population[7]
fraction.infected_c_s$V8 <- fraction.infected_c_s$V8/population[8]
fraction.infected_c_s$V9 <- fraction.infected_c_s$V9/population[9]
fraction.infected_c_s$V10 <- fraction.infected_c_s$V10/population[10]
fraction.infected_c_s$V11 <- fraction.infected_c_s$V11/population[11]
fraction.infected_c_s$V12 <- fraction.infected_c_s$V12/population[12]
fraction.infected_c_s$V13 <- fraction.infected_c_s$V13/population[13]
fraction.infected_c_s$V14 <- fraction.infected_c_s$V14/population[14]

#Graphic for age group <0-2>

fraction.infected_0_2_s <- NULL
fraction.infected_0_2_s$Time <- odes_no_closure_s$Time
fraction.infected_0_2_s$V1 <-odes_no_closure_s$V1
fraction.infected_0_2_s$V2 <- odes_closure_s$V1
fraction.infected_0_2_s$V3 <- odes_no_closure_s$V8
fraction.infected_0_2_s$V4 <- odes_closure_s$V8 

fraction.infected_0_2_s <-data.frame(fraction.infected_0_2_s)

ggplot( data=fraction.infected_0_2_s ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 0-2 low risk")

ggplot( data=fraction.infected_0_2_s ) + geom_line( aes(x=Time, y=V3, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 0-2 high risk")

#Graphic for age group <3-18> 

fraction.infected_3_5_s <- NULL
fraction.infected_3_5_s$Time <- odes_no_closure_s$Time
fraction.infected_3_5_s$V1 <- odes_no_closure_s$V2
fraction.infected_3_5_s$V2 <- odes_closure_s$V2
fraction.infected_3_5_s$V3 <- odes_no_closure_s$V9
fraction.infected_3_5_s$V4 <- odes_closure_s$V9

fraction.infected_3_5_s <-data.frame(fraction.infected_3_5_s)

fraction.infected_6_12_s <- NULL
fraction.infected_6_12_s$Time <- odes_no_closure_s$Time
fraction.infected_6_12_s$V1 <- odes_no_closure_s$V3
fraction.infected_6_12_s$V2 <- odes_closure_s$V3
fraction.infected_6_12_s$V3 <- odes_no_closure_s$V10
fraction.infected_6_12_s$V4 <- odes_closure_s$V10

fraction.infected_6_12_s <-data.frame(fraction.infected_6_12_s)

fraction.infected_13_16_s <- NULL
fraction.infected_13_16_s$Time <- odes_no_closure_s$Time
fraction.infected_13_16_s$V1 <- odes_no_closure_s$V4
fraction.infected_13_16_s$V2 <- odes_closure_s$V4
fraction.infected_13_16_s$V3 <- odes_no_closure_s$V11
fraction.infected_13_16_s$V4 <- odes_closure_s$V11

fraction.infected_13_16_s <-data.frame(fraction.infected_13_16_s)

fraction.infected_17_18_s <- NULL
fraction.infected_17_18_s$Time <- odes_no_closure_s$Time
fraction.infected_17_18_s$V1 <- odes_no_closure_s$V5
fraction.infected_17_18_s$V2 <- odes_closure_s$V5
fraction.infected_17_18_s$V3 <- odes_no_closure_s$V12
fraction.infected_17_18_s$V4 <- odes_closure_s$V12

fraction.infected_17_18_s <-data.frame(fraction.infected_17_18_s)

fraction.infected_3_18_s <- NULL
fraction.infected_3_18_s$Time <- odes_no_closure_s$Time
fraction.infected_3_18_s$V1<-rowSums(data.frame(fraction.infected_3_5_s$V1,fraction.infected_6_12_s$V1,fraction.infected_13_16_s$V1,fraction.infected_17_18_s$V1))
fraction.infected_3_18_s$V2 <- rowSums(data.frame(fraction.infected_3_5_s$V2,fraction.infected_6_12_s$V2,fraction.infected_13_16_s$V2,fraction.infected_17_18_s$V2)) 
fraction.infected_3_18_s$V3<-rowSums(data.frame(fraction.infected_3_5_s$V3,fraction.infected_6_12_s$V3,fraction.infected_13_16_s$V3,fraction.infected_17_18_s$V3))
fraction.infected_3_18_s$V4 <- rowSums(data.frame(fraction.infected_3_5_s$V4,fraction.infected_6_12_s$V4,fraction.infected_13_16_s$V4,fraction.infected_17_18_s$V4)) 

fraction.infected_3_18_s <-data.frame(fraction.infected_3_18_s)

ggplot( data=fraction.infected_3_18_s ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="3-18 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 3-18 low risk")

ggplot( data=fraction.infected_3_18_s ) + geom_line( aes(x=Time, y=V3, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time,y=V4, colour="3-18 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 3-18 high risk")

#Graphic for age group <19-64>

fraction.infected_19_64_s <- NULL
fraction.infected_19_64_s$Time <- odes_no_closure_s$Time
fraction.infected_19_64_s$V1 <- odes_no_closure_s$V6
fraction.infected_19_64_s$V2 <- odes_closure_s$V6
fraction.infected_19_64_s$V3 <- odes_no_closure_s$V13
fraction.infected_19_64_s$V4 <- odes_closure_s$V13

fraction.infected_19_64_s <-data.frame(fraction.infected_19_64_s)

ggplot( data=fraction.infected_19_64_s ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="19-64 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 19-64 low risk")

ggplot( data=fraction.infected_19_64_s ) + geom_line( aes(x=Time, y=V3, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time,y=V4, colour="19-64 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 19-64 high risk")

#Graphic for age group <65+>

fraction.infected_65_s <- NULL
fraction.infected_65_s$Time <- odes_no_closure_s$Time
fraction.infected_65_s$V1 <- odes_no_closure_s$V7
fraction.infected_65_s$V2 <- odes_closure_s$V7
fraction.infected_65_s$V3 <- odes_no_closure_s$V14
fraction.infected_65_s$V4 <- odes_closure_s$V14

fraction.infected_65_s <-data.frame(fraction.infected_65_s)

ggplot( data=fraction.infected_65_s ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="65+ with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 65+ low risk")

ggplot( data=fraction.infected_65_s ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="65+ with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 65+ high risk")

```

We can see that in case of seasonal flu, school closure reduces the number of people infected and slightly delays the peak of the outbreak of the epidemy. 

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

### For low risk people 

```{r}

#Age group <0-2> 

nc_s_area_0_2 <- sum(fraction.infected_0_2_s$V1)
c_s_area_0_2 <- sum(fraction.infected_0_2_s$V2)
diff_area_s_0_2 <- nc_s_area_0_2 - c_s_area_0_2

#Age group <3-5> 

nc_s_area_3_5 <- sum(fraction.infected_3_5_s$V1)
c_s_area_3_5 <- sum(fraction.infected_3_5_s$V2)
diff_area_s_3_5 <- nc_s_area_3_5 - c_s_area_3_5

#Age group <6-12> 

nc_s_area_6_12 <- sum(fraction.infected_6_12_s$V1)
c_s_area_6_12 <- sum(fraction.infected_6_12_s$V2)
diff_area_s_6_12 <- nc_s_area_6_12 - c_s_area_6_12

#Age group <13-16> 

nc_s_area_13_16 <- sum(fraction.infected_13_16_s$V1)
c_s_area_13_16 <- sum(fraction.infected_13_16_s$V2)
diff_area_s_13_16 <- nc_s_area_13_16 - c_s_area_13_16

#Age group <17-18> 

nc_s_area_17_18 <- sum(fraction.infected_17_18_s$V1)
c_s_area_17_18 <- sum(fraction.infected_17_18_s$V2)
diff_area_s_17_18 <- nc_s_area_17_18 - c_s_area_17_18

#Age group <19-64> 

nc_s_area_19_64 <- sum(fraction.infected_19_64_s$V1)
c_s_area_19_64 <- sum(fraction.infected_19_64_s$V2)
diff_area_s_19_64 <- nc_s_area_19_64 - c_s_area_19_64

#Age group <65+> 

nc_s_area_65 <- sum(fraction.infected_65_s$V1)
c_s_area_65 <- sum(fraction.infected_65_s$V2)
diff_area_s_65 <- nc_s_area_65 - c_s_area_65

#Results in a table 
Total_Reduction_s_results <- data.frame(
  Total_infected_no_school_closure = c(nc_s_area_0_2,nc_s_area_3_5,nc_s_area_6_12,nc_s_area_13_16,nc_s_area_17_18,nc_s_area_19_64,nc_s_area_65),
  Total_infected_school_closure = c(c_s_area_0_2,c_s_area_3_5,c_s_area_6_12,c_s_area_13_16,c_s_area_17_18,c_s_area_19_64,c_s_area_65),
  Reduction = c(diff_area_s_0_2,diff_area_s_3_5,diff_area_s_6_12,diff_area_s_13_16,diff_area_s_17_18,diff_area_s_19_64,diff_area_s_65),
  Reduction_percentage = c(diff_area_s_0_2*100/nc_s_area_0_2,diff_area_s_3_5*100/nc_s_area_3_5,diff_area_s_6_12*100/nc_s_area_6_12,diff_area_s_13_16*100/nc_s_area_13_16,diff_area_s_17_18*100/nc_s_area_17_18,diff_area_s_19_64*100/nc_s_area_19_64,diff_area_s_65*100/nc_s_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_s_results)

```

We can conclude that the total number of people has been reduced by between 8% and 51%. 

### For high risk people 

```{r}

#Age group <0-2> 

nc_s_area_0_2 <- sum(fraction.infected_0_2_s$V3)
c_s_area_0_2 <- sum(fraction.infected_0_2_s$V4)
diff_area_s_0_2 <- nc_s_area_0_2 - c_s_area_0_2

#Age group <3-5> 

nc_s_area_3_5 <- sum(fraction.infected_3_5_s$V3)
c_s_area_3_5 <- sum(fraction.infected_3_5_s$V4)
diff_area_s_3_5 <- nc_s_area_3_5 - c_s_area_3_5

#Age group <6-12> 

nc_s_area_6_12 <- sum(fraction.infected_6_12_s$V3)
c_s_area_6_12 <- sum(fraction.infected_6_12_s$V4)
diff_area_s_6_12 <- nc_s_area_6_12 - c_s_area_6_12

#Age group <13-16> 

nc_s_area_13_16 <- sum(fraction.infected_13_16_s$V3)
c_s_area_13_16 <- sum(fraction.infected_13_16_s$V4)
diff_area_s_13_16 <- nc_s_area_13_16 - c_s_area_13_16

#Age group <17-18> 

nc_s_area_17_18 <- sum(fraction.infected_17_18_s$V3)
c_s_area_17_18 <- sum(fraction.infected_17_18_s$V4)
diff_area_s_17_18 <- nc_s_area_17_18 - c_s_area_17_18

#Age group <19-64> 

nc_s_area_19_64 <- sum(fraction.infected_19_64_s$V3)
c_s_area_19_64 <- sum(fraction.infected_19_64_s$V4)
diff_area_s_19_64 <- nc_s_area_19_64 - c_s_area_19_64

#Age group <65+> 

nc_s_area_65 <- sum(fraction.infected_65_s$V3)
c_s_area_65 <- sum(fraction.infected_65_s$V4)
diff_area_s_65 <- nc_s_area_65 - c_s_area_65

#Results in a table 
Total_Reduction_s_results <- data.frame(
  Total_infected_no_school_closure = c(nc_s_area_0_2,nc_s_area_3_5,nc_s_area_6_12,nc_s_area_13_16,nc_s_area_17_18,nc_s_area_19_64,nc_s_area_65),
  Total_infected_school_closure = c(c_s_area_0_2,c_s_area_3_5,c_s_area_6_12,c_s_area_13_16,c_s_area_17_18,c_s_area_19_64,c_s_area_65),
  Reduction = c(diff_area_s_0_2,diff_area_s_3_5,diff_area_s_6_12,diff_area_s_13_16,diff_area_s_17_18,diff_area_s_19_64,diff_area_s_65),
  Reduction_percentage = c(diff_area_s_0_2*100/nc_s_area_0_2,diff_area_s_3_5*100/nc_s_area_3_5,diff_area_s_6_12*100/nc_s_area_6_12,diff_area_s_13_16*100/nc_s_area_13_16,diff_area_s_17_18*100/nc_s_area_17_18,diff_area_s_19_64*100/nc_s_area_19_64,diff_area_s_65*100/nc_s_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_s_results)

```

We can conclude that the total number of people has been reduced by between 10% and 32%. 

Now, we will calculate the delay of the peak of outbreak thanks to school closure. 

### For low risk people 

```{r}

#Age group <0-2> 

nc_s_i_max_0_2 <- which.max(fraction.infected_0_2_s$V1)
c_s_i_max_0_2 <- which.max(fraction.infected_0_2_s$V2)
nc_s_t_i_max_0_2 <- fraction.infected_0_2_s$Time[nc_s_i_max_0_2]
c_s_t_i_max_0_2 <- fraction.infected_0_2_s$Time[c_s_i_max_0_2]
delay_s_0_2 <- c_s_t_i_max_0_2 - nc_s_t_i_max_0_2

#Age group <3-5> 

nc_s_i_max_3_5 <- which.max(fraction.infected_3_5_s$V1)
c_s_i_max_3_5 <- which.max(fraction.infected_3_5_s$V2)
nc_s_t_i_max_3_5 <- fraction.infected_3_5_s$Time[nc_s_i_max_3_5]
c_s_t_i_max_3_5 <- fraction.infected_3_5_s$Time[c_s_i_max_3_5]
delay_s_3_5 <- c_s_t_i_max_3_5 - nc_s_t_i_max_3_5

#Age group <6-12> 

nc_s_i_max_6_12 <- which.max(fraction.infected_6_12_s$V1)
c_s_i_max_6_12 <- which.max(fraction.infected_6_12_s$V2)
nc_s_t_i_max_6_12 <- fraction.infected_6_12_s$Time[nc_s_i_max_6_12]
c_s_t_i_max_6_12 <- fraction.infected_6_12_s$Time[c_s_i_max_6_12]
delay_s_6_12 <- c_s_t_i_max_6_12 - nc_s_t_i_max_6_12

#Age group <13-16> 

nc_s_i_max_13_16 <- which.max(fraction.infected_13_16_s$V1)
c_s_i_max_13_16 <- which.max(fraction.infected_13_16_s$V2)
nc_s_t_i_max_13_16 <- fraction.infected_13_16_s$Time[nc_s_i_max_13_16]
c_s_t_i_max_13_16 <- fraction.infected_13_16_s$Time[c_s_i_max_13_16]
delay_s_13_16 <- c_s_t_i_max_13_16 - nc_s_t_i_max_13_16

#Age group <17-18> 

nc_s_i_max_17_18 <- which.max(fraction.infected_17_18_s$V1)
c_s_i_max_17_18 <- which.max(fraction.infected_17_18_s$V2)
nc_s_t_i_max_17_18 <- fraction.infected_17_18_s$Time[nc_s_i_max_17_18]
c_s_t_i_max_17_18 <- fraction.infected_17_18_s$Time[c_s_i_max_17_18]
delay_s_17_18 <- c_s_t_i_max_17_18 - nc_s_t_i_max_17_18

#Age group <19-64> 

nc_s_i_max_19_64 <- which.max(fraction.infected_19_64_s$V1)
c_s_i_max_19_64 <- which.max(fraction.infected_19_64_s$V2)
nc_s_t_i_max_19_64 <- fraction.infected_19_64_s$Time[nc_s_i_max_19_64]
c_s_t_i_max_19_64 <- fraction.infected_19_64_s$Time[c_s_i_max_19_64]
delay_s_19_64 <- c_s_t_i_max_19_64 - nc_s_t_i_max_19_64

#Age group <65+> 

nc_s_i_max_65 <- which.max(fraction.infected_65_s$V1)
c_s_i_max_65 <- which.max(fraction.infected_65_s$V2)
nc_s_t_i_max_65 <- fraction.infected_65_s$Time[nc_s_i_max_65]
c_s_t_i_max_65 <- fraction.infected_0_2_s$Time[c_s_i_max_65]
delay_s_65 <- c_s_t_i_max_65 - nc_s_t_i_max_65

#Results in a table 
Delay_outbreak_s_results <- data.frame(
  Peak_outbreak_no_school_closure = c(nc_s_t_i_max_0_2,nc_s_t_i_max_3_5,nc_s_t_i_max_6_12,nc_s_t_i_max_13_16,nc_s_t_i_max_17_18,nc_s_t_i_max_19_64,nc_s_t_i_max_65),
  Peak_outbreak_school_closure = c(c_s_t_i_max_0_2,c_s_t_i_max_3_5,c_s_t_i_max_6_12,c_s_t_i_max_13_16,c_s_t_i_max_17_18,c_s_t_i_max_19_64,c_s_t_i_max_65),
  Delay_peak_outbreak = c(delay_s_0_2,delay_s_3_5,delay_s_6_12,delay_s_13_16,delay_s_17_18,delay_s_19_64,delay_s_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Delay_outbreak_s_results)

```

Only the peak outbreak of the age group <13-16> (Secondary school) has been delayed by school closure of 7 days. The others peak were not delayed by school closure, however thanks to it its value is much lower. 

### For high risk people 

```{r}

#Age group <0-2> 

nc_s_i_max_0_2 <- which.max(fraction.infected_0_2_s$V3)
c_s_i_max_0_2 <- which.max(fraction.infected_0_2_s$V4)
nc_s_t_i_max_0_2 <- fraction.infected_0_2_s$Time[nc_s_i_max_0_2]
c_s_t_i_max_0_2 <- fraction.infected_0_2_s$Time[c_s_i_max_0_2]
delay_s_0_2 <- c_s_t_i_max_0_2 - nc_s_t_i_max_0_2

#Age group <3-5> 

nc_s_i_max_3_5 <- which.max(fraction.infected_3_5_s$V3)
c_s_i_max_3_5 <- which.max(fraction.infected_3_5_s$V4)
nc_s_t_i_max_3_5 <- fraction.infected_3_5_s$Time[nc_s_i_max_3_5]
c_s_t_i_max_3_5 <- fraction.infected_3_5_s$Time[c_s_i_max_3_5]
delay_s_3_5 <- c_s_t_i_max_3_5 - nc_s_t_i_max_3_5

#Age group <6-12> 

nc_s_i_max_6_12 <- which.max(fraction.infected_6_12_s$V3)
c_s_i_max_6_12 <- which.max(fraction.infected_6_12_s$V4)
nc_s_t_i_max_6_12 <- fraction.infected_6_12_s$Time[nc_s_i_max_6_12]
c_s_t_i_max_6_12 <- fraction.infected_6_12_s$Time[c_s_i_max_6_12]
delay_s_6_12 <- c_s_t_i_max_6_12 - nc_s_t_i_max_6_12

#Age group <13-16> 

nc_s_i_max_13_16 <- which.max(fraction.infected_13_16_s$V3)
c_s_i_max_13_16 <- which.max(fraction.infected_13_16_s$V4)
nc_s_t_i_max_13_16 <- fraction.infected_13_16_s$Time[nc_s_i_max_13_16]
c_s_t_i_max_13_16 <- fraction.infected_13_16_s$Time[c_s_i_max_13_16]
delay_s_13_16 <- c_s_t_i_max_13_16 - nc_s_t_i_max_13_16

#Age group <17-18> 

nc_s_i_max_17_18 <- which.max(fraction.infected_17_18_s$V3)
c_s_i_max_17_18 <- which.max(fraction.infected_17_18_s$V4)
nc_s_t_i_max_17_18 <- fraction.infected_17_18_s$Time[nc_s_i_max_17_18]
c_s_t_i_max_17_18 <- fraction.infected_17_18_s$Time[c_s_i_max_17_18]
delay_s_17_18 <- c_s_t_i_max_17_18 - nc_s_t_i_max_17_18

#Age group <19-64> 

nc_s_i_max_19_64 <- which.max(fraction.infected_19_64_s$V3)
c_s_i_max_19_64 <- which.max(fraction.infected_19_64_s$V4)
nc_s_t_i_max_19_64 <- fraction.infected_19_64_s$Time[nc_s_i_max_19_64]
c_s_t_i_max_19_64 <- fraction.infected_19_64_s$Time[c_s_i_max_19_64]
delay_s_19_64 <- c_s_t_i_max_19_64 - nc_s_t_i_max_19_64

#Age group <65+> 

nc_s_i_max_65 <- which.max(fraction.infected_65_s$V3)
c_s_i_max_65 <- which.max(fraction.infected_65_s$V4)
nc_s_t_i_max_65 <- fraction.infected_65_s$Time[nc_s_i_max_65]
c_s_t_i_max_65 <- fraction.infected_0_2_s$Time[c_s_i_max_65]
delay_s_65 <- c_s_t_i_max_65 - nc_s_t_i_max_65

#Results in a table 
Delay_outbreak_s_results <- data.frame(
  Peak_outbreak_no_school_closure = c(nc_s_t_i_max_0_2,nc_s_t_i_max_3_5,nc_s_t_i_max_6_12,nc_s_t_i_max_13_16,nc_s_t_i_max_17_18,nc_s_t_i_max_19_64,nc_s_t_i_max_65),
  Peak_outbreak_school_closure = c(c_s_t_i_max_0_2,c_s_t_i_max_3_5,c_s_t_i_max_6_12,c_s_t_i_max_13_16,c_s_t_i_max_17_18,c_s_t_i_max_19_64,c_s_t_i_max_65),
  Delay_peak_outbreak = c(delay_s_0_2,delay_s_3_5,delay_s_6_12,delay_s_13_16,delay_s_17_18,delay_s_19_64,delay_s_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Delay_outbreak_s_results)

```

Only the peak outbreak of the age group <3-5> (Pre-school),<6-12> (Primary school),<13-16> (Secondary school) has been delayed by school closure of 7 days. The others peak were not delayed by school closure, however thanks to it its value is much lower.

## Example for pandemic flu 

```{r}

#Result in case of no school closure 

odes_no_closure_p <- infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7)

pander(head(odes_no_closure_p))

#Result in case of school closure from 2007-09-30 to 2007-10-30

odes_closure_p <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-30"))

pander(head(odes_closure_p))

```

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Without school closure 

fraction.infected_nc_p <- odes_no_closure_p
fraction.infected_nc_p$V1 <- fraction.infected_nc_p$V1/population[1]
fraction.infected_nc_p$V2 <- fraction.infected_nc_p$V2/population[2]
fraction.infected_nc_p$V3 <- fraction.infected_nc_p$V3/population[3]
fraction.infected_nc_p$V4 <- fraction.infected_nc_p$V4/population[4]
fraction.infected_nc_p$V5 <- fraction.infected_nc_p$V5/population[5]
fraction.infected_nc_p$V6 <- fraction.infected_nc_p$V6/population[6]
fraction.infected_nc_p$V7 <- fraction.infected_nc_p$V7/population[7]
fraction.infected_nc_p$V8 <- fraction.infected_nc_p$V8/population[8]
fraction.infected_nc_p$V9 <- fraction.infected_nc_p$V9/population[9]
fraction.infected_nc_p$V10 <- fraction.infected_nc_p$V10/population[10]
fraction.infected_nc_p$V11 <- fraction.infected_nc_p$V11/population[11]
fraction.infected_nc_p$V12 <- fraction.infected_nc_p$V12/population[12]
fraction.infected_nc_p$V13 <- fraction.infected_nc_p$V13/population[13]
fraction.infected_nc_p$V14 <- fraction.infected_nc_p$V14/population[14]

#With school closure 

fraction.infected_c_p <- odes_closure_p
fraction.infected_c_p$V1 <- fraction.infected_c_p$V1/population[1]
fraction.infected_c_p$V2 <- fraction.infected_c_p$V2/population[2]
fraction.infected_c_p$V3 <- fraction.infected_c_p$V3/population[3]
fraction.infected_c_p$V4 <- fraction.infected_c_p$V4/population[4]
fraction.infected_c_p$V5 <- fraction.infected_c_p$V5/population[5]
fraction.infected_c_p$V6 <- fraction.infected_c_p$V6/population[6]
fraction.infected_c_p$V7 <- fraction.infected_c_p$V7/population[7]
fraction.infected_c_p$V8 <- fraction.infected_c_p$V8/population[8]
fraction.infected_c_p$V9 <- fraction.infected_c_p$V9/population[9]
fraction.infected_c_p$V10 <- fraction.infected_c_p$V10/population[10]
fraction.infected_c_p$V11 <- fraction.infected_c_p$V11/population[11]
fraction.infected_c_p$V12 <- fraction.infected_c_p$V12/population[12]
fraction.infected_c_p$V13 <- fraction.infected_c_p$V13/population[13]
fraction.infected_c_p$V14 <- fraction.infected_c_p$V14/population[14]

#Graphic for age group <0-2>

fraction.infected_0_2_p <- NULL
fraction.infected_0_2_p$Time <- odes_no_closure_p$Time
fraction.infected_0_2_p$V1 <- odes_no_closure_p$V1
fraction.infected_0_2_p$V2 <- odes_closure_p$V1
fraction.infected_0_2_p$V3 <- odes_no_closure_p$V8
fraction.infected_0_2_p$V4 <- odes_closure_p$V8

fraction.infected_0_2_p <-data.frame(fraction.infected_0_2_p)

ggplot( data=fraction.infected_0_2_p ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 0-2 low risk")

ggplot( data=fraction.infected_0_2_p ) + geom_line( aes(x=Time, y=V3, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 0-2 high risk")

#Graphic for age group <3-18>

fraction.infected_3_5_p <- NULL
fraction.infected_3_5_p$Time <- odes_no_closure_p$Time
fraction.infected_3_5_p$V1 <- odes_no_closure_p$V2
fraction.infected_3_5_p$V2 <- odes_closure_p$V2
fraction.infected_3_5_p$V3 <- odes_no_closure_p$V9
fraction.infected_3_5_p$V4 <- odes_closure_p$V9

fraction.infected_3_5_p <-data.frame(fraction.infected_3_5_p)

fraction.infected_6_12_p <- NULL
fraction.infected_6_12_p$Time <- odes_no_closure_p$Time
fraction.infected_6_12_p$V1 <- odes_no_closure_p$V3
fraction.infected_6_12_p$V2 <- odes_closure_p$V3
fraction.infected_6_12_p$V3 <- odes_no_closure_p$V10
fraction.infected_6_12_p$V4 <- odes_closure_p$V10

fraction.infected_6_12_p <-data.frame(fraction.infected_6_12_p)

fraction.infected_13_16_p <- NULL
fraction.infected_13_16_p$Time <- odes_no_closure_p$Time
fraction.infected_13_16_p$V1 <- odes_no_closure_p$V4
fraction.infected_13_16_p$V2 <- odes_closure_p$V4
fraction.infected_13_16_p$V3 <- odes_no_closure_p$V11
fraction.infected_13_16_p$V4 <- odes_closure_p$V11

fraction.infected_13_16_p <-data.frame(fraction.infected_13_16_p)

fraction.infected_17_18_p <- NULL
fraction.infected_17_18_p$Time <- odes_no_closure_p$Time
fraction.infected_17_18_p$V1 <- odes_no_closure_p$V5
fraction.infected_17_18_p$V2 <- odes_closure_p$V5
fraction.infected_17_18_p$V3 <- odes_no_closure_p$V12
fraction.infected_17_18_p$V4 <- odes_closure_p$V12

fraction.infected_17_18_p <-data.frame(fraction.infected_17_18_p)

fraction.infected_3_18_p <- NULL
fraction.infected_3_18_p$Time <- odes_no_closure_p$Time
fraction.infected_3_18_p$V1<-rowSums(data.frame(fraction.infected_3_5_p$V1,fraction.infected_6_12_p$V1,fraction.infected_13_16_p$V1,fraction.infected_17_18_p$V1))
fraction.infected_3_18_p$V2 <- rowSums(data.frame(fraction.infected_3_5_p$V2,fraction.infected_6_12_p$V2,fraction.infected_13_16_p$V2,fraction.infected_17_18_p$V2))
fraction.infected_3_18_p$V3<-rowSums(data.frame(fraction.infected_3_5_p$V3,fraction.infected_6_12_p$V3,fraction.infected_13_16_p$V3,fraction.infected_17_18_p$V3))
fraction.infected_3_18_p$V4 <- rowSums(data.frame(fraction.infected_3_5_p$V4,fraction.infected_6_12_p$V4,fraction.infected_13_16_p$V4,fraction.infected_17_18_p$V4))

fraction.infected_3_18_p <-data.frame(fraction.infected_3_18_p)

ggplot( data=fraction.infected_3_18_p ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="3-18 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 3-18 low risk")

ggplot( data=fraction.infected_3_18_p ) + geom_line( aes(x=Time, y=V3, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time,y=V4, colour="3-18 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 3-18 high risk")

#Graphic for age group <19-64>

fraction.infected_19_64_p <- NULL
fraction.infected_19_64_p$Time <- odes_no_closure_p$Time
fraction.infected_19_64_p$V1 <- odes_no_closure_p$V6
fraction.infected_19_64_p$V2 <- odes_closure_p$V6
fraction.infected_19_64_p$V3 <- odes_no_closure_p$V13
fraction.infected_19_64_p$V4 <- odes_closure_p$V13

fraction.infected_19_64_p <-data.frame(fraction.infected_19_64_p)

ggplot( data=fraction.infected_19_64_p ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="19-64 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 19-64 low risk")

ggplot( data=fraction.infected_19_64_p ) + geom_line( aes(x=Time, y=V3, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time,y=V4, colour="19-64 with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 19-64 high risk")

#Graphic for age group <65+>

fraction.infected_65_p <- NULL
fraction.infected_65_p$Time <- odes_no_closure_p$Time
fraction.infected_65_p$V1 <- odes_no_closure_p$V7
fraction.infected_65_p$V2 <- odes_closure_p$V7
fraction.infected_65_p$V3 <- odes_no_closure_p$V14
fraction.infected_65_p$V4 <- odes_closure_p$V14

fraction.infected_65_p <-data.frame(fraction.infected_65_p)

ggplot( data=fraction.infected_65_p ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time,y=V2, colour="65+ with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 65+ low risk")

ggplot( data=fraction.infected_65_p ) + geom_line( aes(x=Time, y=V3, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time,y=V4, colour="65+ with school closure") )  + 
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure"),
                      values = c("red","blue")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 65+ high risk")

```

We can see that in case of pandemic flu, school closure reduces the number of people infected and slightly delays the peak of the outbreak of the epidemy. 

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

### For low risk people 

```{r}

#Age group <0-2> 

nc_p_area_0_2 <- sum(fraction.infected_0_2_p$V1)
c_p_area_0_2 <- sum(fraction.infected_0_2_p$V2)
diff_area_p_0_2 <- nc_p_area_0_2 - c_p_area_0_2

#Age group <3-5> 

nc_p_area_3_5 <- sum(fraction.infected_3_5_p$V1)
c_p_area_3_5 <-sum(fraction.infected_3_5_p$V2)
diff_area_p_3_5 <- nc_p_area_3_5 - c_p_area_3_5

#Age group <6-12> 

nc_p_area_6_12 <- sum(fraction.infected_6_12_p$V1)
c_p_area_6_12 <- sum(fraction.infected_6_12_p$V2)
diff_area_p_6_12 <- nc_p_area_6_12 - c_p_area_6_12

#Age group <13-16> 

nc_p_area_13_16 <- sum(fraction.infected_13_16_p$V1)
c_p_area_13_16 <- sum(fraction.infected_13_16_p$V2)
diff_area_p_13_16 <- nc_p_area_13_16 - c_p_area_13_16

#Age group <17-18> 

nc_p_area_17_18 <- sum(fraction.infected_17_18_p$V1)
c_p_area_17_18 <- sum(fraction.infected_17_18_p$V2)
diff_area_p_17_18 <- nc_p_area_17_18 - c_p_area_17_18

#Age group <19-64> 

nc_p_area_19_64 <- sum(fraction.infected_19_64_p$V1)
c_p_area_19_64 <- sum(fraction.infected_19_64_p$V2)
diff_area_p_19_64 <- nc_p_area_19_64 - c_p_area_19_64

#Age group <65+> 

nc_p_area_65 <- sum(fraction.infected_65_p$V1)
c_p_area_65 <- sum(fraction.infected_65_p$V2)
diff_area_p_65 <- nc_p_area_65 - c_p_area_65

#Results in a table 
Total_Reduction_p_results <- data.frame(
  Total_infected_no_school_closure = c(nc_p_area_0_2,nc_p_area_3_5,nc_p_area_6_12,nc_p_area_13_16,nc_p_area_17_18,nc_p_area_19_64,nc_p_area_65),
  Total_infected_school_closure = c(c_p_area_0_2,c_p_area_3_5,c_p_area_6_12,c_p_area_13_16,c_p_area_17_18,c_p_area_19_64,c_p_area_65),
  Reduction = c(diff_area_p_0_2,diff_area_p_3_5,diff_area_p_6_12,diff_area_p_13_16,diff_area_p_17_18,diff_area_p_19_64,diff_area_p_65),
  Reduction_percentage = c(diff_area_p_0_2*100/nc_p_area_0_2,diff_area_p_3_5*100/nc_p_area_3_5,diff_area_p_6_12*100/nc_p_area_6_12,diff_area_p_13_16*100/nc_p_area_13_16,diff_area_p_17_18*100/nc_p_area_17_18,diff_area_p_19_64*100/nc_p_area_19_64,diff_area_p_65*100/nc_p_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_p_results)

```

We can conclude that the total number of people has been reduced by between 3% and 32%. 

### For high risk people 

```{r}

#Age group <0-2> 

nc_p_area_0_2 <- sum(fraction.infected_0_2_p$V3)
c_p_area_0_2 <- sum(fraction.infected_0_2_p$V4)
diff_area_p_0_2 <- nc_p_area_0_2 - c_p_area_0_2

#Age group <3-5> 

nc_p_area_3_5 <- sum(fraction.infected_3_5_p$V3)
c_p_area_3_5 <-sum(fraction.infected_3_5_p$V4)
diff_area_p_3_5 <- nc_p_area_3_5 - c_p_area_3_5

#Age group <6-12> 

nc_p_area_6_12 <- sum(fraction.infected_6_12_p$V3)
c_p_area_6_12 <- sum(fraction.infected_6_12_p$V4)
diff_area_p_6_12 <- nc_p_area_6_12 - c_p_area_6_12

#Age group <13-16> 

nc_p_area_13_16 <- sum(fraction.infected_13_16_p$V3)
c_p_area_13_16 <- sum(fraction.infected_13_16_p$V4)
diff_area_p_13_16 <- nc_p_area_13_16 - c_p_area_13_16

#Age group <17-18> 

nc_p_area_17_18 <- sum(fraction.infected_17_18_p$V3)
c_p_area_17_18 <- sum(fraction.infected_17_18_p$V4)
diff_area_p_17_18 <- nc_p_area_17_18 - c_p_area_17_18

#Age group <19-64> 

nc_p_area_19_64 <- sum(fraction.infected_19_64_p$V3)
c_p_area_19_64 <- sum(fraction.infected_19_64_p$V4)
diff_area_p_19_64 <- nc_p_area_19_64 - c_p_area_19_64

#Age group <65+> 

nc_p_area_65 <- sum(fraction.infected_65_p$V3)
c_p_area_65 <- sum(fraction.infected_65_p$V4)
diff_area_p_65 <- nc_p_area_65 - c_p_area_65

#Results in a table 
Total_Reduction_p_results <- data.frame(
  Total_infected_no_school_closure = c(nc_p_area_0_2,nc_p_area_3_5,nc_p_area_6_12,nc_p_area_13_16,nc_p_area_17_18,nc_p_area_19_64,nc_p_area_65),
  Total_infected_school_closure = c(c_p_area_0_2,c_p_area_3_5,c_p_area_6_12,c_p_area_13_16,c_p_area_17_18,c_p_area_19_64,c_p_area_65),
  Reduction = c(diff_area_p_0_2,diff_area_p_3_5,diff_area_p_6_12,diff_area_p_13_16,diff_area_p_17_18,diff_area_p_19_64,diff_area_p_65),
  Reduction_percentage = c(diff_area_p_0_2*100/nc_p_area_0_2,diff_area_p_3_5*100/nc_p_area_3_5,diff_area_p_6_12*100/nc_p_area_6_12,diff_area_p_13_16*100/nc_p_area_13_16,diff_area_p_17_18*100/nc_p_area_17_18,diff_area_p_19_64*100/nc_p_area_19_64,diff_area_p_65*100/nc_p_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_p_results)

```

We can conclude that the total number of people has been reduced by between 2% and 21%. 

Now, we will calculate the delay of the peak of outbreak thanks to school closure. 

### For low risk people 

```{r}

#Age group <0-2> 

nc_p_i_max_0_2 <- which.max(fraction.infected_0_2_p$V1)
c_p_i_max_0_2 <- which.max(fraction.infected_0_2_p$V2)
nc_p_t_i_max_0_2 <- fraction.infected_0_2_p$Time[nc_p_i_max_0_2]
c_p_t_i_max_0_2 <- fraction.infected_0_2_p$Time[c_p_i_max_0_2]
delay_p_0_2 <- c_p_t_i_max_0_2 - nc_p_t_i_max_0_2

#Age group <3-5> 

nc_p_i_max_3_5 <- which.max(fraction.infected_3_5_p$V1)
c_p_i_max_3_5 <- which.max(fraction.infected_3_5_p$V2)
nc_p_t_i_max_3_5 <- fraction.infected_3_5_p$Time[nc_p_i_max_3_5]
c_p_t_i_max_3_5 <- fraction.infected_3_5_p$Time[c_p_i_max_3_5]
delay_p_3_5 <- c_p_t_i_max_3_5 - nc_p_t_i_max_3_5

#Age group <6-12> 

nc_p_i_max_6_12 <- which.max(fraction.infected_6_12_p$V1)
c_p_i_max_6_12 <- which.max(fraction.infected_6_12_p$V2)
nc_p_t_i_max_6_12 <- fraction.infected_6_12_p$Time[nc_p_i_max_6_12]
c_p_t_i_max_6_12 <- fraction.infected_6_12_p$Time[c_p_i_max_6_12]
delay_p_6_12 <- c_p_t_i_max_6_12 - nc_p_t_i_max_6_12

#Age group <13-16> 

nc_p_i_max_13_16 <- which.max(fraction.infected_13_16_p$V1)
c_p_i_max_13_16 <- which.max(fraction.infected_13_16_p$V2)
nc_p_t_i_max_13_16 <- fraction.infected_13_16_p$Time[nc_p_i_max_13_16]
c_p_t_i_max_13_16 <- fraction.infected_13_16_p$Time[c_p_i_max_13_16]
delay_p_13_16 <- c_p_t_i_max_13_16 - nc_p_t_i_max_13_16

#Age group <17-18> 

nc_p_i_max_17_18 <- which.max(fraction.infected_17_18_p$V1)
c_p_i_max_17_18 <- which.max(fraction.infected_17_18_p$V2)
nc_p_t_i_max_17_18 <- fraction.infected_17_18_p$Time[nc_p_i_max_17_18]
c_p_t_i_max_17_18 <- fraction.infected_17_18_p$Time[c_p_i_max_17_18]
delay_p_17_18 <- c_p_t_i_max_17_18 - nc_p_t_i_max_17_18

#Age group <19-64> 

nc_p_i_max_19_64 <- which.max(fraction.infected_19_64_p$V1)
c_p_i_max_19_64 <- which.max(fraction.infected_19_64_p$V2)
nc_p_t_i_max_19_64 <- fraction.infected_19_64_p$Time[nc_p_i_max_19_64]
c_p_t_i_max_19_64 <- fraction.infected_19_64_p$Time[c_p_i_max_19_64]
delay_p_19_64 <- c_p_t_i_max_19_64 - nc_p_t_i_max_19_64

#Age group <65+> 

nc_p_i_max_65 <- which.max(fraction.infected_65_p$V1)
c_p_i_max_65 <- which.max(fraction.infected_65_p$V2)
nc_p_t_i_max_65 <- fraction.infected_65_p$Time[nc_p_i_max_65]
c_p_t_i_max_65 <- fraction.infected_0_2_p$Time[c_p_i_max_65]
delay_p_65 <- c_p_t_i_max_65 - nc_p_t_i_max_65

#Results in a table 
Delay_outbreak_p_results <- data.frame(
  Peak_outbreak_no_school_closure = c(nc_p_t_i_max_0_2,nc_p_t_i_max_3_5,nc_p_t_i_max_6_12,nc_p_t_i_max_13_16,nc_p_t_i_max_17_18,nc_p_t_i_max_19_64,nc_p_t_i_max_65),
  Peak_outbreak_school_closure = c(c_p_t_i_max_0_2,c_p_t_i_max_3_5,c_p_t_i_max_6_12,c_p_t_i_max_13_16,c_p_t_i_max_17_18,c_p_t_i_max_19_64,c_p_t_i_max_65),
  Delay_peak_outbreak = c(delay_p_0_2,delay_p_3_5,delay_p_6_12,delay_p_13_16,delay_p_17_18,delay_p_19_64,delay_p_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Delay_outbreak_p_results)

```

Only the peak outbreak of the age group <0-2> and <17-18> (High school) has been delayed by school closure of 7 days. The others peak were not delayed by school closure, however thanks to it its value is much lower.

### For high risk people 

```{r}

#Age group <0-2> 

nc_p_i_max_0_2 <- which.max(fraction.infected_0_2_p$V3)
c_p_i_max_0_2 <- which.max(fraction.infected_0_2_p$V4)
nc_p_t_i_max_0_2 <- fraction.infected_0_2_p$Time[nc_p_i_max_0_2]
c_p_t_i_max_0_2 <- fraction.infected_0_2_p$Time[c_p_i_max_0_2]
delay_p_0_2 <- c_p_t_i_max_0_2 - nc_p_t_i_max_0_2

#Age group <3-5> 

nc_p_i_max_3_5 <- which.max(fraction.infected_3_5_p$V3)
c_p_i_max_3_5 <- which.max(fraction.infected_3_5_p$V4)
nc_p_t_i_max_3_5 <- fraction.infected_3_5_p$Time[nc_p_i_max_3_5]
c_p_t_i_max_3_5 <- fraction.infected_3_5_p$Time[c_p_i_max_3_5]
delay_p_3_5 <- c_p_t_i_max_3_5 - nc_p_t_i_max_3_5

#Age group <6-12> 

nc_p_i_max_6_12 <- which.max(fraction.infected_6_12_p$V3)
c_p_i_max_6_12 <- which.max(fraction.infected_6_12_p$V4)
nc_p_t_i_max_6_12 <- fraction.infected_6_12_p$Time[nc_p_i_max_6_12]
c_p_t_i_max_6_12 <- fraction.infected_6_12_p$Time[c_p_i_max_6_12]
delay_p_6_12 <- c_p_t_i_max_6_12 - nc_p_t_i_max_6_12

#Age group <13-16> 

nc_p_i_max_13_16 <- which.max(fraction.infected_13_16_p$V3)
c_p_i_max_13_16 <- which.max(fraction.infected_13_16_p$V4)
nc_p_t_i_max_13_16 <- fraction.infected_13_16_p$Time[nc_p_i_max_13_16]
c_p_t_i_max_13_16 <- fraction.infected_13_16_p$Time[c_p_i_max_13_16]
delay_p_13_16 <- c_p_t_i_max_13_16 - nc_p_t_i_max_13_16

#Age group <17-18> 

nc_p_i_max_17_18 <- which.max(fraction.infected_17_18_p$V3)
c_p_i_max_17_18 <- which.max(fraction.infected_17_18_p$V4)
nc_p_t_i_max_17_18 <- fraction.infected_17_18_p$Time[nc_p_i_max_17_18]
c_p_t_i_max_17_18 <- fraction.infected_17_18_p$Time[c_p_i_max_17_18]
delay_p_17_18 <- c_p_t_i_max_17_18 - nc_p_t_i_max_17_18

#Age group <19-64> 

nc_p_i_max_19_64 <- which.max(fraction.infected_19_64_p$V3)
c_p_i_max_19_64 <- which.max(fraction.infected_19_64_p$V4)
nc_p_t_i_max_19_64 <- fraction.infected_19_64_p$Time[nc_p_i_max_19_64]
c_p_t_i_max_19_64 <- fraction.infected_19_64_p$Time[c_p_i_max_19_64]
delay_p_19_64 <- c_p_t_i_max_19_64 - nc_p_t_i_max_19_64

#Age group <65+> 

nc_p_i_max_65 <- which.max(fraction.infected_65_p$V3)
c_p_i_max_65 <- which.max(fraction.infected_65_p$V4)
nc_p_t_i_max_65 <- fraction.infected_65_p$Time[nc_p_i_max_65]
c_p_t_i_max_65 <- fraction.infected_0_2_p$Time[c_p_i_max_65]
delay_p_65 <- c_p_t_i_max_65 - nc_p_t_i_max_65

#Results in a table 
Delay_outbreak_p_results <- data.frame(
  Peak_outbreak_no_school_closure = c(nc_p_t_i_max_0_2,nc_p_t_i_max_3_5,nc_p_t_i_max_6_12,nc_p_t_i_max_13_16,nc_p_t_i_max_17_18,nc_p_t_i_max_19_64,nc_p_t_i_max_65),
  Peak_outbreak_school_closure = c(c_p_t_i_max_0_2,c_p_t_i_max_3_5,c_p_t_i_max_6_12,c_p_t_i_max_13_16,c_p_t_i_max_17_18,c_p_t_i_max_19_64,c_p_t_i_max_65),
  Delay_peak_outbreak = c(delay_p_0_2,delay_p_3_5,delay_p_6_12,delay_p_13_16,delay_p_17_18,delay_p_19_64,delay_p_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Delay_outbreak_p_results)

```

Only the peak outbreak of the age group <0-2>, <3-5> (Primary school) and <17-18> (High school) has been delayed by school closure of 7 days. The others peak were not delayed by school closure, however thanks to it its value is much lower.

#  Study of the impact of the date of beginning of school closure  

We will now change the `date_begin_closure` to see the impact of this changement and study whether it is better to have an early school closure or to wait a little before starting it. 

We will keep the same example as before of an epidemy starting on the 23rd of September. 

## For seasonal flu 

We will test 4 different `date_begin_closure` : 

- "2007-09-26": 3 days after the beginning of the epidemy 
- "2007-09-30": a week after the beginning of the epidemy 
- "2007-10-07": 2 weeks after the beginning of the epidemy 
- "2007-10-23": a month after the beginning of the epidemy 

All these school closure will last for one month. 

We will plot one graphic for each of the following age groups : <0-2>, <3-18>, <19-64>, <65+>. 

Each graphic will have five curves: the one without school closure and the four school closure simulations for the four beginning dates. 

```{r}

#Result in case of no school closure 

odes_no_closure_s <- infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7)

#Result in case of school closure from 2007-09-26 to 2007-10-26

odes_closure_s_3d <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-26"), date_end_closure = as.Date(" 2007-10-26"))

#Result in case of school closure from 2007-09-30 to 2007-10-30

odes_closure_s_1w <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-30"))

#Result in case of school closure from 2007-10-07 to 2007-11-07

odes_closure_s_2w <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-10-07"), date_end_closure = as.Date(" 2007-11-07"))

#Result in case of school closure from 2007-10-23 to 2007-11-23

odes_closure_s_1m <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-10-23"), date_end_closure = as.Date(" 2007-11-23"))

```

### For low risk people 

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_s <- NULL
fraction.infected_0_2_s$Time <- odes_no_closure_s$Time
fraction.infected_0_2_s$V1 <- odes_no_closure_s$V1
fraction.infected_0_2_s$V2 <- odes_closure_s_3d$V1
fraction.infected_0_2_s$V3 <- odes_closure_s_1w$V1
fraction.infected_0_2_s$V4 <- odes_closure_s_2w$V1
fraction.infected_0_2_s$V5 <- odes_closure_s_1m$V1

fraction.infected_0_2_s <-data.frame(fraction.infected_0_2_s)

ggplot( data=fraction.infected_0_2_s ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure after 3 days","0-2 with school closure after 1 week","0-2 with school closure after 2 weeks","0-2 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_s <- NULL
fraction.infected_3_5_s$Time <- odes_no_closure_s$Time
fraction.infected_3_5_s$V1 <- odes_no_closure_s$V2
fraction.infected_3_5_s$V2 <- odes_closure_s_3d$V2
fraction.infected_3_5_s$V3 <- odes_closure_s_1w$V2
fraction.infected_3_5_s$V4 <- odes_closure_s_2w$V2
fraction.infected_3_5_s$V5 <- odes_closure_s_1m$V2

fraction.infected_3_5_s <-data.frame(fraction.infected_3_5_s)

fraction.infected_6_12_s <- NULL
fraction.infected_6_12_s$Time <- odes_no_closure_s$Time
fraction.infected_6_12_s$V1 <- odes_no_closure_s$V3
fraction.infected_6_12_s$V2 <- odes_closure_s_3d$V3
fraction.infected_6_12_s$V3 <- odes_closure_s_1w$V3
fraction.infected_6_12_s$V4 <- odes_closure_s_2w$V3
fraction.infected_6_12_s$V5 <- odes_closure_s_1m$V3

fraction.infected_6_12_s <-data.frame(fraction.infected_6_12_s)

fraction.infected_13_16_s <- NULL
fraction.infected_13_16_s$Time <- odes_no_closure_s$Time
fraction.infected_13_16_s$V1 <- odes_no_closure_s$V4
fraction.infected_13_16_s$V2 <- odes_closure_s_3d$V4
fraction.infected_13_16_s$V3 <- odes_closure_s_1w$V4
fraction.infected_13_16_s$V4 <- odes_closure_s_2w$V4
fraction.infected_13_16_s$V5 <- odes_closure_s_1m$V4

fraction.infected_13_16_s <-data.frame(fraction.infected_13_16_s)

fraction.infected_17_18_s <- NULL
fraction.infected_17_18_s$Time <- odes_no_closure_s$Time
fraction.infected_17_18_s$V1 <- odes_no_closure_s$V5
fraction.infected_17_18_s$V2 <- odes_closure_s_3d$V5
fraction.infected_17_18_s$V3 <- odes_closure_s_1w$V5
fraction.infected_17_18_s$V4 <- odes_closure_s_2w$V5
fraction.infected_17_18_s$V5 <- odes_closure_s_1m$V5

fraction.infected_17_18_s <-data.frame(fraction.infected_17_18_s)

fraction.infected_3_18_s <- NULL
fraction.infected_3_18_s$Time <- odes_no_closure_s$Time
fraction.infected_3_18_s$V1<-rowSums(data.frame(fraction.infected_3_5_s$V1,fraction.infected_6_12_s$V1,fraction.infected_13_16_s$V1,fraction.infected_17_18_s$V1))
fraction.infected_3_18_s$V2 <- rowSums(data.frame(fraction.infected_3_5_s$V2,fraction.infected_6_12_s$V2,fraction.infected_13_16_s$V2,fraction.infected_17_18_s$V2))
fraction.infected_3_18_s$V3 <- rowSums(data.frame(fraction.infected_3_5_s$V3,fraction.infected_6_12_s$V3,fraction.infected_13_16_s$V3,fraction.infected_17_18_s$V3))
fraction.infected_3_18_s$V4 <- rowSums(data.frame(fraction.infected_3_5_s$V4,fraction.infected_6_12_s$V4,fraction.infected_13_16_s$V4,fraction.infected_17_18_s$V4))
fraction.infected_3_18_s$V5 <- rowSums(data.frame(fraction.infected_3_5_s$V5,fraction.infected_6_12_s$V5,fraction.infected_13_16_s$V5,fraction.infected_17_18_s$V5))

fraction.infected_3_18_s <-data.frame(fraction.infected_3_18_s)

ggplot( data=fraction.infected_3_18_s ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure after 3 days","3-18 with school closure after 1 week","3-18 with school closure after 2 weeks","3-18 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_s <- NULL
fraction.infected_19_64_s$Time <- odes_no_closure_s$Time
fraction.infected_19_64_s$V1 <- odes_no_closure_s$V6
fraction.infected_19_64_s$V2 <- odes_closure_s_3d$V6
fraction.infected_19_64_s$V3 <- odes_closure_s_1w$V6
fraction.infected_19_64_s$V4 <- odes_closure_s_2w$V6
fraction.infected_19_64_s$V5 <- odes_closure_s_1m$V6

fraction.infected_19_64_s <-data.frame(fraction.infected_19_64_s)

ggplot( data=fraction.infected_19_64_s ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure after 3 days","19-64 with school closure after 1 week","19-64 with school closure after 2 weeks","19-64 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_s <- NULL
fraction.infected_65_s$Time <- odes_no_closure_s$Time
fraction.infected_65_s$V1 <- odes_no_closure_s$V7
fraction.infected_65_s$V2 <- odes_closure_s_3d$V7
fraction.infected_65_s$V3 <- odes_closure_s_1w$V7
fraction.infected_65_s$V4 <- odes_closure_s_2w$V7
fraction.infected_65_s$V5 <- odes_closure_s_1m$V7

fraction.infected_65_s <-data.frame(fraction.infected_65_s)

ggplot( data=fraction.infected_65_s ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure after 3 days","65+ with school closure after 1 week","65+ with school closure after 2 weeks","65+ with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 65+")

```

We can see with these graphics that the earlier the school closure begins, the better. Indeed, the lower the number of people infected is for the school closure 3 days after the beginning of the epidemy. 

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_s_area_0_2 <- sum(fraction.infected_0_2_s$V1)
c_s_area_0_2_3d <- sum(fraction.infected_0_2_s$V2)
c_s_area_0_2_1w <- sum(fraction.infected_0_2_s$V3)
c_s_area_0_2_2w <- sum(fraction.infected_0_2_s$V4)
c_s_area_0_2_1m <- sum(fraction.infected_0_2_s$V5)
diff_area_s_0_2_3d <- nc_s_area_0_2 - c_s_area_0_2_3d
diff_area_s_0_2_1w <- nc_s_area_0_2 - c_s_area_0_2_1w
diff_area_s_0_2_2w <- nc_s_area_0_2 - c_s_area_0_2_2w
diff_area_s_0_2_1m <- nc_s_area_0_2 - c_s_area_0_2_1m

#Age group <3-5> 

nc_s_area_3_5 <- sum(fraction.infected_3_5_s$V1)
c_s_area_3_5_3d <- sum(fraction.infected_3_5_s$V2)
c_s_area_3_5_1w <- sum(fraction.infected_3_5_s$V3)
c_s_area_3_5_2w <- sum(fraction.infected_3_5_s$V4)
c_s_area_3_5_1m <- sum(fraction.infected_3_5_s$V5)
diff_area_s_3_5_3d <- nc_s_area_3_5 - c_s_area_3_5_3d
diff_area_s_3_5_1w <- nc_s_area_3_5 - c_s_area_3_5_1w
diff_area_s_3_5_2w <- nc_s_area_3_5 - c_s_area_3_5_2w
diff_area_s_3_5_1m <- nc_s_area_3_5 - c_s_area_3_5_1m

#Age group <6-12> 

nc_s_area_6_12 <- sum(fraction.infected_6_12_s$V1)
c_s_area_6_12_3d <- sum(fraction.infected_6_12_s$V2)
c_s_area_6_12_1w <- sum(fraction.infected_6_12_s$V3)
c_s_area_6_12_2w <- sum(fraction.infected_6_12_s$V4)
c_s_area_6_12_1m <- sum(fraction.infected_6_12_s$V5)
diff_area_s_6_12_3d <- nc_s_area_6_12 - c_s_area_6_12_3d
diff_area_s_6_12_1w <- nc_s_area_6_12 - c_s_area_6_12_1w
diff_area_s_6_12_2w <- nc_s_area_6_12 - c_s_area_6_12_2w
diff_area_s_6_12_1m <- nc_s_area_6_12 - c_s_area_6_12_1m

#Age group <13-16> 

nc_s_area_13_16 <- sum(fraction.infected_13_16_s$V1)
c_s_area_13_16_3d <- sum(fraction.infected_13_16_s$V2)
c_s_area_13_16_1w <- sum(fraction.infected_13_16_s$V3)
c_s_area_13_16_2w <- sum(fraction.infected_13_16_s$V4)
c_s_area_13_16_1m <- sum(fraction.infected_13_16_s$V5)
diff_area_s_13_16_3d <- nc_s_area_13_16 - c_s_area_13_16_3d
diff_area_s_13_16_1w <- nc_s_area_13_16 - c_s_area_13_16_1w
diff_area_s_13_16_2w <- nc_s_area_13_16 - c_s_area_13_16_2w
diff_area_s_13_16_1m <- nc_s_area_13_16 - c_s_area_13_16_1m

#Age group <17-18> 

nc_s_area_17_18 <- sum(fraction.infected_17_18_s$V1)
c_s_area_17_18_3d <- sum(fraction.infected_17_18_s$V2)
c_s_area_17_18_1w <- sum(fraction.infected_17_18_s$V3)
c_s_area_17_18_2w <- sum(fraction.infected_17_18_s$V4)
c_s_area_17_18_1m <- sum(fraction.infected_17_18_s$V5)
diff_area_s_17_18_3d <- nc_s_area_17_18 - c_s_area_17_18_3d
diff_area_s_17_18_1w <- nc_s_area_17_18 - c_s_area_17_18_1w
diff_area_s_17_18_2w <- nc_s_area_17_18 - c_s_area_17_18_2w
diff_area_s_17_18_1m <- nc_s_area_17_18 - c_s_area_17_18_1m

#Age group <19-64> 

nc_s_area_19_64 <- sum(fraction.infected_19_64_s$V1)
c_s_area_19_64_3d <- sum(fraction.infected_19_64_s$V2)
c_s_area_19_64_1w <- sum(fraction.infected_19_64_s$V3)
c_s_area_19_64_2w <- sum(fraction.infected_19_64_s$V4)
c_s_area_19_64_1m <- sum(fraction.infected_19_64_s$V5)
diff_area_s_19_64_3d <- nc_s_area_19_64 - c_s_area_19_64_3d
diff_area_s_19_64_1w <- nc_s_area_19_64 - c_s_area_19_64_1w
diff_area_s_19_64_2w <- nc_s_area_19_64 - c_s_area_19_64_2w
diff_area_s_19_64_1m <- nc_s_area_19_64 - c_s_area_19_64_1m

#Age group <65+> 

nc_s_area_65 <- sum(fraction.infected_65_s$V1)
c_s_area_65_3d <- sum(fraction.infected_65_s$V2)
c_s_area_65_1w <- sum(fraction.infected_65_s$V3)
c_s_area_65_2w <- sum(fraction.infected_65_s$V4)
c_s_area_65_1m <- sum(fraction.infected_65_s$V5)
diff_area_s_65_3d <- nc_s_area_65 - c_s_area_65_3d
diff_area_s_65_1w <- nc_s_area_65 - c_s_area_65_1w
diff_area_s_65_2w <- nc_s_area_65 - c_s_area_65_2w
diff_area_s_65_1m <- nc_s_area_65 - c_s_area_65_1m

#Results in a table 
Total_Reduction_s_results <- data.frame(
  Total_infected_no_school_closure = c(nc_s_area_0_2,nc_s_area_3_5,nc_s_area_6_12,nc_s_area_13_16,nc_s_area_17_18,nc_s_area_19_64,nc_s_area_65),
  Total_infected_school_closure_3_days = c(c_s_area_0_2_3d,c_s_area_3_5_3d,c_s_area_6_12_3d,c_s_area_13_16_3d,c_s_area_17_18_3d,c_s_area_19_64_3d,c_s_area_65_3d),
  Reduction_3_days = c(diff_area_s_0_2_3d,diff_area_s_3_5_3d,diff_area_s_6_12_3d,diff_area_s_13_16_3d,diff_area_s_17_18_3d,diff_area_s_19_64_3d,diff_area_s_65_3d),
  Reduction_percentage_3_days = c(diff_area_s_0_2_3d*100/nc_s_area_0_2,diff_area_s_3_5_3d*100/nc_s_area_3_5,diff_area_s_6_12_3d*100/nc_s_area_6_12,diff_area_s_13_16_3d*100/nc_s_area_13_16,diff_area_s_17_18_3d*100/nc_s_area_17_18,diff_area_s_19_64_3d*100/nc_s_area_19_64,diff_area_s_65_3d*100/nc_s_area_65),
  Total_infected_school_closure_1_week = c(c_s_area_0_2_1w,c_s_area_3_5_1w,c_s_area_6_12_1w,c_s_area_13_16_1w,c_s_area_17_18_1w,c_s_area_19_64_1w,c_s_area_65_1w),
  Reduction_1_week = c(diff_area_s_0_2_1w,diff_area_s_3_5_1w,diff_area_s_6_12_1w,diff_area_s_13_16_1w,diff_area_s_17_18_1w,diff_area_s_19_64_1w,diff_area_s_65_1w),
  Reduction_percentage_1_week = c(diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_65_1w*100/nc_s_area_65),
  Total_infected_school_closure_2_weeks = c(c_s_area_0_2_2w,c_s_area_3_5_2w,c_s_area_6_12_2w,c_s_area_13_16_2w,c_s_area_17_18_2w,c_s_area_19_64_2w,c_s_area_65_2w),
  Reduction_2_weeks = c(diff_area_s_0_2_2w,diff_area_s_3_5_2w,diff_area_s_6_12_2w,diff_area_s_13_16_2w,diff_area_s_17_18_2w,diff_area_s_19_64_2w,diff_area_s_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_65_2w*100/nc_s_area_65),
  Total_infected_school_closure_1_month = c(c_s_area_0_2_1m,c_s_area_3_5_1m,c_s_area_6_12_1m,c_s_area_13_16_1m,c_s_area_17_18_1m,c_s_area_19_64_1m,c_s_area_65_1m),
  Reduction_1_month = c(diff_area_s_0_2_1m,diff_area_s_3_5_1m,diff_area_s_6_12_1m,diff_area_s_13_16_1m,diff_area_s_17_18_1m,diff_area_s_19_64_1m,diff_area_s_65_1m),
  Reduction_percentage_1_month = c(diff_area_s_0_2_1m*100/nc_s_area_0_2,diff_area_s_3_5_1m*100/nc_s_area_3_5,diff_area_s_6_12_1m*100/nc_s_area_6_12,diff_area_s_13_16_1m*100/nc_s_area_13_16,diff_area_s_17_18_1m*100/nc_s_area_17_18,diff_area_s_19_64_1m*100/nc_s_area_19_64,diff_area_s_65_1m*100/nc_s_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_s_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_s <- data.frame(
  Date_beginning_closure = c(3,7,14,30),
  Reduction_percentage_0_2 = c(diff_area_s_0_2_3d*100/nc_s_area_0_2,diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_0_2_1m*100/nc_s_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_s_3_5_3d*100/nc_s_area_3_5,diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_3_5_1m*100/nc_s_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_s_6_12_3d*100/nc_s_area_6_12,diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_6_12_1m*100/nc_s_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_s_13_16_3d*100/nc_s_area_13_16,diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_13_16_1m*100/nc_s_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_s_17_18_3d*100/nc_s_area_17_18,diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_17_18_1m*100/nc_s_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_s_19_64_3d*100/nc_s_area_19_64,diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_19_64_1m*100/nc_s_area_19_64),
  Reduction_percentage_65 = c(diff_area_s_65_3d*100/nc_s_area_65,diff_area_s_65_1w*100/nc_s_area_65,diff_area_s_65_2w*100/nc_s_area_65,diff_area_s_65_1m*100/nc_s_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_s ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

We can see with these figures that school closure must be realised as quickly as possible as it becomes rapidly inefficient. Indeed, for a majority of age groups, a school closure 2 weeks after the beginning of the epidemy will only reduce the number of people affected by 1% and a school closure after a month is completely ineficient. 

We can conclude that the best beginning date for school closure is right after the beginning of the epidemy. However, this measure demands time to be put in place and one week after the beginning of the epidemy will probably be the fastest school closure possible. 

### For high risk people 

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_s <- NULL
fraction.infected_0_2_s$Time <- odes_no_closure_s$Time
fraction.infected_0_2_s$V1 <- odes_no_closure_s$V8
fraction.infected_0_2_s$V2 <- odes_closure_s_3d$V8
fraction.infected_0_2_s$V3 <- odes_closure_s_1w$V8
fraction.infected_0_2_s$V4 <- odes_closure_s_2w$V8
fraction.infected_0_2_s$V5 <- odes_closure_s_1m$V8

fraction.infected_0_2_s <-data.frame(fraction.infected_0_2_s)

ggplot( data=fraction.infected_0_2_s ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure after 3 days","0-2 with school closure after 1 week","0-2 with school closure after 2 weeks","0-2 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_s <- NULL
fraction.infected_3_5_s$Time <- odes_no_closure_s$Time
fraction.infected_3_5_s$V1 <- odes_no_closure_s$V9
fraction.infected_3_5_s$V2 <- odes_closure_s_3d$V9
fraction.infected_3_5_s$V3 <- odes_closure_s_1w$V9
fraction.infected_3_5_s$V4 <- odes_closure_s_2w$V9
fraction.infected_3_5_s$V5 <- odes_closure_s_1m$V9

fraction.infected_3_5_s <-data.frame(fraction.infected_3_5_s)

fraction.infected_6_12_s <- NULL
fraction.infected_6_12_s$Time <- odes_no_closure_s$Time
fraction.infected_6_12_s$V1 <- odes_no_closure_s$V10
fraction.infected_6_12_s$V2 <- odes_closure_s_3d$V10
fraction.infected_6_12_s$V3 <- odes_closure_s_1w$V10
fraction.infected_6_12_s$V4 <- odes_closure_s_2w$V10
fraction.infected_6_12_s$V5 <- odes_closure_s_1m$V10

fraction.infected_6_12_s <-data.frame(fraction.infected_6_12_s)

fraction.infected_13_16_s <- NULL
fraction.infected_13_16_s$Time <- odes_no_closure_s$Time
fraction.infected_13_16_s$V1 <- odes_no_closure_s$V11
fraction.infected_13_16_s$V2 <- odes_closure_s_3d$V11
fraction.infected_13_16_s$V3 <- odes_closure_s_1w$V11
fraction.infected_13_16_s$V4 <- odes_closure_s_2w$V11
fraction.infected_13_16_s$V5 <- odes_closure_s_1m$V11

fraction.infected_13_16_s <-data.frame(fraction.infected_13_16_s)

fraction.infected_17_18_s <- NULL
fraction.infected_17_18_s$Time <- odes_no_closure_s$Time
fraction.infected_17_18_s$V1 <- odes_no_closure_s$V12
fraction.infected_17_18_s$V2 <- odes_closure_s_3d$V12
fraction.infected_17_18_s$V3 <- odes_closure_s_1w$V12
fraction.infected_17_18_s$V4 <- odes_closure_s_2w$V12
fraction.infected_17_18_s$V5 <- odes_closure_s_1m$V12

fraction.infected_17_18_s <-data.frame(fraction.infected_17_18_s)

fraction.infected_3_18_s <- NULL
fraction.infected_3_18_s$Time <- odes_no_closure_s$Time
fraction.infected_3_18_s$V1<-rowSums(data.frame(fraction.infected_3_5_s$V1,fraction.infected_6_12_s$V1,fraction.infected_13_16_s$V1,fraction.infected_17_18_s$V1))
fraction.infected_3_18_s$V2 <- rowSums(data.frame(fraction.infected_3_5_s$V2,fraction.infected_6_12_s$V2,fraction.infected_13_16_s$V2,fraction.infected_17_18_s$V2))
fraction.infected_3_18_s$V3 <- rowSums(data.frame(fraction.infected_3_5_s$V3,fraction.infected_6_12_s$V3,fraction.infected_13_16_s$V3,fraction.infected_17_18_s$V3))
fraction.infected_3_18_s$V4 <- rowSums(data.frame(fraction.infected_3_5_s$V4,fraction.infected_6_12_s$V4,fraction.infected_13_16_s$V4,fraction.infected_17_18_s$V4))
fraction.infected_3_18_s$V5 <- rowSums(data.frame(fraction.infected_3_5_s$V5,fraction.infected_6_12_s$V5,fraction.infected_13_16_s$V5,fraction.infected_17_18_s$V5))

fraction.infected_3_18_s <-data.frame(fraction.infected_3_18_s)

ggplot( data=fraction.infected_3_18_s ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure after 3 days","3-18 with school closure after 1 week","3-18 with school closure after 2 weeks","3-18 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_s <- NULL
fraction.infected_19_64_s$Time <- odes_no_closure_s$Time
fraction.infected_19_64_s$V1 <- odes_no_closure_s$V13
fraction.infected_19_64_s$V2 <- odes_closure_s_3d$V13
fraction.infected_19_64_s$V3 <- odes_closure_s_1w$V13
fraction.infected_19_64_s$V4 <- odes_closure_s_2w$V13
fraction.infected_19_64_s$V5 <- odes_closure_s_1m$V13

fraction.infected_19_64_s <-data.frame(fraction.infected_19_64_s)

ggplot( data=fraction.infected_19_64_s ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure after 3 days","19-64 with school closure after 1 week","19-64 with school closure after 2 weeks","19-64 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_s <- NULL
fraction.infected_65_s$Time <- odes_no_closure_s$Time
fraction.infected_65_s$V1 <- odes_no_closure_s$V14
fraction.infected_65_s$V2 <- odes_closure_s_3d$V14
fraction.infected_65_s$V3 <- odes_closure_s_1w$V14
fraction.infected_65_s$V4 <- odes_closure_s_2w$V14
fraction.infected_65_s$V5 <- odes_closure_s_1m$V14

fraction.infected_65_s <-data.frame(fraction.infected_65_s)

ggplot( data=fraction.infected_65_s ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure after 3 days","65+ with school closure after 1 week","65+ with school closure after 2 weeks","65+ with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 65+")

```

We can see with these graphics that the earlier the school closure begins, the better. Indeed, the lower the number of people infected is for the school closure 3 days after the beginning of the epidemy. 

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_s_area_0_2 <- sum(fraction.infected_0_2_s$V1)
c_s_area_0_2_3d <- sum(fraction.infected_0_2_s$V2)
c_s_area_0_2_1w <- sum(fraction.infected_0_2_s$V3)
c_s_area_0_2_2w <- sum(fraction.infected_0_2_s$V4)
c_s_area_0_2_1m <- sum(fraction.infected_0_2_s$V5)
diff_area_s_0_2_3d <- nc_s_area_0_2 - c_s_area_0_2_3d
diff_area_s_0_2_1w <- nc_s_area_0_2 - c_s_area_0_2_1w
diff_area_s_0_2_2w <- nc_s_area_0_2 - c_s_area_0_2_2w
diff_area_s_0_2_1m <- nc_s_area_0_2 - c_s_area_0_2_1m

#Age group <3-5> 

nc_s_area_3_5 <- sum(fraction.infected_3_5_s$V1)
c_s_area_3_5_3d <- sum(fraction.infected_3_5_s$V2)
c_s_area_3_5_1w <- sum(fraction.infected_3_5_s$V3)
c_s_area_3_5_2w <- sum(fraction.infected_3_5_s$V4)
c_s_area_3_5_1m <- sum(fraction.infected_3_5_s$V5)
diff_area_s_3_5_3d <- nc_s_area_3_5 - c_s_area_3_5_3d
diff_area_s_3_5_1w <- nc_s_area_3_5 - c_s_area_3_5_1w
diff_area_s_3_5_2w <- nc_s_area_3_5 - c_s_area_3_5_2w
diff_area_s_3_5_1m <- nc_s_area_3_5 - c_s_area_3_5_1m

#Age group <6-12> 

nc_s_area_6_12 <- sum(fraction.infected_6_12_s$V1)
c_s_area_6_12_3d <- sum(fraction.infected_6_12_s$V2)
c_s_area_6_12_1w <- sum(fraction.infected_6_12_s$V3)
c_s_area_6_12_2w <- sum(fraction.infected_6_12_s$V4)
c_s_area_6_12_1m <- sum(fraction.infected_6_12_s$V5)
diff_area_s_6_12_3d <- nc_s_area_6_12 - c_s_area_6_12_3d
diff_area_s_6_12_1w <- nc_s_area_6_12 - c_s_area_6_12_1w
diff_area_s_6_12_2w <- nc_s_area_6_12 - c_s_area_6_12_2w
diff_area_s_6_12_1m <- nc_s_area_6_12 - c_s_area_6_12_1m

#Age group <13-16> 

nc_s_area_13_16 <- sum(fraction.infected_13_16_s$V1)
c_s_area_13_16_3d <- sum(fraction.infected_13_16_s$V2)
c_s_area_13_16_1w <- sum(fraction.infected_13_16_s$V3)
c_s_area_13_16_2w <- sum(fraction.infected_13_16_s$V4)
c_s_area_13_16_1m <- sum(fraction.infected_13_16_s$V5)
diff_area_s_13_16_3d <- nc_s_area_13_16 - c_s_area_13_16_3d
diff_area_s_13_16_1w <- nc_s_area_13_16 - c_s_area_13_16_1w
diff_area_s_13_16_2w <- nc_s_area_13_16 - c_s_area_13_16_2w
diff_area_s_13_16_1m <- nc_s_area_13_16 - c_s_area_13_16_1m

#Age group <17-18> 

nc_s_area_17_18 <- sum(fraction.infected_17_18_s$V1)
c_s_area_17_18_3d <- sum(fraction.infected_17_18_s$V2)
c_s_area_17_18_1w <- sum(fraction.infected_17_18_s$V3)
c_s_area_17_18_2w <- sum(fraction.infected_17_18_s$V4)
c_s_area_17_18_1m <- sum(fraction.infected_17_18_s$V5)
diff_area_s_17_18_3d <- nc_s_area_17_18 - c_s_area_17_18_3d
diff_area_s_17_18_1w <- nc_s_area_17_18 - c_s_area_17_18_1w
diff_area_s_17_18_2w <- nc_s_area_17_18 - c_s_area_17_18_2w
diff_area_s_17_18_1m <- nc_s_area_17_18 - c_s_area_17_18_1m

#Age group <19-64> 

nc_s_area_19_64 <- sum(fraction.infected_19_64_s$V1)
c_s_area_19_64_3d <- sum(fraction.infected_19_64_s$V2)
c_s_area_19_64_1w <- sum(fraction.infected_19_64_s$V3)
c_s_area_19_64_2w <- sum(fraction.infected_19_64_s$V4)
c_s_area_19_64_1m <- sum(fraction.infected_19_64_s$V5)
diff_area_s_19_64_3d <- nc_s_area_19_64 - c_s_area_19_64_3d
diff_area_s_19_64_1w <- nc_s_area_19_64 - c_s_area_19_64_1w
diff_area_s_19_64_2w <- nc_s_area_19_64 - c_s_area_19_64_2w
diff_area_s_19_64_1m <- nc_s_area_19_64 - c_s_area_19_64_1m

#Age group <65+> 

nc_s_area_65 <- sum(fraction.infected_65_s$V1)
c_s_area_65_3d <- sum(fraction.infected_65_s$V2)
c_s_area_65_1w <- sum(fraction.infected_65_s$V3)
c_s_area_65_2w <- sum(fraction.infected_65_s$V4)
c_s_area_65_1m <- sum(fraction.infected_65_s$V5)
diff_area_s_65_3d <- nc_s_area_65 - c_s_area_65_3d
diff_area_s_65_1w <- nc_s_area_65 - c_s_area_65_1w
diff_area_s_65_2w <- nc_s_area_65 - c_s_area_65_2w
diff_area_s_65_1m <- nc_s_area_65 - c_s_area_65_1m

#Results in a table 
Total_Reduction_s_results <- data.frame(
  Total_infected_no_school_closure = c(nc_s_area_0_2,nc_s_area_3_5,nc_s_area_6_12,nc_s_area_13_16,nc_s_area_17_18,nc_s_area_19_64,nc_s_area_65),
  Total_infected_school_closure_3_days = c(c_s_area_0_2_3d,c_s_area_3_5_3d,c_s_area_6_12_3d,c_s_area_13_16_3d,c_s_area_17_18_3d,c_s_area_19_64_3d,c_s_area_65_3d),
  Reduction_3_days = c(diff_area_s_0_2_3d,diff_area_s_3_5_3d,diff_area_s_6_12_3d,diff_area_s_13_16_3d,diff_area_s_17_18_3d,diff_area_s_19_64_3d,diff_area_s_65_3d),
  Reduction_percentage_3_days = c(diff_area_s_0_2_3d*100/nc_s_area_0_2,diff_area_s_3_5_3d*100/nc_s_area_3_5,diff_area_s_6_12_3d*100/nc_s_area_6_12,diff_area_s_13_16_3d*100/nc_s_area_13_16,diff_area_s_17_18_3d*100/nc_s_area_17_18,diff_area_s_19_64_3d*100/nc_s_area_19_64,diff_area_s_65_3d*100/nc_s_area_65),
  Total_infected_school_closure_1_week = c(c_s_area_0_2_1w,c_s_area_3_5_1w,c_s_area_6_12_1w,c_s_area_13_16_1w,c_s_area_17_18_1w,c_s_area_19_64_1w,c_s_area_65_1w),
  Reduction_1_week = c(diff_area_s_0_2_1w,diff_area_s_3_5_1w,diff_area_s_6_12_1w,diff_area_s_13_16_1w,diff_area_s_17_18_1w,diff_area_s_19_64_1w,diff_area_s_65_1w),
  Reduction_percentage_1_week = c(diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_65_1w*100/nc_s_area_65),
  Total_infected_school_closure_2_weeks = c(c_s_area_0_2_2w,c_s_area_3_5_2w,c_s_area_6_12_2w,c_s_area_13_16_2w,c_s_area_17_18_2w,c_s_area_19_64_2w,c_s_area_65_2w),
  Reduction_2_weeks = c(diff_area_s_0_2_2w,diff_area_s_3_5_2w,diff_area_s_6_12_2w,diff_area_s_13_16_2w,diff_area_s_17_18_2w,diff_area_s_19_64_2w,diff_area_s_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_65_2w*100/nc_s_area_65),
  Total_infected_school_closure_1_month = c(c_s_area_0_2_1m,c_s_area_3_5_1m,c_s_area_6_12_1m,c_s_area_13_16_1m,c_s_area_17_18_1m,c_s_area_19_64_1m,c_s_area_65_1m),
  Reduction_1_month = c(diff_area_s_0_2_1m,diff_area_s_3_5_1m,diff_area_s_6_12_1m,diff_area_s_13_16_1m,diff_area_s_17_18_1m,diff_area_s_19_64_1m,diff_area_s_65_1m),
  Reduction_percentage_1_month = c(diff_area_s_0_2_1m*100/nc_s_area_0_2,diff_area_s_3_5_1m*100/nc_s_area_3_5,diff_area_s_6_12_1m*100/nc_s_area_6_12,diff_area_s_13_16_1m*100/nc_s_area_13_16,diff_area_s_17_18_1m*100/nc_s_area_17_18,diff_area_s_19_64_1m*100/nc_s_area_19_64,diff_area_s_65_1m*100/nc_s_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_s_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_s <- data.frame(
  Date_beginning_closure = c(3,7,14,30),
  Reduction_percentage_0_2 = c(diff_area_s_0_2_3d*100/nc_s_area_0_2,diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_0_2_1m*100/nc_s_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_s_3_5_3d*100/nc_s_area_3_5,diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_3_5_1m*100/nc_s_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_s_6_12_3d*100/nc_s_area_6_12,diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_6_12_1m*100/nc_s_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_s_13_16_3d*100/nc_s_area_13_16,diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_13_16_1m*100/nc_s_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_s_17_18_3d*100/nc_s_area_17_18,diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_17_18_1m*100/nc_s_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_s_19_64_3d*100/nc_s_area_19_64,diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_19_64_1m*100/nc_s_area_19_64),
  Reduction_percentage_65 = c(diff_area_s_65_3d*100/nc_s_area_65,diff_area_s_65_1w*100/nc_s_area_65,diff_area_s_65_2w*100/nc_s_area_65,diff_area_s_65_1m*100/nc_s_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_s ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

We can see with these figures that school closure must be realised as quickly as possible as it becomes rapidly inefficient. Indeed, for a majority of age groups, a school closure 2 weeks after the beginning of the epidemy will only reduce the number of people affected by 1% and a school closure after a month is completely ineficient. 

We can conclude that the best beginning date for school closure is right after the beginning of the epidemy. However, this measure demands time to be put in place and one week after the beginning of the epidemy will probably be the fastest school closure possible. 

## For pandemic flu

We do the same simulation for pandemic flu. 

```{r}

#Result in case of no school closure 

odes_no_closure_p <- infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7)

#Result in case of school closure from 2007-09-26 to 2007-10-26

odes_closure_p_3d <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-26"), date_end_closure = as.Date(" 2007-10-26"))

#Result in case of school closure from 2007-09-30 to 2007-10-30

odes_closure_p_1w <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-30"))

#Result in case of school closure from 2007-10-07 to 2007-11-07

odes_closure_p_2w <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-10-07"), date_end_closure = as.Date(" 2007-11-07"))

#Result in case of school closure from 2007-10-23 to 2007-11-23

odes_closure_p_1m <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-10-23"), date_end_closure = as.Date(" 2007-11-23"))

```

### For low risk people 

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_p <- NULL
fraction.infected_0_2_p$Time <- odes_no_closure_p$Time
fraction.infected_0_2_p$V1 <- odes_no_closure_p$V1
fraction.infected_0_2_p$V2 <- odes_closure_p_3d$V1
fraction.infected_0_2_p$V3 <- odes_closure_p_1w$V1
fraction.infected_0_2_p$V4 <- odes_closure_p_2w$V1
fraction.infected_0_2_p$V5 <- odes_closure_p_1m$V1

fraction.infected_0_2_p <-data.frame(fraction.infected_0_2_p)

ggplot( data=fraction.infected_0_2_p ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure after 3 days","0-2 with school closure after 1 week","0-2 with school closure after 2 weeks","0-2 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_p <- NULL
fraction.infected_3_5_p$Time <- odes_no_closure_p$Time
fraction.infected_3_5_p$V1 <- odes_no_closure_p$V2
fraction.infected_3_5_p$V2 <- odes_closure_p_3d$V2
fraction.infected_3_5_p$V3 <- odes_closure_p_1w$V2
fraction.infected_3_5_p$V4 <- odes_closure_p_2w$V2
fraction.infected_3_5_p$V5 <- odes_closure_p_1m$V2

fraction.infected_3_5_p <-data.frame(fraction.infected_3_5_p)

fraction.infected_6_12_p <- NULL
fraction.infected_6_12_p$Time <- odes_no_closure_p$Time
fraction.infected_6_12_p$V1 <- odes_no_closure_p$V3
fraction.infected_6_12_p$V2 <- odes_closure_p_3d$V3
fraction.infected_6_12_p$V3 <- odes_closure_p_1w$V3
fraction.infected_6_12_p$V4 <- odes_closure_p_2w$V3
fraction.infected_6_12_p$V5 <- odes_closure_p_1m$V3

fraction.infected_6_12_p <-data.frame(fraction.infected_6_12_p)

fraction.infected_13_16_p <- NULL
fraction.infected_13_16_p$Time <- odes_no_closure_p$Time
fraction.infected_13_16_p$V1 <- odes_no_closure_p$V4
fraction.infected_13_16_p$V2 <- odes_closure_p_3d$V4
fraction.infected_13_16_p$V3 <- odes_closure_p_1w$V4
fraction.infected_13_16_p$V4 <- odes_closure_p_2w$V4
fraction.infected_13_16_p$V5 <- odes_closure_p_1m$V4

fraction.infected_13_16_p <-data.frame(fraction.infected_13_16_p)

fraction.infected_17_18_p <- NULL
fraction.infected_17_18_p$Time <- odes_no_closure_p$Time
fraction.infected_17_18_p$V1 <- odes_no_closure_p$V5
fraction.infected_17_18_p$V2 <- odes_closure_p_3d$V5
fraction.infected_17_18_p$V3 <- odes_closure_p_1w$V5
fraction.infected_17_18_p$V4 <- odes_closure_p_2w$V5
fraction.infected_17_18_p$V5 <- odes_closure_p_1m$V5

fraction.infected_17_18_p <-data.frame(fraction.infected_17_18_p)

fraction.infected_3_18_p <- NULL
fraction.infected_3_18_p$Time <- odes_no_closure_p$Time
fraction.infected_3_18_p$V1<-rowSums(data.frame(fraction.infected_3_5_p$V1,fraction.infected_6_12_p$V1,fraction.infected_13_16_p$V1,fraction.infected_17_18_p$V1))
fraction.infected_3_18_p$V2 <- rowSums(data.frame(fraction.infected_3_5_p$V2,fraction.infected_6_12_p$V2,fraction.infected_13_16_p$V2,fraction.infected_17_18_p$V2))
fraction.infected_3_18_p$V3 <- rowSums(data.frame(fraction.infected_3_5_p$V3,fraction.infected_6_12_p$V3,fraction.infected_13_16_p$V3,fraction.infected_17_18_p$V3))
fraction.infected_3_18_p$V4 <- rowSums(data.frame(fraction.infected_3_5_p$V4,fraction.infected_6_12_p$V4,fraction.infected_13_16_p$V4,fraction.infected_17_18_p$V4))
fraction.infected_3_18_p$V5 <- rowSums(data.frame(fraction.infected_3_5_p$V5,fraction.infected_6_12_p$V5,fraction.infected_13_16_p$V5,fraction.infected_17_18_p$V5))

fraction.infected_3_18_p <-data.frame(fraction.infected_3_18_p)

ggplot( data=fraction.infected_3_18_p ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure after 3 days","3-18 with school closure after 1 week","3-18 with school closure after 2 weeks","3-18 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_p <- NULL
fraction.infected_19_64_p$Time <- odes_no_closure_p$Time
fraction.infected_19_64_p$V1 <- odes_no_closure_p$V6
fraction.infected_19_64_p$V2 <- odes_closure_p_3d$V6
fraction.infected_19_64_p$V3 <- odes_closure_p_1w$V6
fraction.infected_19_64_p$V4 <- odes_closure_p_2w$V6
fraction.infected_19_64_p$V5 <- odes_closure_p_1m$V6

fraction.infected_19_64_p <-data.frame(fraction.infected_19_64_p)

ggplot( data=fraction.infected_19_64_p ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure after 3 days","19-64 with school closure after 1 week","19-64 with school closure after 2 weeks","19-64 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_p <- NULL
fraction.infected_65_p$Time <- odes_no_closure_p$Time
fraction.infected_65_p$V1 <- odes_no_closure_p$V7
fraction.infected_65_p$V2 <- odes_closure_p_3d$V7
fraction.infected_65_p$V3 <- odes_closure_p_1w$V7
fraction.infected_65_p$V4 <- odes_closure_p_2w$V7
fraction.infected_65_p$V5 <- odes_closure_p_1m$V7

fraction.infected_65_p <-data.frame(fraction.infected_65_p)

ggplot( data=fraction.infected_65_p ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure after 3 days","65+ with school closure after 1 week","65+ with school closure after 2 weeks","65+ with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 65+")

```

We can see with these graphics that the earlier the school closure begins, the better. Indeed, the lower the number of people infected is for the school closure 3 days after the beginning of the epidemy. 

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_p_area_0_2 <- sum(fraction.infected_0_2_p$V1)
c_p_area_0_2_3d <- sum(fraction.infected_0_2_p$V2)
c_p_area_0_2_1w <- sum(fraction.infected_0_2_p$V3)
c_p_area_0_2_2w <- sum(fraction.infected_0_2_p$V4)
c_p_area_0_2_1m <- sum(fraction.infected_0_2_p$V5)
diff_area_p_0_2_3d <- nc_p_area_0_2 - c_p_area_0_2_3d
diff_area_p_0_2_1w <- nc_p_area_0_2 - c_p_area_0_2_1w
diff_area_p_0_2_2w <- nc_p_area_0_2 - c_p_area_0_2_2w
diff_area_p_0_2_1m <- nc_p_area_0_2 - c_p_area_0_2_1m

#Age group <3-5> 

nc_p_area_3_5 <- sum(fraction.infected_3_5_p$V1)
c_p_area_3_5_3d <- sum(fraction.infected_3_5_p$V2)
c_p_area_3_5_1w <- sum(fraction.infected_3_5_p$V3)
c_p_area_3_5_2w <- sum(fraction.infected_3_5_p$V4)
c_p_area_3_5_1m <- sum(fraction.infected_3_5_p$V5)
diff_area_p_3_5_3d <- nc_p_area_3_5 - c_p_area_3_5_3d
diff_area_p_3_5_1w <- nc_p_area_3_5 - c_p_area_3_5_1w
diff_area_p_3_5_2w <- nc_p_area_3_5 - c_p_area_3_5_2w
diff_area_p_3_5_1m <- nc_p_area_3_5 - c_p_area_3_5_1m

#Age group <6-12> 

nc_p_area_6_12 <- sum(fraction.infected_6_12_p$V1)
c_p_area_6_12_3d <- sum(fraction.infected_6_12_p$V2)
c_p_area_6_12_1w <- sum(fraction.infected_6_12_p$V3)
c_p_area_6_12_2w <- sum(fraction.infected_6_12_p$V4)
c_p_area_6_12_1m <- sum(fraction.infected_6_12_p$V5)
diff_area_p_6_12_3d <- nc_p_area_6_12 - c_p_area_6_12_3d
diff_area_p_6_12_1w <- nc_p_area_6_12 - c_p_area_6_12_1w
diff_area_p_6_12_2w <- nc_p_area_6_12 - c_p_area_6_12_2w
diff_area_p_6_12_1m <- nc_p_area_6_12 - c_p_area_6_12_1m

#Age group <13-16> 

nc_p_area_13_16 <- sum(fraction.infected_13_16_p$V1)
c_p_area_13_16_3d <- sum(fraction.infected_13_16_p$V2)
c_p_area_13_16_1w <- sum(fraction.infected_13_16_p$V3)
c_p_area_13_16_2w <- sum(fraction.infected_13_16_p$V4)
c_p_area_13_16_1m <- sum(fraction.infected_13_16_p$V5)
diff_area_p_13_16_3d <- nc_p_area_13_16 - c_p_area_13_16_3d
diff_area_p_13_16_1w <- nc_p_area_13_16 - c_p_area_13_16_1w
diff_area_p_13_16_2w <- nc_p_area_13_16 - c_p_area_13_16_2w
diff_area_p_13_16_1m <- nc_p_area_13_16 - c_p_area_13_16_1m

#Age group <17-18> 

nc_p_area_17_18 <- sum(fraction.infected_17_18_p$V1)
c_p_area_17_18_3d <- sum(fraction.infected_17_18_p$V2)
c_p_area_17_18_1w <- sum(fraction.infected_17_18_p$V3)
c_p_area_17_18_2w <- sum(fraction.infected_17_18_p$V4)
c_p_area_17_18_1m <- sum(fraction.infected_17_18_p$V5)
diff_area_p_17_18_3d <- nc_p_area_17_18 - c_p_area_17_18_3d
diff_area_p_17_18_1w <- nc_p_area_17_18 - c_p_area_17_18_1w
diff_area_p_17_18_2w <- nc_p_area_17_18 - c_p_area_17_18_2w
diff_area_p_17_18_1m <- nc_p_area_17_18 - c_p_area_17_18_1m

#Age group <19-64> 

nc_p_area_19_64 <- sum(fraction.infected_19_64_p$V1)
c_p_area_19_64_3d <- sum(fraction.infected_19_64_p$V2)
c_p_area_19_64_1w <- sum(fraction.infected_19_64_p$V3)
c_p_area_19_64_2w <- sum(fraction.infected_19_64_p$V4)
c_p_area_19_64_1m <- sum(fraction.infected_19_64_p$V5)
diff_area_p_19_64_3d <- nc_p_area_19_64 - c_p_area_19_64_3d
diff_area_p_19_64_1w <- nc_p_area_19_64 - c_p_area_19_64_1w
diff_area_p_19_64_2w <- nc_p_area_19_64 - c_p_area_19_64_2w
diff_area_p_19_64_1m <- nc_p_area_19_64 - c_p_area_19_64_1m

#Age group <65+> 

nc_p_area_65 <- sum(fraction.infected_65_p$V1)
c_p_area_65_3d <- sum(fraction.infected_65_p$V2)
c_p_area_65_1w <- sum(fraction.infected_65_p$V3)
c_p_area_65_2w <- sum(fraction.infected_65_p$V4)
c_p_area_65_1m <- sum(fraction.infected_65_p$V5)
diff_area_p_65_3d <- nc_p_area_65 - c_p_area_65_3d
diff_area_p_65_1w <- nc_p_area_65 - c_p_area_65_1w
diff_area_p_65_2w <- nc_p_area_65 - c_p_area_65_2w
diff_area_p_65_1m <- nc_p_area_65 - c_p_area_65_1m

#Results in a table 
Total_Reduction_p_results <- data.frame(
  Total_infected_no_school_closure = c(nc_p_area_0_2,nc_p_area_3_5,nc_p_area_6_12,nc_p_area_13_16,nc_p_area_17_18,nc_p_area_19_64,nc_p_area_65),
  Total_infected_school_closure_3_days = c(c_p_area_0_2_3d,c_p_area_3_5_3d,c_p_area_6_12_3d,c_p_area_13_16_3d,c_p_area_17_18_3d,c_p_area_19_64_3d,c_p_area_65_3d),
  Reduction_3_days = c(diff_area_p_0_2_3d,diff_area_p_3_5_3d,diff_area_p_6_12_3d,diff_area_p_13_16_3d,diff_area_p_17_18_3d,diff_area_p_19_64_3d,diff_area_p_65_3d),
  Reduction_percentage_3_days = c(diff_area_p_0_2_3d*100/nc_p_area_0_2,diff_area_p_3_5_3d*100/nc_p_area_3_5,diff_area_p_6_12_3d*100/nc_p_area_6_12,diff_area_p_13_16_3d*100/nc_p_area_13_16,diff_area_p_17_18_3d*100/nc_p_area_17_18,diff_area_p_19_64_3d*100/nc_p_area_19_64,diff_area_p_65_3d*100/nc_p_area_65),
  Total_infected_school_closure_1_week = c(c_p_area_0_2_1w,c_p_area_3_5_1w,c_p_area_6_12_1w,c_p_area_13_16_1w,c_p_area_17_18_1w,c_p_area_19_64_1w,c_p_area_65_1w),
  Reduction_1_week = c(diff_area_p_0_2_1w,diff_area_p_3_5_1w,diff_area_p_6_12_1w,diff_area_p_13_16_1w,diff_area_p_17_18_1w,diff_area_p_19_64_1w,diff_area_p_65_1w),
  Reduction_percentage_1_week = c(diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_65_1w*100/nc_p_area_65),
  Total_infected_school_closure_2_weeks = c(c_p_area_0_2_2w,c_p_area_3_5_2w,c_p_area_6_12_2w,c_p_area_13_16_2w,c_p_area_17_18_2w,c_p_area_19_64_2w,c_p_area_65_2w),
  Reduction_2_weeks = c(diff_area_p_0_2_2w,diff_area_p_3_5_2w,diff_area_p_6_12_2w,diff_area_p_13_16_2w,diff_area_p_17_18_2w,diff_area_p_19_64_2w,diff_area_p_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_65_2w*100/nc_p_area_65),
  Total_infected_school_closure_1_month = c(c_p_area_0_2_1m,c_p_area_3_5_1m,c_p_area_6_12_1m,c_p_area_13_16_1m,c_p_area_17_18_1m,c_p_area_19_64_1m,c_p_area_65_1m),
  Reduction_1_month = c(diff_area_s_0_2_1m,diff_area_s_3_5_1m,diff_area_s_6_12_1m,diff_area_s_13_16_1m,diff_area_s_17_18_1m,diff_area_s_19_64_1m,diff_area_s_65_1m),
  Reduction_percentage_1_month = c(diff_area_p_0_2_1m*100/nc_p_area_0_2,diff_area_p_3_5_1m*100/nc_p_area_3_5,diff_area_p_6_12_1m*100/nc_p_area_6_12,diff_area_p_13_16_1m*100/nc_p_area_13_16,diff_area_p_17_18_1m*100/nc_p_area_17_18,diff_area_p_19_64_1m*100/nc_p_area_19_64,diff_area_p_65_1m*100/nc_p_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_p_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_p <- data.frame(
  Date_beginning_closure = c(3,7,14,30),
  Reduction_percentage_0_2 = c(diff_area_p_0_2_3d*100/nc_p_area_0_2,diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_0_2_1m*100/nc_p_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_p_3_5_3d*100/nc_p_area_3_5,diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_3_5_1m*100/nc_p_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_p_6_12_3d*100/nc_p_area_6_12,diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_6_12_1m*100/nc_p_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_p_13_16_3d*100/nc_p_area_13_16,diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_13_16_1m*100/nc_p_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_p_17_18_3d*100/nc_p_area_17_18,diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_17_18_1m*100/nc_p_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_p_19_64_3d*100/nc_p_area_19_64,diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_19_64_1m*100/nc_p_area_19_64),
  Reduction_percentage_65 = c(diff_area_p_65_3d*100/nc_p_area_65,diff_area_p_65_1w*100/nc_p_area_65,diff_area_p_65_2w*100/nc_p_area_65,diff_area_p_65_1m*100/nc_p_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_p ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

### For high risk people 

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_p <- NULL
fraction.infected_0_2_p$Time <- odes_no_closure_p$Time
fraction.infected_0_2_p$V1 <- odes_no_closure_p$V8
fraction.infected_0_2_p$V2 <- odes_closure_p_3d$V8
fraction.infected_0_2_p$V3 <- odes_closure_p_1w$V8
fraction.infected_0_2_p$V4 <- odes_closure_p_2w$V8
fraction.infected_0_2_p$V5 <- odes_closure_p_1m$V8

fraction.infected_0_2_p <-data.frame(fraction.infected_0_2_p)

ggplot( data=fraction.infected_0_2_p ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure after 3 days","0-2 with school closure after 1 week","0-2 with school closure after 2 weeks","0-2 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_p <- NULL
fraction.infected_3_5_p$Time <- odes_no_closure_p$Time
fraction.infected_3_5_p$V1 <- odes_no_closure_p$V9
fraction.infected_3_5_p$V2 <- odes_closure_p_3d$V9
fraction.infected_3_5_p$V3 <- odes_closure_p_1w$V9
fraction.infected_3_5_p$V4 <- odes_closure_p_2w$V9
fraction.infected_3_5_p$V5 <- odes_closure_p_1m$V9

fraction.infected_3_5_p <-data.frame(fraction.infected_3_5_p)

fraction.infected_6_12_p <- NULL
fraction.infected_6_12_p$Time <- odes_no_closure_p$Time
fraction.infected_6_12_p$V1 <- odes_no_closure_p$V10
fraction.infected_6_12_p$V2 <- odes_closure_p_3d$V10
fraction.infected_6_12_p$V3 <- odes_closure_p_1w$V10
fraction.infected_6_12_p$V4 <- odes_closure_p_2w$V10
fraction.infected_6_12_p$V5 <- odes_closure_p_1m$V10

fraction.infected_6_12_p <-data.frame(fraction.infected_6_12_p)

fraction.infected_13_16_p <- NULL
fraction.infected_13_16_p$Time <- odes_no_closure_p$Time
fraction.infected_13_16_p$V1 <- odes_no_closure_p$V11
fraction.infected_13_16_p$V2 <- odes_closure_p_3d$V11
fraction.infected_13_16_p$V3 <- odes_closure_p_1w$V11
fraction.infected_13_16_p$V4 <- odes_closure_p_2w$V11
fraction.infected_13_16_p$V5 <- odes_closure_p_1m$V11

fraction.infected_13_16_p <-data.frame(fraction.infected_13_16_p)

fraction.infected_17_18_p <- NULL
fraction.infected_17_18_p$Time <- odes_no_closure_p$Time
fraction.infected_17_18_p$V1 <- odes_no_closure_p$V12
fraction.infected_17_18_p$V2 <- odes_closure_p_3d$V12
fraction.infected_17_18_p$V3 <- odes_closure_p_1w$V12
fraction.infected_17_18_p$V4 <- odes_closure_p_2w$V12
fraction.infected_17_18_p$V5 <- odes_closure_p_1m$V12

fraction.infected_17_18_p <-data.frame(fraction.infected_17_18_p)

fraction.infected_3_18_p <- NULL
fraction.infected_3_18_p$Time <- odes_no_closure_p$Time
fraction.infected_3_18_p$V1<-rowSums(data.frame(fraction.infected_3_5_p$V1,fraction.infected_6_12_p$V1,fraction.infected_13_16_p$V1,fraction.infected_17_18_p$V1))
fraction.infected_3_18_p$V2 <- rowSums(data.frame(fraction.infected_3_5_p$V2,fraction.infected_6_12_p$V2,fraction.infected_13_16_p$V2,fraction.infected_17_18_p$V2))
fraction.infected_3_18_p$V3 <- rowSums(data.frame(fraction.infected_3_5_p$V3,fraction.infected_6_12_p$V3,fraction.infected_13_16_p$V3,fraction.infected_17_18_p$V3))
fraction.infected_3_18_p$V4 <- rowSums(data.frame(fraction.infected_3_5_p$V4,fraction.infected_6_12_p$V4,fraction.infected_13_16_p$V4,fraction.infected_17_18_p$V4))
fraction.infected_3_18_p$V5 <- rowSums(data.frame(fraction.infected_3_5_p$V5,fraction.infected_6_12_p$V5,fraction.infected_13_16_p$V5,fraction.infected_17_18_p$V5))

fraction.infected_3_18_p <-data.frame(fraction.infected_3_18_p)

ggplot( data=fraction.infected_3_18_p ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure after 3 days","3-18 with school closure after 1 week","3-18 with school closure after 2 weeks","3-18 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_p <- NULL
fraction.infected_19_64_p$Time <- odes_no_closure_p$Time
fraction.infected_19_64_p$V1 <- odes_no_closure_p$V13
fraction.infected_19_64_p$V2 <- odes_closure_p_3d$V13
fraction.infected_19_64_p$V3 <- odes_closure_p_1w$V13
fraction.infected_19_64_p$V4 <- odes_closure_p_2w$V13
fraction.infected_19_64_p$V5 <- odes_closure_p_1m$V13

fraction.infected_19_64_p <-data.frame(fraction.infected_19_64_p)

ggplot( data=fraction.infected_19_64_p ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure after 3 days","19-64 with school closure after 1 week","19-64 with school closure after 2 weeks","19-64 with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_p <- NULL
fraction.infected_65_p$Time <- odes_no_closure_p$Time
fraction.infected_65_p$V1 <- odes_no_closure_p$V14
fraction.infected_65_p$V2 <- odes_closure_p_3d$V14
fraction.infected_65_p$V3 <- odes_closure_p_1w$V14
fraction.infected_65_p$V4 <- odes_closure_p_2w$V14
fraction.infected_65_p$V5 <- odes_closure_p_1m$V14

fraction.infected_65_p <-data.frame(fraction.infected_65_p)

ggplot( data=fraction.infected_65_p ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure after 3 days") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure after 1 week") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure after 2 weeks") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure after 1 month") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure after 3 days","65+ with school closure after 1 week","65+ with school closure after 2 weeks","65+ with school closure after 1 month"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 65+")

```

We can see with these graphics that the earlier the school closure begins, the better. Indeed, the lower the number of people infected is for the school closure 3 days after the beginning of the epidemy. 

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_p_area_0_2 <- sum(fraction.infected_0_2_p$V1)
c_p_area_0_2_3d <- sum(fraction.infected_0_2_p$V2)
c_p_area_0_2_1w <- sum(fraction.infected_0_2_p$V3)
c_p_area_0_2_2w <- sum(fraction.infected_0_2_p$V4)
c_p_area_0_2_1m <- sum(fraction.infected_0_2_p$V5)
diff_area_p_0_2_3d <- nc_p_area_0_2 - c_p_area_0_2_3d
diff_area_p_0_2_1w <- nc_p_area_0_2 - c_p_area_0_2_1w
diff_area_p_0_2_2w <- nc_p_area_0_2 - c_p_area_0_2_2w
diff_area_p_0_2_1m <- nc_p_area_0_2 - c_p_area_0_2_1m

#Age group <3-5> 

nc_p_area_3_5 <- sum(fraction.infected_3_5_p$V1)
c_p_area_3_5_3d <- sum(fraction.infected_3_5_p$V2)
c_p_area_3_5_1w <- sum(fraction.infected_3_5_p$V3)
c_p_area_3_5_2w <- sum(fraction.infected_3_5_p$V4)
c_p_area_3_5_1m <- sum(fraction.infected_3_5_p$V5)
diff_area_p_3_5_3d <- nc_p_area_3_5 - c_p_area_3_5_3d
diff_area_p_3_5_1w <- nc_p_area_3_5 - c_p_area_3_5_1w
diff_area_p_3_5_2w <- nc_p_area_3_5 - c_p_area_3_5_2w
diff_area_p_3_5_1m <- nc_p_area_3_5 - c_p_area_3_5_1m

#Age group <6-12> 

nc_p_area_6_12 <- sum(fraction.infected_6_12_p$V1)
c_p_area_6_12_3d <- sum(fraction.infected_6_12_p$V2)
c_p_area_6_12_1w <- sum(fraction.infected_6_12_p$V3)
c_p_area_6_12_2w <- sum(fraction.infected_6_12_p$V4)
c_p_area_6_12_1m <- sum(fraction.infected_6_12_p$V5)
diff_area_p_6_12_3d <- nc_p_area_6_12 - c_p_area_6_12_3d
diff_area_p_6_12_1w <- nc_p_area_6_12 - c_p_area_6_12_1w
diff_area_p_6_12_2w <- nc_p_area_6_12 - c_p_area_6_12_2w
diff_area_p_6_12_1m <- nc_p_area_6_12 - c_p_area_6_12_1m

#Age group <13-16> 

nc_p_area_13_16 <- sum(fraction.infected_13_16_p$V1)
c_p_area_13_16_3d <- sum(fraction.infected_13_16_p$V2)
c_p_area_13_16_1w <- sum(fraction.infected_13_16_p$V3)
c_p_area_13_16_2w <- sum(fraction.infected_13_16_p$V4)
c_p_area_13_16_1m <- sum(fraction.infected_13_16_p$V5)
diff_area_p_13_16_3d <- nc_p_area_13_16 - c_p_area_13_16_3d
diff_area_p_13_16_1w <- nc_p_area_13_16 - c_p_area_13_16_1w
diff_area_p_13_16_2w <- nc_p_area_13_16 - c_p_area_13_16_2w
diff_area_p_13_16_1m <- nc_p_area_13_16 - c_p_area_13_16_1m

#Age group <17-18> 

nc_p_area_17_18 <- sum(fraction.infected_17_18_p$V1)
c_p_area_17_18_3d <- sum(fraction.infected_17_18_p$V2)
c_p_area_17_18_1w <- sum(fraction.infected_17_18_p$V3)
c_p_area_17_18_2w <- sum(fraction.infected_17_18_p$V4)
c_p_area_17_18_1m <- sum(fraction.infected_17_18_p$V5)
diff_area_p_17_18_3d <- nc_p_area_17_18 - c_p_area_17_18_3d
diff_area_p_17_18_1w <- nc_p_area_17_18 - c_p_area_17_18_1w
diff_area_p_17_18_2w <- nc_p_area_17_18 - c_p_area_17_18_2w
diff_area_p_17_18_1m <- nc_p_area_17_18 - c_p_area_17_18_1m

#Age group <19-64> 

nc_p_area_19_64 <- sum(fraction.infected_19_64_p$V1)
c_p_area_19_64_3d <- sum(fraction.infected_19_64_p$V2)
c_p_area_19_64_1w <- sum(fraction.infected_19_64_p$V3)
c_p_area_19_64_2w <- sum(fraction.infected_19_64_p$V4)
c_p_area_19_64_1m <- sum(fraction.infected_19_64_p$V5)
diff_area_p_19_64_3d <- nc_p_area_19_64 - c_p_area_19_64_3d
diff_area_p_19_64_1w <- nc_p_area_19_64 - c_p_area_19_64_1w
diff_area_p_19_64_2w <- nc_p_area_19_64 - c_p_area_19_64_2w
diff_area_p_19_64_1m <- nc_p_area_19_64 - c_p_area_19_64_1m

#Age group <65+> 

nc_p_area_65 <- sum(fraction.infected_65_p$V1)
c_p_area_65_3d <- sum(fraction.infected_65_p$V2)
c_p_area_65_1w <- sum(fraction.infected_65_p$V3)
c_p_area_65_2w <- sum(fraction.infected_65_p$V4)
c_p_area_65_1m <- sum(fraction.infected_65_p$V5)
diff_area_p_65_3d <- nc_p_area_65 - c_p_area_65_3d
diff_area_p_65_1w <- nc_p_area_65 - c_p_area_65_1w
diff_area_p_65_2w <- nc_p_area_65 - c_p_area_65_2w
diff_area_p_65_1m <- nc_p_area_65 - c_p_area_65_1m

#Results in a table 
Total_Reduction_p_results <- data.frame(
  Total_infected_no_school_closure = c(nc_p_area_0_2,nc_p_area_3_5,nc_p_area_6_12,nc_p_area_13_16,nc_p_area_17_18,nc_p_area_19_64,nc_p_area_65),
  Total_infected_school_closure_3_days = c(c_p_area_0_2_3d,c_p_area_3_5_3d,c_p_area_6_12_3d,c_p_area_13_16_3d,c_p_area_17_18_3d,c_p_area_19_64_3d,c_p_area_65_3d),
  Reduction_3_days = c(diff_area_p_0_2_3d,diff_area_p_3_5_3d,diff_area_p_6_12_3d,diff_area_p_13_16_3d,diff_area_p_17_18_3d,diff_area_p_19_64_3d,diff_area_p_65_3d),
  Reduction_percentage_3_days = c(diff_area_p_0_2_3d*100/nc_p_area_0_2,diff_area_p_3_5_3d*100/nc_p_area_3_5,diff_area_p_6_12_3d*100/nc_p_area_6_12,diff_area_p_13_16_3d*100/nc_p_area_13_16,diff_area_p_17_18_3d*100/nc_p_area_17_18,diff_area_p_19_64_3d*100/nc_p_area_19_64,diff_area_p_65_3d*100/nc_p_area_65),
  Total_infected_school_closure_1_week = c(c_p_area_0_2_1w,c_p_area_3_5_1w,c_p_area_6_12_1w,c_p_area_13_16_1w,c_p_area_17_18_1w,c_p_area_19_64_1w,c_p_area_65_1w),
  Reduction_1_week = c(diff_area_p_0_2_1w,diff_area_p_3_5_1w,diff_area_p_6_12_1w,diff_area_p_13_16_1w,diff_area_p_17_18_1w,diff_area_p_19_64_1w,diff_area_p_65_1w),
  Reduction_percentage_1_week = c(diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_65_1w*100/nc_p_area_65),
  Total_infected_school_closure_2_weeks = c(c_p_area_0_2_2w,c_p_area_3_5_2w,c_p_area_6_12_2w,c_p_area_13_16_2w,c_p_area_17_18_2w,c_p_area_19_64_2w,c_p_area_65_2w),
  Reduction_2_weeks = c(diff_area_p_0_2_2w,diff_area_p_3_5_2w,diff_area_p_6_12_2w,diff_area_p_13_16_2w,diff_area_p_17_18_2w,diff_area_p_19_64_2w,diff_area_p_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_65_2w*100/nc_p_area_65),
  Total_infected_school_closure_1_month = c(c_p_area_0_2_1m,c_p_area_3_5_1m,c_p_area_6_12_1m,c_p_area_13_16_1m,c_p_area_17_18_1m,c_p_area_19_64_1m,c_p_area_65_1m),
  Reduction_1_month = c(diff_area_s_0_2_1m,diff_area_s_3_5_1m,diff_area_s_6_12_1m,diff_area_s_13_16_1m,diff_area_s_17_18_1m,diff_area_s_19_64_1m,diff_area_s_65_1m),
  Reduction_percentage_1_month = c(diff_area_p_0_2_1m*100/nc_p_area_0_2,diff_area_p_3_5_1m*100/nc_p_area_3_5,diff_area_p_6_12_1m*100/nc_p_area_6_12,diff_area_p_13_16_1m*100/nc_p_area_13_16,diff_area_p_17_18_1m*100/nc_p_area_17_18,diff_area_p_19_64_1m*100/nc_p_area_19_64,diff_area_p_65_1m*100/nc_p_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_p_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_p <- data.frame(
  Date_beginning_closure = c(3,7,14,30),
  Reduction_percentage_0_2 = c(diff_area_p_0_2_3d*100/nc_p_area_0_2,diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_0_2_1m*100/nc_p_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_p_3_5_3d*100/nc_p_area_3_5,diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_3_5_1m*100/nc_p_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_p_6_12_3d*100/nc_p_area_6_12,diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_6_12_1m*100/nc_p_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_p_13_16_3d*100/nc_p_area_13_16,diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_13_16_1m*100/nc_p_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_p_17_18_3d*100/nc_p_area_17_18,diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_17_18_1m*100/nc_p_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_p_19_64_3d*100/nc_p_area_19_64,diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_19_64_1m*100/nc_p_area_19_64),
  Reduction_percentage_65 = c(diff_area_p_65_3d*100/nc_p_area_65,diff_area_p_65_1w*100/nc_p_area_65,diff_area_p_65_2w*100/nc_p_area_65,diff_area_p_65_1m*100/nc_p_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_p ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

#  Study of the impact of the period of school closure

We will now keep the best realist `date_begin_closure` (1 week after the beginning of the epidemy: indeed 3 days after gives better result but would be very difficult to realize in reality) and change the `date_end_closure` to see the impact of the period of school closure and study whether it is better to have an short school closure or a long one. 

We will keep the same example as before of an epidemy starting on the 23rd of September. 

## For seasonal flu 

With `date_begin_closure = "2007-09-30"`, we will test 4 different `date_end_closure`: 

- "2007-10-14": 2 weeks after the beginning of school closure
- "2007-10-21": 3 weeks after the beginning of school closure
- "2007-10-30": a month after the beginning of school closure
- "2007-11-30": 2 months after the beginning of school closure

All these school closure will start on the 30th of September. 

We will plot one graphic for each of the following age groups : <0-2>, <3-18>, <19-64>, <65+>. 

Each graphic will have five curves: the one without school closure and the four school closure simulations for the four ending dates. 

```{r}

#Result in case of no school closure 

odes_no_closure_s <- infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7)

#Result in case of school closure from 2007-09-30 to 2007-10-14

odes_closure_s_2w <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-14"))

#Result in case of school closure from 2007-09-30 to 2007-10-21

odes_closure_s_3w <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-21"))

#Result in case of school closure from 2007-09-30 to 2007-10-30

odes_closure_s_1m <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-30"))

#Result in case of school closure from 2007-09-30 to 2007-11-30

odes_closure_s_2m <-infection_odin_closure(population, initial.infected, vaccine_calendar_s, contacts_no_closure,contacts_closure, susceptibility_s, transmissibility_s, infection_delays_s, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-11-30"))

```

### For low risk people 

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_s <- NULL
fraction.infected_0_2_s$Time <- odes_no_closure_s$Time
fraction.infected_0_2_s$V1 <- odes_no_closure_s$V1
fraction.infected_0_2_s$V2 <- odes_closure_s_2w$V1
fraction.infected_0_2_s$V3 <- odes_closure_s_3w$V1
fraction.infected_0_2_s$V4 <- odes_closure_s_1m$V1
fraction.infected_0_2_s$V5 <- odes_closure_s_2m$V1

fraction.infected_0_2_s <-data.frame(fraction.infected_0_2_s)

ggplot( data=fraction.infected_0_2_s ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure for 2 weeks","0-2 with school closure for 3 weeks","0-2 with school closure for 1 month","0-2 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_s <- NULL
fraction.infected_3_5_s$Time <- odes_no_closure_s$Time
fraction.infected_3_5_s$V1 <- odes_no_closure_s$V2
fraction.infected_3_5_s$V2 <- odes_closure_s_2w$V2
fraction.infected_3_5_s$V3 <- odes_closure_s_3w$V2
fraction.infected_3_5_s$V4 <- odes_closure_s_1m$V2
fraction.infected_3_5_s$V5 <- odes_closure_s_2m$V2

fraction.infected_3_5_s <-data.frame(fraction.infected_3_5_s)

fraction.infected_6_12_s <- NULL
fraction.infected_6_12_s$Time <- odes_no_closure_s$Time
fraction.infected_6_12_s$V1 <- odes_no_closure_s$V3
fraction.infected_6_12_s$V2 <- odes_closure_s_2w$V3
fraction.infected_6_12_s$V3 <- odes_closure_s_3w$V3
fraction.infected_6_12_s$V4 <- odes_closure_s_1m$V3
fraction.infected_6_12_s$V5 <- odes_closure_s_2m$V3

fraction.infected_6_12_s <-data.frame(fraction.infected_6_12_s)

fraction.infected_13_16_s <- NULL
fraction.infected_13_16_s$Time <- odes_no_closure_s$Time
fraction.infected_13_16_s$V1 <- odes_no_closure_s$V4
fraction.infected_13_16_s$V2 <- odes_closure_s_2w$V4
fraction.infected_13_16_s$V3 <- odes_closure_s_3w$V4
fraction.infected_13_16_s$V4 <- odes_closure_s_1m$V4
fraction.infected_13_16_s$V5 <- odes_closure_s_2m$V4

fraction.infected_13_16_s <-data.frame(fraction.infected_13_16_s)

fraction.infected_17_18_s <- NULL
fraction.infected_17_18_s$Time <- odes_no_closure_s$Time
fraction.infected_17_18_s$V1 <- odes_no_closure_s$V5
fraction.infected_17_18_s$V2 <- odes_closure_s_2w$V5
fraction.infected_17_18_s$V3 <- odes_closure_s_3w$V5
fraction.infected_17_18_s$V4 <- odes_closure_s_1m$V5
fraction.infected_17_18_s$V5 <- odes_closure_s_2m$V5

fraction.infected_17_18_s <-data.frame(fraction.infected_17_18_s)

fraction.infected_3_18_s <- NULL
fraction.infected_3_18_s$Time <- odes_no_closure_s$Time
fraction.infected_3_18_s$V1<-rowSums(data.frame(fraction.infected_3_5_s$V1,fraction.infected_6_12_s$V1,fraction.infected_13_16_s$V1,fraction.infected_17_18_s$V1))
fraction.infected_3_18_s$V2 <- rowSums(data.frame(fraction.infected_3_5_s$V2,fraction.infected_6_12_s$V2,fraction.infected_13_16_s$V2,fraction.infected_17_18_s$V2))
fraction.infected_3_18_s$V3 <- rowSums(data.frame(fraction.infected_3_5_s$V3,fraction.infected_6_12_s$V3,fraction.infected_13_16_s$V3,fraction.infected_17_18_s$V3))
fraction.infected_3_18_s$V4 <- rowSums(data.frame(fraction.infected_3_5_s$V4,fraction.infected_6_12_s$V4,fraction.infected_13_16_s$V4,fraction.infected_17_18_s$V4))
fraction.infected_3_18_s$V5 <- rowSums(data.frame(fraction.infected_3_5_s$V5,fraction.infected_6_12_s$V5,fraction.infected_13_16_s$V5,fraction.infected_17_18_s$V5))

fraction.infected_3_18_s <-data.frame(fraction.infected_3_18_s)

ggplot( data=fraction.infected_3_18_s ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure for 2 weeks","3-18 with school closure for 3 weeks","3-18 with school closure for 1 month","3-18 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_s <- NULL
fraction.infected_19_64_s$Time <- odes_no_closure_s$Time
fraction.infected_19_64_s$V1 <- odes_no_closure_s$V6
fraction.infected_19_64_s$V2 <- odes_closure_s_2w$V6
fraction.infected_19_64_s$V3 <- odes_closure_s_3w$V6
fraction.infected_19_64_s$V4 <- odes_closure_s_1m$V6
fraction.infected_19_64_s$V5 <- odes_closure_s_2m$V6

fraction.infected_19_64_s <-data.frame(fraction.infected_19_64_s)

ggplot( data=fraction.infected_19_64_s ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure for 2 weeks","19-64 with school closure for 3 weeks","19-64 with school closure for 1 month","19-64 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_s <- NULL
fraction.infected_65_s$Time <- odes_no_closure_s$Time
fraction.infected_65_s$V1 <- odes_no_closure_s$V7
fraction.infected_65_s$V2 <- odes_closure_s_2w$V7
fraction.infected_65_s$V3 <- odes_closure_s_3w$V7
fraction.infected_65_s$V4 <- odes_closure_s_1m$V7
fraction.infected_65_s$V5 <- odes_closure_s_2m$V7

fraction.infected_65_s <-data.frame(fraction.infected_65_s)

ggplot( data=fraction.infected_65_s ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure for 2 weeks","65+ with school closure for 3 weeks","65+ with school closure for 1 month","65+ with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 65+")

```

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_s_area_0_2 <- sum(fraction.infected_0_2_s$V1)
c_s_area_0_2_1w <- sum(fraction.infected_0_2_s$V2)
c_s_area_0_2_2w <- sum(fraction.infected_0_2_s$V3)
c_s_area_0_2_1m <- sum(fraction.infected_0_2_s$V4)
c_s_area_0_2_2m <- sum(fraction.infected_0_2_s$V5)
diff_area_s_0_2_1w <- nc_s_area_0_2 - c_s_area_0_2_1w
diff_area_s_0_2_2w <- nc_s_area_0_2 - c_s_area_0_2_2w
diff_area_s_0_2_1m <- nc_s_area_0_2 - c_s_area_0_2_1m
diff_area_s_0_2_2m <- nc_s_area_0_2 - c_s_area_0_2_2m

#Age group <3-5> 

nc_s_area_3_5 <- sum(fraction.infected_3_5_s$V1)
c_s_area_3_5_1w <- sum(fraction.infected_3_5_s$V2)
c_s_area_3_5_2w <- sum(fraction.infected_3_5_s$V3)
c_s_area_3_5_1m <- sum(fraction.infected_3_5_s$V4)
c_s_area_3_5_2m <- sum(fraction.infected_3_5_s$V5)
diff_area_s_3_5_1w <- nc_s_area_3_5 - c_s_area_3_5_1w
diff_area_s_3_5_2w <- nc_s_area_3_5 - c_s_area_3_5_2w
diff_area_s_3_5_1m <- nc_s_area_3_5 - c_s_area_3_5_1m
diff_area_s_3_5_2m <- nc_s_area_3_5 - c_s_area_3_5_2m

#Age group <6-12> 

nc_s_area_6_12 <- sum(fraction.infected_6_12_s$V1)
c_s_area_6_12_1w <- sum(fraction.infected_6_12_s$V2)
c_s_area_6_12_2w <- sum(fraction.infected_6_12_s$V3)
c_s_area_6_12_1m <- sum(fraction.infected_6_12_s$V4)
c_s_area_6_12_2m <- sum(fraction.infected_6_12_s$V5)
diff_area_s_6_12_1w <- nc_s_area_6_12 - c_s_area_6_12_1w
diff_area_s_6_12_2w <- nc_s_area_6_12 - c_s_area_6_12_2w
diff_area_s_6_12_1m <- nc_s_area_6_12 - c_s_area_6_12_1m
diff_area_s_6_12_2m <- nc_s_area_6_12 - c_s_area_6_12_2m

#Age group <13-16> 

nc_s_area_13_16 <- sum(fraction.infected_13_16_s$V1)
c_s_area_13_16_1w <- sum(fraction.infected_13_16_s$V2)
c_s_area_13_16_2w <- sum(fraction.infected_13_16_s$V3)
c_s_area_13_16_1m <- sum(fraction.infected_13_16_s$V4)
c_s_area_13_16_2m <- sum(fraction.infected_13_16_s$V5)
diff_area_s_13_16_1w <- nc_s_area_13_16 - c_s_area_13_16_1w
diff_area_s_13_16_2w <- nc_s_area_13_16 - c_s_area_13_16_2w
diff_area_s_13_16_1m <- nc_s_area_13_16 - c_s_area_13_16_1m
diff_area_s_13_16_2m <- nc_s_area_13_16 - c_s_area_13_16_2m

#Age group <17-18> 

nc_s_area_17_18 <- sum(fraction.infected_17_18_s$V1)
c_s_area_17_18_1w <- sum(fraction.infected_17_18_s$V2)
c_s_area_17_18_2w <- sum(fraction.infected_17_18_s$V3)
c_s_area_17_18_1m <- sum(fraction.infected_17_18_s$V4)
c_s_area_17_18_2m <- sum(fraction.infected_17_18_s$V5)
diff_area_s_17_18_1w <- nc_s_area_17_18 - c_s_area_17_18_1w
diff_area_s_17_18_2w <- nc_s_area_17_18 - c_s_area_17_18_2w
diff_area_s_17_18_1m <- nc_s_area_17_18 - c_s_area_17_18_1m
diff_area_s_17_18_2m <- nc_s_area_17_18 - c_s_area_17_18_2m

#Age group <19-64> 

nc_s_area_19_64 <- sum(fraction.infected_19_64_s$V1)
c_s_area_19_64_1w <- sum(fraction.infected_19_64_s$V2)
c_s_area_19_64_2w <- sum(fraction.infected_19_64_s$V3)
c_s_area_19_64_1m <- sum(fraction.infected_19_64_s$V4)
c_s_area_19_64_2m <- sum(fraction.infected_19_64_s$V5)
diff_area_s_19_64_1w <- nc_s_area_19_64 - c_s_area_19_64_1w
diff_area_s_19_64_2w <- nc_s_area_19_64 - c_s_area_19_64_2w
diff_area_s_19_64_1m <- nc_s_area_19_64 - c_s_area_19_64_1m
diff_area_s_19_64_2m <- nc_s_area_19_64 - c_s_area_19_64_2m

#Age group <65+> 

nc_s_area_65 <- sum(fraction.infected_65_s$V1)
c_s_area_65_1w <- sum(fraction.infected_65_s$V2)
c_s_area_65_2w <- sum(fraction.infected_65_s$V3)
c_s_area_65_1m <- sum(fraction.infected_65_s$V4)
c_s_area_65_2m <- sum(fraction.infected_65_s$V5)
diff_area_s_65_1w <- nc_s_area_65 - c_s_area_65_1w
diff_area_s_65_2w <- nc_s_area_65 - c_s_area_65_2w
diff_area_s_65_1m <- nc_s_area_65 - c_s_area_65_1m
diff_area_s_65_2m <- nc_s_area_65 - c_s_area_65_2m

#Results in a table 
Total_Reduction_s_results <- data.frame(
  Total_infected_no_school_closure = c(nc_s_area_0_2,nc_s_area_3_5,nc_s_area_6_12,nc_s_area_13_16,nc_s_area_17_18,nc_s_area_19_64,nc_s_area_65),
  Total_infected_school_closure_1_week = c(c_s_area_0_2_1w,c_s_area_3_5_1w,c_s_area_6_12_1w,c_s_area_13_16_1w,c_s_area_17_18_1w,c_s_area_19_64_1w,c_s_area_65_1w),
  Reduction_1_week = c(diff_area_s_0_2_1w,diff_area_s_3_5_1w,diff_area_s_6_12_1w,diff_area_s_13_16_1w,diff_area_s_17_18_1w,diff_area_s_19_64_1w,diff_area_s_65_1w),
  Reduction_percentage_1_week = c(diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_65_1w*100/nc_s_area_65),
  Total_infected_school_closure_2_weeks = c(c_s_area_0_2_2w,c_s_area_3_5_2w,c_s_area_6_12_2w,c_s_area_13_16_2w,c_s_area_17_18_2w,c_s_area_19_64_2w,c_s_area_65_2w),
  Reduction_2_weeks = c(diff_area_s_0_2_2w,diff_area_s_3_5_2w,diff_area_s_6_12_2w,diff_area_s_13_16_2w,diff_area_s_17_18_2w,diff_area_s_19_64_2w,diff_area_s_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_65_2w*100/nc_s_area_65),
  Total_infected_school_closure_1_month = c(c_s_area_0_2_1m,c_s_area_3_5_1m,c_s_area_6_12_1m,c_s_area_13_16_1m,c_s_area_17_18_1m,c_s_area_19_64_1m,c_s_area_65_1m),
  Reduction_1_month = c(diff_area_s_0_2_1m,diff_area_s_3_5_1m,diff_area_s_6_12_1m,diff_area_s_13_16_1m,diff_area_s_17_18_1m,diff_area_s_19_64_1m,diff_area_s_65_1m),
  Reduction_percentage_1_month = c(diff_area_s_0_2_1m*100/nc_s_area_0_2,diff_area_s_3_5_1m*100/nc_s_area_3_5,diff_area_s_6_12_1m*100/nc_s_area_6_12,diff_area_s_13_16_1m*100/nc_s_area_13_16,diff_area_s_17_18_1m*100/nc_s_area_17_18,diff_area_s_19_64_1m*100/nc_s_area_19_64,diff_area_s_65_1m*100/nc_s_area_65),
  Total_infected_school_closure_2_months = c(c_s_area_0_2_2m,c_s_area_3_5_2m,c_s_area_6_12_2m,c_s_area_13_16_2m,c_s_area_17_18_2m,c_s_area_19_64_2m,c_s_area_65_2m),
  Reduction_2_months = c(diff_area_s_0_2_2m,diff_area_s_3_5_2m,diff_area_s_6_12_2m,diff_area_s_13_16_2m,diff_area_s_17_18_2m,diff_area_s_19_64_2m,diff_area_s_65_2m),
  Reduction_percentage_2_months = c(diff_area_s_0_2_2m*100/nc_s_area_0_2,diff_area_s_3_5_2m*100/nc_s_area_3_5,diff_area_s_6_12_2m*100/nc_s_area_6_12,diff_area_s_13_16_2m*100/nc_s_area_13_16,diff_area_s_17_18_2m*100/nc_s_area_17_18,diff_area_s_19_64_2m*100/nc_s_area_19_64,diff_area_s_65_2m*100/nc_s_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_s_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_s <- data.frame(
  Date_beginning_closure = c(7,14,30,60),
  Reduction_percentage_0_2 = c(diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_0_2_1m*100/nc_s_area_0_2,diff_area_s_0_2_2m*100/nc_s_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_3_5_1m*100/nc_s_area_3_5,diff_area_s_3_5_2m*100/nc_s_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_6_12_1m*100/nc_s_area_6_12,diff_area_s_6_12_2m*100/nc_s_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_13_16_1m*100/nc_s_area_13_16,diff_area_s_13_16_2m*100/nc_s_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_17_18_1m*100/nc_s_area_17_18,diff_area_s_17_18_2m*100/nc_s_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_19_64_1m*100/nc_s_area_19_64,diff_area_s_19_64_2m*100/nc_s_area_19_64),
  Reduction_percentage_65 = c(diff_area_s_65_1w*100/nc_s_area_65,diff_area_s_65_2w*100/nc_s_area_65,diff_area_s_65_1m*100/nc_s_area_65,diff_area_s_65_2m*100/nc_s_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_s ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

We can see with these figures that school closure must be realised as quickly as possible as it becomes rapidly inefficient. Indeed, for a majority of age groups, a school closure 2 weeks after the beginning of the epidemy will only reduce the number of people affected by 1% and a school closure after a month is completely ineficient. 

### For high risk people 

We obtain the following graphics: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_s <- NULL
fraction.infected_0_2_s$Time <- odes_no_closure_s$Time
fraction.infected_0_2_s$V1 <- odes_no_closure_s$V8
fraction.infected_0_2_s$V2 <- odes_closure_s_2w$V8
fraction.infected_0_2_s$V3 <- odes_closure_s_3w$V8
fraction.infected_0_2_s$V4 <- odes_closure_s_1m$V8
fraction.infected_0_2_s$V5 <- odes_closure_s_2m$V8

fraction.infected_0_2_s <-data.frame(fraction.infected_0_2_s)

ggplot( data=fraction.infected_0_2_s ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure for 2 weeks","0-2 with school closure for 3 weeks","0-2 with school closure for 1 month","0-2 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_s <- NULL
fraction.infected_3_5_s$Time <- odes_no_closure_s$Time
fraction.infected_3_5_s$V1 <- odes_no_closure_s$V9
fraction.infected_3_5_s$V2 <- odes_closure_s_2w$V9
fraction.infected_3_5_s$V3 <- odes_closure_s_3w$V9
fraction.infected_3_5_s$V4 <- odes_closure_s_1m$V9
fraction.infected_3_5_s$V5 <- odes_closure_s_2m$V9

fraction.infected_3_5_s <-data.frame(fraction.infected_3_5_s)

fraction.infected_6_12_s <- NULL
fraction.infected_6_12_s$Time <- odes_no_closure_s$Time
fraction.infected_6_12_s$V1 <- odes_no_closure_s$V10
fraction.infected_6_12_s$V2 <- odes_closure_s_2w$V10
fraction.infected_6_12_s$V3 <- odes_closure_s_3w$V10
fraction.infected_6_12_s$V4 <- odes_closure_s_1m$V10
fraction.infected_6_12_s$V5 <- odes_closure_s_2m$V10

fraction.infected_6_12_s <-data.frame(fraction.infected_6_12_s)

fraction.infected_13_16_s <- NULL
fraction.infected_13_16_s$Time <- odes_no_closure_s$Time
fraction.infected_13_16_s$V1 <- odes_no_closure_s$V11
fraction.infected_13_16_s$V2 <- odes_closure_s_2w$V11
fraction.infected_13_16_s$V3 <- odes_closure_s_3w$V11
fraction.infected_13_16_s$V4 <- odes_closure_s_1m$V11
fraction.infected_13_16_s$V5 <- odes_closure_s_2m$V11

fraction.infected_13_16_s <-data.frame(fraction.infected_13_16_s)

fraction.infected_17_18_s <- NULL
fraction.infected_17_18_s$Time <- odes_no_closure_s$Time
fraction.infected_17_18_s$V1 <- odes_no_closure_s$V12
fraction.infected_17_18_s$V2 <- odes_closure_s_2w$V1
fraction.infected_17_18_s$V3 <- odes_closure_s_3w$V12
fraction.infected_17_18_s$V4 <- odes_closure_s_1m$V12
fraction.infected_17_18_s$V5 <- odes_closure_s_2m$V12

fraction.infected_17_18_s <-data.frame(fraction.infected_17_18_s)

fraction.infected_3_18_s <- NULL
fraction.infected_3_18_s$Time <- odes_no_closure_s$Time
fraction.infected_3_18_s$V1<-rowSums(data.frame(fraction.infected_3_5_s$V1,fraction.infected_6_12_s$V1,fraction.infected_13_16_s$V1,fraction.infected_17_18_s$V1))
fraction.infected_3_18_s$V2 <- rowSums(data.frame(fraction.infected_3_5_s$V2,fraction.infected_6_12_s$V2,fraction.infected_13_16_s$V2,fraction.infected_17_18_s$V2))
fraction.infected_3_18_s$V3 <- rowSums(data.frame(fraction.infected_3_5_s$V3,fraction.infected_6_12_s$V3,fraction.infected_13_16_s$V3,fraction.infected_17_18_s$V3))
fraction.infected_3_18_s$V4 <- rowSums(data.frame(fraction.infected_3_5_s$V4,fraction.infected_6_12_s$V4,fraction.infected_13_16_s$V4,fraction.infected_17_18_s$V4))
fraction.infected_3_18_s$V5 <- rowSums(data.frame(fraction.infected_3_5_s$V5,fraction.infected_6_12_s$V5,fraction.infected_13_16_s$V5,fraction.infected_17_18_s$V5))

fraction.infected_3_18_s <-data.frame(fraction.infected_3_18_s)

ggplot( data=fraction.infected_3_18_s ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure for 2 weeks","3-18 with school closure for 3 weeks","3-18 with school closure for 1 month","3-18 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_s <- NULL
fraction.infected_19_64_s$Time <- odes_no_closure_s$Time
fraction.infected_19_64_s$V1 <- odes_no_closure_s$V13
fraction.infected_19_64_s$V2 <- odes_closure_s_2w$V13
fraction.infected_19_64_s$V3 <- odes_closure_s_3w$V13
fraction.infected_19_64_s$V4 <- odes_closure_s_1m$V13
fraction.infected_19_64_s$V5 <- odes_closure_s_2m$V13

fraction.infected_19_64_s <-data.frame(fraction.infected_19_64_s)

ggplot( data=fraction.infected_19_64_s ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure for 2 weeks","19-64 with school closure for 3 weeks","19-64 with school closure for 1 month","19-64 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_s <- NULL
fraction.infected_65_s$Time <- odes_no_closure_s$Time
fraction.infected_65_s$V1 <- odes_no_closure_s$V14
fraction.infected_65_s$V2 <- odes_closure_s_2w$V14
fraction.infected_65_s$V3 <- odes_closure_s_3w$V14
fraction.infected_65_s$V4 <- odes_closure_s_1m$V14
fraction.infected_65_s$V5 <- odes_closure_s_2m$V14

fraction.infected_65_s <-data.frame(fraction.infected_65_s)

ggplot( data=fraction.infected_65_s ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure for 2 weeks","65+ with school closure for 3 weeks","65+ with school closure for 1 month","65+ with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of seasonal flu for age group 65+")

```

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_s_area_0_2 <- sum(fraction.infected_0_2_s$V1)
c_s_area_0_2_1w <- sum(fraction.infected_0_2_s$V2)
c_s_area_0_2_2w <- sum(fraction.infected_0_2_s$V3)
c_s_area_0_2_1m <- sum(fraction.infected_0_2_s$V4)
c_s_area_0_2_2m <- sum(fraction.infected_0_2_s$V5)
diff_area_s_0_2_1w <- nc_s_area_0_2 - c_s_area_0_2_1w
diff_area_s_0_2_2w <- nc_s_area_0_2 - c_s_area_0_2_2w
diff_area_s_0_2_1m <- nc_s_area_0_2 - c_s_area_0_2_1m
diff_area_s_0_2_2m <- nc_s_area_0_2 - c_s_area_0_2_2m

#Age group <3-5> 

nc_s_area_3_5 <- sum(fraction.infected_3_5_s$V1)
c_s_area_3_5_1w <- sum(fraction.infected_3_5_s$V2)
c_s_area_3_5_2w <- sum(fraction.infected_3_5_s$V3)
c_s_area_3_5_1m <- sum(fraction.infected_3_5_s$V4)
c_s_area_3_5_2m <- sum(fraction.infected_3_5_s$V5)
diff_area_s_3_5_1w <- nc_s_area_3_5 - c_s_area_3_5_1w
diff_area_s_3_5_2w <- nc_s_area_3_5 - c_s_area_3_5_2w
diff_area_s_3_5_1m <- nc_s_area_3_5 - c_s_area_3_5_1m
diff_area_s_3_5_2m <- nc_s_area_3_5 - c_s_area_3_5_2m

#Age group <6-12> 

nc_s_area_6_12 <- sum(fraction.infected_6_12_s$V1)
c_s_area_6_12_1w <- sum(fraction.infected_6_12_s$V2)
c_s_area_6_12_2w <- sum(fraction.infected_6_12_s$V3)
c_s_area_6_12_1m <- sum(fraction.infected_6_12_s$V4)
c_s_area_6_12_2m <- sum(fraction.infected_6_12_s$V5)
diff_area_s_6_12_1w <- nc_s_area_6_12 - c_s_area_6_12_1w
diff_area_s_6_12_2w <- nc_s_area_6_12 - c_s_area_6_12_2w
diff_area_s_6_12_1m <- nc_s_area_6_12 - c_s_area_6_12_1m
diff_area_s_6_12_2m <- nc_s_area_6_12 - c_s_area_6_12_2m

#Age group <13-16> 

nc_s_area_13_16 <- sum(fraction.infected_13_16_s$V1)
c_s_area_13_16_1w <- sum(fraction.infected_13_16_s$V2)
c_s_area_13_16_2w <- sum(fraction.infected_13_16_s$V3)
c_s_area_13_16_1m <- sum(fraction.infected_13_16_s$V4)
c_s_area_13_16_2m <- sum(fraction.infected_13_16_s$V5)
diff_area_s_13_16_1w <- nc_s_area_13_16 - c_s_area_13_16_1w
diff_area_s_13_16_2w <- nc_s_area_13_16 - c_s_area_13_16_2w
diff_area_s_13_16_1m <- nc_s_area_13_16 - c_s_area_13_16_1m
diff_area_s_13_16_2m <- nc_s_area_13_16 - c_s_area_13_16_2m

#Age group <17-18> 

nc_s_area_17_18 <- sum(fraction.infected_17_18_s$V1)
c_s_area_17_18_1w <- sum(fraction.infected_17_18_s$V2)
c_s_area_17_18_2w <- sum(fraction.infected_17_18_s$V3)
c_s_area_17_18_1m <- sum(fraction.infected_17_18_s$V4)
c_s_area_17_18_2m <- sum(fraction.infected_17_18_s$V5)
diff_area_s_17_18_1w <- nc_s_area_17_18 - c_s_area_17_18_1w
diff_area_s_17_18_2w <- nc_s_area_17_18 - c_s_area_17_18_2w
diff_area_s_17_18_1m <- nc_s_area_17_18 - c_s_area_17_18_1m
diff_area_s_17_18_2m <- nc_s_area_17_18 - c_s_area_17_18_2m

#Age group <19-64> 

nc_s_area_19_64 <- sum(fraction.infected_19_64_s$V1)
c_s_area_19_64_1w <- sum(fraction.infected_19_64_s$V2)
c_s_area_19_64_2w <- sum(fraction.infected_19_64_s$V3)
c_s_area_19_64_1m <- sum(fraction.infected_19_64_s$V4)
c_s_area_19_64_2m <- sum(fraction.infected_19_64_s$V5)
diff_area_s_19_64_1w <- nc_s_area_19_64 - c_s_area_19_64_1w
diff_area_s_19_64_2w <- nc_s_area_19_64 - c_s_area_19_64_2w
diff_area_s_19_64_1m <- nc_s_area_19_64 - c_s_area_19_64_1m
diff_area_s_19_64_2m <- nc_s_area_19_64 - c_s_area_19_64_2m

#Age group <65+> 

nc_s_area_65 <- sum(fraction.infected_65_s$V1)
c_s_area_65_1w <- sum(fraction.infected_65_s$V2)
c_s_area_65_2w <- sum(fraction.infected_65_s$V3)
c_s_area_65_1m <- sum(fraction.infected_65_s$V4)
c_s_area_65_2m <- sum(fraction.infected_65_s$V5)
diff_area_s_65_1w <- nc_s_area_65 - c_s_area_65_1w
diff_area_s_65_2w <- nc_s_area_65 - c_s_area_65_2w
diff_area_s_65_1m <- nc_s_area_65 - c_s_area_65_1m
diff_area_s_65_2m <- nc_s_area_65 - c_s_area_65_2m

#Results in a table 
Total_Reduction_s_results <- data.frame(
  Total_infected_no_school_closure = c(nc_s_area_0_2,nc_s_area_3_5,nc_s_area_6_12,nc_s_area_13_16,nc_s_area_17_18,nc_s_area_19_64,nc_s_area_65),
  Total_infected_school_closure_1_week = c(c_s_area_0_2_1w,c_s_area_3_5_1w,c_s_area_6_12_1w,c_s_area_13_16_1w,c_s_area_17_18_1w,c_s_area_19_64_1w,c_s_area_65_1w),
  Reduction_1_week = c(diff_area_s_0_2_1w,diff_area_s_3_5_1w,diff_area_s_6_12_1w,diff_area_s_13_16_1w,diff_area_s_17_18_1w,diff_area_s_19_64_1w,diff_area_s_65_1w),
  Reduction_percentage_1_week = c(diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_65_1w*100/nc_s_area_65),
  Total_infected_school_closure_2_weeks = c(c_s_area_0_2_2w,c_s_area_3_5_2w,c_s_area_6_12_2w,c_s_area_13_16_2w,c_s_area_17_18_2w,c_s_area_19_64_2w,c_s_area_65_2w),
  Reduction_2_weeks = c(diff_area_s_0_2_2w,diff_area_s_3_5_2w,diff_area_s_6_12_2w,diff_area_s_13_16_2w,diff_area_s_17_18_2w,diff_area_s_19_64_2w,diff_area_s_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_65_2w*100/nc_s_area_65),
  Total_infected_school_closure_1_month = c(c_s_area_0_2_1m,c_s_area_3_5_1m,c_s_area_6_12_1m,c_s_area_13_16_1m,c_s_area_17_18_1m,c_s_area_19_64_1m,c_s_area_65_1m),
  Reduction_1_month = c(diff_area_s_0_2_1m,diff_area_s_3_5_1m,diff_area_s_6_12_1m,diff_area_s_13_16_1m,diff_area_s_17_18_1m,diff_area_s_19_64_1m,diff_area_s_65_1m),
  Reduction_percentage_1_month = c(diff_area_s_0_2_1m*100/nc_s_area_0_2,diff_area_s_3_5_1m*100/nc_s_area_3_5,diff_area_s_6_12_1m*100/nc_s_area_6_12,diff_area_s_13_16_1m*100/nc_s_area_13_16,diff_area_s_17_18_1m*100/nc_s_area_17_18,diff_area_s_19_64_1m*100/nc_s_area_19_64,diff_area_s_65_1m*100/nc_s_area_65),
  Total_infected_school_closure_2_months = c(c_s_area_0_2_2m,c_s_area_3_5_2m,c_s_area_6_12_2m,c_s_area_13_16_2m,c_s_area_17_18_2m,c_s_area_19_64_2m,c_s_area_65_2m),
  Reduction_2_months = c(diff_area_s_0_2_2m,diff_area_s_3_5_2m,diff_area_s_6_12_2m,diff_area_s_13_16_2m,diff_area_s_17_18_2m,diff_area_s_19_64_2m,diff_area_s_65_2m),
  Reduction_percentage_2_months = c(diff_area_s_0_2_2m*100/nc_s_area_0_2,diff_area_s_3_5_2m*100/nc_s_area_3_5,diff_area_s_6_12_2m*100/nc_s_area_6_12,diff_area_s_13_16_2m*100/nc_s_area_13_16,diff_area_s_17_18_2m*100/nc_s_area_17_18,diff_area_s_19_64_2m*100/nc_s_area_19_64,diff_area_s_65_2m*100/nc_s_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_s_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_s <- data.frame(
  Date_beginning_closure = c(7,14,30,60),
  Reduction_percentage_0_2 = c(diff_area_s_0_2_1w*100/nc_s_area_0_2,diff_area_s_0_2_2w*100/nc_s_area_0_2,diff_area_s_0_2_1m*100/nc_s_area_0_2,diff_area_s_0_2_2m*100/nc_s_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_s_3_5_1w*100/nc_s_area_3_5,diff_area_s_3_5_2w*100/nc_s_area_3_5,diff_area_s_3_5_1m*100/nc_s_area_3_5,diff_area_s_3_5_2m*100/nc_s_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_s_6_12_1w*100/nc_s_area_6_12,diff_area_s_6_12_2w*100/nc_s_area_6_12,diff_area_s_6_12_1m*100/nc_s_area_6_12,diff_area_s_6_12_2m*100/nc_s_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_s_13_16_1w*100/nc_s_area_13_16,diff_area_s_13_16_2w*100/nc_s_area_13_16,diff_area_s_13_16_1m*100/nc_s_area_13_16,diff_area_s_13_16_2m*100/nc_s_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_s_17_18_1w*100/nc_s_area_17_18,diff_area_s_17_18_2w*100/nc_s_area_17_18,diff_area_s_17_18_1m*100/nc_s_area_17_18,diff_area_s_17_18_2m*100/nc_s_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_s_19_64_1w*100/nc_s_area_19_64,diff_area_s_19_64_2w*100/nc_s_area_19_64,diff_area_s_19_64_1m*100/nc_s_area_19_64,diff_area_s_19_64_2m*100/nc_s_area_19_64),
  Reduction_percentage_65 = c(diff_area_s_65_1w*100/nc_s_area_65,diff_area_s_65_2w*100/nc_s_area_65,diff_area_s_65_1m*100/nc_s_area_65,diff_area_s_65_2m*100/nc_s_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_s ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

We can see with these figures that school closure must be realised as quickly as possible as it becomes rapidly inefficient. Indeed, for a majority of age groups, a school closure 2 weeks after the beginning of the epidemy will only reduce the number of people affected by 1% and a school closure after a month is completely ineficient. 

We can conclude that the best beginning date for school closure is right after the beginning of the epidemy. However, this measure demands time to be put in place and one week after the beginning of the epidemy will probably be the fastest school closure possible. 

## For pandemic flu

We do the same simulation for pandemic flu. 

```{r}

#Result in case of no school closure 

odes_no_closure_p <- infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7)

#Result in case of school closure from 2007-09-30 to 2007-10-14

odes_closure_p_2w <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-14"))

#Result in case of school closure from 2007-09-30 to 2007-10-21

odes_closure_p_3w <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-21"))

#Result in case of school closure from 2007-09-30 to 2007-10-30

odes_closure_p_1m <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-10-30"))

#Result in case of school closure from 2007-09-30 to 2007-11-30

odes_closure_p_2m <-infection_odin_closure(population, initial.infected, vaccine_calendar_p, contacts_no_closure,contacts_closure, susceptibility_p, transmissibility_p, infection_delays_p, 7, date_begin_closure = as.Date("2007-09-30"), date_end_closure = as.Date(" 2007-11-30"))

```

### For low risk people 

We obtain the following graphics: 

```{r,fig.width=20,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_p <- NULL
fraction.infected_0_2_p$Time <- odes_no_closure_p$Time
fraction.infected_0_2_p$V1 <- odes_no_closure_p$V1
fraction.infected_0_2_p$V2 <- odes_closure_p_2w$V1
fraction.infected_0_2_p$V3 <- odes_closure_p_3w$V1
fraction.infected_0_2_p$V4 <- odes_closure_p_1m$V1
fraction.infected_0_2_p$V5 <- odes_closure_p_2m$V1

fraction.infected_0_2_p <-data.frame(fraction.infected_0_2_p)

ggplot( data=fraction.infected_0_2_p ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure for 2 weeks","0-2 with school closure for 3 weeks","0-2 with school closure for 1 month","0-2 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_p <- NULL
fraction.infected_3_5_p$Time <- odes_no_closure_p$Time
fraction.infected_3_5_p$V1 <- odes_no_closure_p$V2
fraction.infected_3_5_p$V2 <- odes_closure_p_2w$V2
fraction.infected_3_5_p$V3 <- odes_closure_p_3w$V2
fraction.infected_3_5_p$V4 <- odes_closure_p_1m$V2
fraction.infected_3_5_p$V5 <- odes_closure_p_2m$V2

fraction.infected_3_5_p <-data.frame(fraction.infected_3_5_p)

fraction.infected_6_12_p <- NULL
fraction.infected_6_12_p$Time <- odes_no_closure_p$Time
fraction.infected_6_12_p$V1 <- odes_no_closure_p$V3
fraction.infected_6_12_p$V2 <- odes_closure_p_2w$V3
fraction.infected_6_12_p$V3 <- odes_closure_p_3w$V3
fraction.infected_6_12_p$V4 <- odes_closure_p_1m$V3
fraction.infected_6_12_p$V5 <- odes_closure_p_2m$V3

fraction.infected_6_12_p <-data.frame(fraction.infected_6_12_p)

fraction.infected_13_16_p <- NULL
fraction.infected_13_16_p$Time <- odes_no_closure_p$Time
fraction.infected_13_16_p$V1 <- odes_no_closure_p$V4
fraction.infected_13_16_p$V2 <- odes_closure_p_2w$V4
fraction.infected_13_16_p$V3 <- odes_closure_p_3w$V4
fraction.infected_13_16_p$V4 <- odes_closure_p_1m$V4
fraction.infected_13_16_p$V5 <- odes_closure_p_2m$V4

fraction.infected_13_16_p <-data.frame(fraction.infected_13_16_p)

fraction.infected_17_18_p <- NULL
fraction.infected_17_18_p$Time <- odes_no_closure_p$Time
fraction.infected_17_18_p$V1 <- odes_no_closure_p$V5
fraction.infected_17_18_p$V2 <- odes_closure_p_2w$V5
fraction.infected_17_18_p$V3 <- odes_closure_p_3w$V5
fraction.infected_17_18_p$V4 <- odes_closure_p_1m$V5
fraction.infected_17_18_p$V5 <- odes_closure_p_2m$V5

fraction.infected_17_18_p <-data.frame(fraction.infected_17_18_p)

fraction.infected_3_18_p <- NULL
fraction.infected_3_18_p$Time <- odes_no_closure_p$Time
fraction.infected_3_18_p$V1<-rowSums(data.frame(fraction.infected_3_5_p$V1,fraction.infected_6_12_p$V1,fraction.infected_13_16_p$V1,fraction.infected_17_18_p$V1))
fraction.infected_3_18_p$V2 <- rowSums(data.frame(fraction.infected_3_5_p$V2,fraction.infected_6_12_p$V2,fraction.infected_13_16_p$V2,fraction.infected_17_18_p$V2))
fraction.infected_3_18_p$V3 <- rowSums(data.frame(fraction.infected_3_5_p$V3,fraction.infected_6_12_p$V3,fraction.infected_13_16_p$V3,fraction.infected_17_18_p$V3))
fraction.infected_3_18_p$V4 <- rowSums(data.frame(fraction.infected_3_5_p$V4,fraction.infected_6_12_p$V4,fraction.infected_13_16_p$V4,fraction.infected_17_18_p$V4))
fraction.infected_3_18_p$V5 <- rowSums(data.frame(fraction.infected_3_5_p$V5,fraction.infected_6_12_p$V5,fraction.infected_13_16_p$V5,fraction.infected_17_18_p$V5))

fraction.infected_3_18_p <-data.frame(fraction.infected_3_18_p)

ggplot( data=fraction.infected_3_18_p ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure for 2 weeks","3-18 with school closure for 3 weeks","3-18 with school closure for 1 month","3-18 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_p <- NULL
fraction.infected_19_64_p$Time <- odes_no_closure_p$Time
fraction.infected_19_64_p$V1 <- odes_no_closure_p$V6
fraction.infected_19_64_p$V2 <- odes_closure_p_2w$V6
fraction.infected_19_64_p$V3 <- odes_closure_p_3w$V6
fraction.infected_19_64_p$V4 <- odes_closure_p_1m$V6
fraction.infected_19_64_p$V5 <- odes_closure_p_2m$V6

fraction.infected_19_64_p <-data.frame(fraction.infected_19_64_p)

ggplot( data=fraction.infected_19_64_p ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure for 2 weeks","19-64 with school closure for 3 weeks","19-64 with school closure for 1 month","19-64 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_p <- NULL
fraction.infected_65_p$Time <- odes_no_closure_p$Time
fraction.infected_65_p$V1 <- odes_no_closure_p$V7
fraction.infected_65_p$V2 <- odes_closure_p_2w$V7
fraction.infected_65_p$V3 <- odes_closure_p_3w$V7
fraction.infected_65_p$V4 <- odes_closure_p_1m$V7
fraction.infected_65_p$V5 <- odes_closure_p_2m$V7

fraction.infected_65_p <-data.frame(fraction.infected_65_p)

ggplot( data=fraction.infected_65_p ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure for 2 weeks","65+ with school closure for 3 weeks","65+ with school closure for 1 month","65+ with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 65+")

```

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_p_area_0_2 <- sum(fraction.infected_0_2_p$V1)
c_p_area_0_2_1w <- sum(fraction.infected_0_2_p$V2)
c_p_area_0_2_2w <- sum(fraction.infected_0_2_p$V3)
c_p_area_0_2_1m <- sum(fraction.infected_0_2_p$V4)
c_p_area_0_2_2m <- sum(fraction.infected_0_2_p$V5)
diff_area_p_0_2_1w <- nc_p_area_0_2 - c_p_area_0_2_1w
diff_area_p_0_2_2w <- nc_p_area_0_2 - c_p_area_0_2_2w
diff_area_p_0_2_1m <- nc_p_area_0_2 - c_p_area_0_2_1m
diff_area_p_0_2_2m <- nc_p_area_0_2 - c_p_area_0_2_2m

#Age group <3-5> 

nc_p_area_3_5 <- sum(fraction.infected_3_5_p$V1)
c_p_area_3_5_1w <- sum(fraction.infected_3_5_p$V2)
c_p_area_3_5_2w <- sum(fraction.infected_3_5_p$V3)
c_p_area_3_5_1m <- sum(fraction.infected_3_5_p$V4)
c_p_area_3_5_2m <- sum(fraction.infected_3_5_p$V5)
diff_area_p_3_5_1w <- nc_p_area_3_5 - c_p_area_3_5_1w
diff_area_p_3_5_2w <- nc_p_area_3_5 - c_p_area_3_5_2w
diff_area_p_3_5_1m <- nc_p_area_3_5 - c_p_area_3_5_1m
diff_area_p_3_5_2m <- nc_p_area_3_5 - c_p_area_3_5_2m

#Age group <6-12> 

nc_p_area_6_12 <- sum(fraction.infected_6_12_p$V1)
c_p_area_6_12_1w <- sum(fraction.infected_6_12_p$V2)
c_p_area_6_12_2w <- sum(fraction.infected_6_12_p$V3)
c_p_area_6_12_1m <- sum(fraction.infected_6_12_p$V4)
c_p_area_6_12_2m <- sum(fraction.infected_6_12_p$V5)
diff_area_p_6_12_1w <- nc_p_area_6_12 - c_p_area_6_12_1w
diff_area_p_6_12_2w <- nc_p_area_6_12 - c_p_area_6_12_2w
diff_area_p_6_12_1m <- nc_p_area_6_12 - c_p_area_6_12_1m
diff_area_p_6_12_2m <- nc_p_area_6_12 - c_p_area_6_12_2m

#Age group <13-16> 

nc_p_area_13_16 <- sum(fraction.infected_13_16_p$V1)
c_p_area_13_16_1w <- sum(fraction.infected_13_16_p$V2)
c_p_area_13_16_2w <- sum(fraction.infected_13_16_p$V3)
c_p_area_13_16_1m <- sum(fraction.infected_13_16_p$V4)
c_p_area_13_16_2m <- sum(fraction.infected_13_16_p$V5)
diff_area_p_13_16_1w <- nc_p_area_13_16 - c_p_area_13_16_1w
diff_area_p_13_16_2w <- nc_p_area_13_16 - c_p_area_13_16_2w
diff_area_p_13_16_1m <- nc_p_area_13_16 - c_p_area_13_16_1m
diff_area_p_13_16_2m <- nc_p_area_13_16 - c_p_area_13_16_2m

#Age group <17-18> 

nc_p_area_17_18 <- sum(fraction.infected_17_18_p$V1)
c_p_area_17_18_1w <- sum(fraction.infected_17_18_p$V2)
c_p_area_17_18_2w <- sum(fraction.infected_17_18_p$V3)
c_p_area_17_18_1m <- sum(fraction.infected_17_18_p$V4)
c_p_area_17_18_2m <- sum(fraction.infected_17_18_p$V5)
diff_area_p_17_18_1w <- nc_p_area_17_18 - c_p_area_17_18_1w
diff_area_p_17_18_2w <- nc_p_area_17_18 - c_p_area_17_18_2w
diff_area_p_17_18_1m <- nc_p_area_17_18 - c_p_area_17_18_1m
diff_area_p_17_18_2m <- nc_p_area_17_18 - c_p_area_17_18_2m

#Age group <19-64> 

nc_p_area_19_64 <- sum(fraction.infected_19_64_p$V1)
c_p_area_19_64_1w <- sum(fraction.infected_19_64_p$V2)
c_p_area_19_64_2w <- sum(fraction.infected_19_64_p$V3)
c_p_area_19_64_1m <- sum(fraction.infected_19_64_p$V4)
c_p_area_19_64_2m <- sum(fraction.infected_19_64_p$V5)
diff_area_p_19_64_1w <- nc_p_area_19_64 - c_p_area_19_64_1w
diff_area_p_19_64_2w <- nc_p_area_19_64 - c_p_area_19_64_2w
diff_area_p_19_64_1m <- nc_p_area_19_64 - c_p_area_19_64_1m
diff_area_p_19_64_2m <- nc_p_area_19_64 - c_p_area_19_64_2m

#Age group <65+> 

nc_p_area_65 <- sum(fraction.infected_65_p$V1)
c_p_area_65_1w <- sum(fraction.infected_65_p$V2)
c_p_area_65_2w <- sum(fraction.infected_65_p$V3)
c_p_area_65_1m <- sum(fraction.infected_65_p$V4)
c_p_area_65_2m <- sum(fraction.infected_65_p$V5)
diff_area_p_65_1w <- nc_p_area_65 - c_p_area_65_1w
diff_area_p_65_2w <- nc_p_area_65 - c_p_area_65_2w
diff_area_p_65_1m <- nc_p_area_65 - c_p_area_65_1m
diff_area_p_65_2m <- nc_p_area_65 - c_p_area_65_2m

#Results in a table 
Total_Reduction_p_results <- data.frame(
  Total_infected_no_school_closure = c(nc_p_area_0_2,nc_p_area_3_5,nc_p_area_6_12,nc_p_area_13_16,nc_p_area_17_18,nc_p_area_19_64,nc_p_area_65),
  Total_infected_school_closure_1_week = c(c_p_area_0_2_1w,c_p_area_3_5_1w,c_p_area_6_12_1w,c_p_area_13_16_1w,c_p_area_17_18_1w,c_p_area_19_64_1w,c_p_area_65_1w),
  Reduction_1_week = c(diff_area_p_0_2_1w,diff_area_p_3_5_1w,diff_area_p_6_12_1w,diff_area_p_13_16_1w,diff_area_p_17_18_1w,diff_area_p_19_64_1w,diff_area_p_65_1w),
  Reduction_percentage_1_week = c(diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_65_1w*100/nc_p_area_65),
  Total_infected_school_closure_2_weeks = c(c_p_area_0_2_2w,c_p_area_3_5_2w,c_p_area_6_12_2w,c_p_area_13_16_2w,c_p_area_17_18_2w,c_p_area_19_64_2w,c_p_area_65_2w),
  Reduction_2_weeks = c(diff_area_p_0_2_2w,diff_area_p_3_5_2w,diff_area_p_6_12_2w,diff_area_p_13_16_2w,diff_area_p_17_18_2w,diff_area_p_19_64_2w,diff_area_p_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_65_2w*100/nc_p_area_65),
  Total_infected_school_closure_1_month = c(c_p_area_0_2_1m,c_p_area_3_5_1m,c_p_area_6_12_1m,c_p_area_13_16_1m,c_p_area_17_18_1m,c_p_area_19_64_1m,c_p_area_65_1m),
  Reduction_1_month = c(diff_area_p_0_2_1m,diff_area_p_3_5_1m,diff_area_p_6_12_1m,diff_area_p_13_16_1m,diff_area_p_17_18_1m,diff_area_p_19_64_1m,diff_area_p_65_1m),
  Reduction_percentage_1_month = c(diff_area_p_0_2_1m*100/nc_p_area_0_2,diff_area_p_3_5_1m*100/nc_p_area_3_5,diff_area_p_6_12_1m*100/nc_p_area_6_12,diff_area_p_13_16_1m*100/nc_p_area_13_16,diff_area_p_17_18_1m*100/nc_p_area_17_18,diff_area_p_19_64_1m*100/nc_p_area_19_64,diff_area_p_65_1m*100/nc_p_area_65),
  Total_infected_school_closure_2_months = c(c_p_area_0_2_2m,c_p_area_3_5_2m,c_p_area_6_12_2m,c_p_area_13_16_2m,c_p_area_17_18_2m,c_p_area_19_64_2m,c_p_area_65_2m),
  Reduction_2_months = c(diff_area_p_0_2_2m,diff_area_p_3_5_2m,diff_area_p_6_12_2m,diff_area_p_13_16_2m,diff_area_p_17_18_2m,diff_area_p_19_64_2m,diff_area_p_65_2m),
  Reduction_percentage_2_months = c(diff_area_p_0_2_2m*100/nc_p_area_0_2,diff_area_p_3_5_2m*100/nc_p_area_3_5,diff_area_p_6_12_2m*100/nc_p_area_6_12,diff_area_p_13_16_2m*100/nc_p_area_13_16,diff_area_p_17_18_2m*100/nc_p_area_17_18,diff_area_p_19_64_2m*100/nc_p_area_19_64,diff_area_p_65_2m*100/nc_p_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_p_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_p <- data.frame(
  Date_beginning_closure = c(7,14,30,60),
  Reduction_percentage_0_2 = c(diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_0_2_1m*100/nc_p_area_0_2,diff_area_p_0_2_2m*100/nc_p_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_3_5_1m*100/nc_p_area_3_5,diff_area_p_3_5_2m*100/nc_p_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_6_12_1m*100/nc_p_area_6_12,diff_area_p_6_12_2m*100/nc_p_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_13_16_1m*100/nc_p_area_13_16,diff_area_p_13_16_2m*100/nc_p_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_17_18_1m*100/nc_p_area_17_18,diff_area_p_17_18_2m*100/nc_p_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_19_64_1m*100/nc_p_area_19_64,diff_area_p_19_64_2m*100/nc_p_area_19_64),
  Reduction_percentage_65 = c(diff_area_p_65_1w*100/nc_p_area_65,diff_area_p_65_2w*100/nc_p_area_65,diff_area_p_65_1m*100/nc_p_area_65,diff_area_p_65_2m*100/nc_p_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_p ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

We can see with these figures that school closure must be realised as quickly as possible as it becomes rapidly inefficient. Indeed, for a majority of age groups, a school closure 2 weeks after the beginning of the epidemy will only reduce the number of people affected by 1% and a school closure after a month is completely ineficient. 

### For high risk people 

We obtain the following graphics: 

```{r,fig.width=20,fig.height=8,fig.show='hold'}

#Graphic for age group <0-2>

fraction.infected_0_2_p <- NULL
fraction.infected_0_2_p$Time <- odes_no_closure_p$Time
fraction.infected_0_2_p$V1 <- odes_no_closure_p$V8
fraction.infected_0_2_p$V2 <- odes_closure_p_2w$V8
fraction.infected_0_2_p$V3 <- odes_closure_p_3w$V8
fraction.infected_0_2_p$V4 <- odes_closure_p_1m$V8
fraction.infected_0_2_p$V5 <- odes_closure_p_2m$V8

fraction.infected_0_2_p <-data.frame(fraction.infected_0_2_p)

ggplot( data=fraction.infected_0_2_p ) + geom_line( aes(x=Time, y=V1, colour = "0-2 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "0-2 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "0-2 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "0-2 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "0-2 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("0-2 without school closure","0-2 with school closure for 2 weeks","0-2 with school closure for 3 weeks","0-2 with school closure for 1 month","0-2 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 0-2")

#Graphic for age group <3-18> 

fraction.infected_3_5_p <- NULL
fraction.infected_3_5_p$Time <- odes_no_closure_p$Time
fraction.infected_3_5_p$V1 <- odes_no_closure_p$V9
fraction.infected_3_5_p$V2 <- odes_closure_p_2w$V9
fraction.infected_3_5_p$V3 <- odes_closure_p_3w$V9
fraction.infected_3_5_p$V4 <- odes_closure_p_1m$V9
fraction.infected_3_5_p$V5 <- odes_closure_p_2m$V9

fraction.infected_3_5_p <-data.frame(fraction.infected_3_5_p)

fraction.infected_6_12_p <- NULL
fraction.infected_6_12_p$Time <- odes_no_closure_p$Time
fraction.infected_6_12_p$V1 <- odes_no_closure_p$V10
fraction.infected_6_12_p$V2 <- odes_closure_p_2w$V10
fraction.infected_6_12_p$V3 <- odes_closure_p_3w$V10
fraction.infected_6_12_p$V4 <- odes_closure_p_1m$V10
fraction.infected_6_12_p$V5 <- odes_closure_p_2m$V10

fraction.infected_6_12_p <-data.frame(fraction.infected_6_12_p)

fraction.infected_13_16_p <- NULL
fraction.infected_13_16_p$Time <- odes_no_closure_p$Time
fraction.infected_13_16_p$V1 <- odes_no_closure_p$V11
fraction.infected_13_16_p$V2 <- odes_closure_p_2w$V11
fraction.infected_13_16_p$V3 <- odes_closure_p_3w$V11
fraction.infected_13_16_p$V4 <- odes_closure_p_1m$V11
fraction.infected_13_16_p$V5 <- odes_closure_p_2m$V11

fraction.infected_13_16_p <-data.frame(fraction.infected_13_16_p)

fraction.infected_17_18_p <- NULL
fraction.infected_17_18_p$Time <- odes_no_closure_p$Time
fraction.infected_17_18_p$V1 <- odes_no_closure_p$V12
fraction.infected_17_18_p$V2 <- odes_closure_p_2w$V12
fraction.infected_17_18_p$V3 <- odes_closure_p_3w$V12
fraction.infected_17_18_p$V4 <- odes_closure_p_1m$V12
fraction.infected_17_18_p$V5 <- odes_closure_p_2m$V12

fraction.infected_17_18_p <-data.frame(fraction.infected_17_18_p)

fraction.infected_3_18_p <- NULL
fraction.infected_3_18_p$Time <- odes_no_closure_p$Time
fraction.infected_3_18_p$V1<-rowSums(data.frame(fraction.infected_3_5_p$V1,fraction.infected_6_12_p$V1,fraction.infected_13_16_p$V1,fraction.infected_17_18_p$V1))
fraction.infected_3_18_p$V2 <- rowSums(data.frame(fraction.infected_3_5_p$V2,fraction.infected_6_12_p$V2,fraction.infected_13_16_p$V2,fraction.infected_17_18_p$V2))
fraction.infected_3_18_p$V3 <- rowSums(data.frame(fraction.infected_3_5_p$V3,fraction.infected_6_12_p$V3,fraction.infected_13_16_p$V3,fraction.infected_17_18_p$V3))
fraction.infected_3_18_p$V4 <- rowSums(data.frame(fraction.infected_3_5_p$V4,fraction.infected_6_12_p$V4,fraction.infected_13_16_p$V4,fraction.infected_17_18_p$V4))
fraction.infected_3_18_p$V5 <- rowSums(data.frame(fraction.infected_3_5_p$V5,fraction.infected_6_12_p$V5,fraction.infected_13_16_p$V5,fraction.infected_17_18_p$V5))

fraction.infected_3_18_p <-data.frame(fraction.infected_3_18_p)

ggplot( data=fraction.infected_3_18_p ) + geom_line( aes(x=Time, y=V1, colour = "3-18 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "3-18 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "3-18 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "3-18 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "3-18 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("3-18 without school closure","3-18 with school closure for 2 weeks","3-18 with school closure for 3 weeks","3-18 with school closure for 1 month","3-18 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 3-18")

#Graphic for age group <19-64>

fraction.infected_19_64_p <- NULL
fraction.infected_19_64_p$Time <- odes_no_closure_p$Time
fraction.infected_19_64_p$V1 <- odes_no_closure_p$V13
fraction.infected_19_64_p$V2 <- odes_closure_p_2w$V13
fraction.infected_19_64_p$V3 <- odes_closure_p_3w$V13
fraction.infected_19_64_p$V4 <- odes_closure_p_1m$V13
fraction.infected_19_64_p$V5 <- odes_closure_p_2m$V13

fraction.infected_19_64_p <-data.frame(fraction.infected_19_64_p)

ggplot( data=fraction.infected_19_64_p ) + geom_line( aes(x=Time, y=V1, colour = "19-64 without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "19-64 with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "19-64 with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "19-64 with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "19-64 with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("19-64 without school closure","19-64 with school closure for 2 weeks","19-64 with school closure for 3 weeks","19-64 with school closure for 1 month","19-64 with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 19-64")

#Graphic for age group <65+>

fraction.infected_65_p <- NULL
fraction.infected_65_p$Time <- odes_no_closure_p$Time
fraction.infected_65_p$V1 <- odes_no_closure_p$V14
fraction.infected_65_p$V2 <- odes_closure_p_2w$V14
fraction.infected_65_p$V3 <- odes_closure_p_3w$V14
fraction.infected_65_p$V4 <- odes_closure_p_1m$V14
fraction.infected_65_p$V5 <- odes_closure_p_2m$V14

fraction.infected_65_p <-data.frame(fraction.infected_65_p)

ggplot( data=fraction.infected_65_p ) + geom_line( aes(x=Time, y=V1, colour = "65+ without school closure") ) + 
  geom_line( aes(x=Time, y=V2, colour = "65+ with school closure for 2 weeks") ) + 
geom_line( aes(x=Time, y=V3, colour = "65+ with school closure for 3 weeks") ) + 
  geom_line( aes(x=Time, y=V4, colour = "65+ with school closure for 1 month") ) + geom_line( aes(x=Time, y=V5, colour = "65+ with school closure for 2 months") ) +
  scale_colour_manual("", 
                      breaks = c("65+ without school closure","65+ with school closure for 2 weeks","65+ with school closure for 3 weeks","65+ with school closure for 1 month","65+ with school closure for 2 months"),
                      values = c("red","blue","green3","darkviolet","turquoise3")) +
  ylab( "Number of people infected" )+
  labs(title = "Outbreaks of pandemic flu for age group 65+")

```

We will now calculate the values of this reduction. 

To see if the number of people infected for the whole period has lowered, we need to compare the area under both curves (estimation of total number of people infected during the period). 

```{r}

#Age group <0-2> 

nc_p_area_0_2 <- sum(fraction.infected_0_2_p$V1)
c_p_area_0_2_1w <- sum(fraction.infected_0_2_p$V2)
c_p_area_0_2_2w <- sum(fraction.infected_0_2_p$V3)
c_p_area_0_2_1m <- sum(fraction.infected_0_2_p$V4)
c_p_area_0_2_2m <- sum(fraction.infected_0_2_p$V5)
diff_area_p_0_2_1w <- nc_p_area_0_2 - c_p_area_0_2_1w
diff_area_p_0_2_2w <- nc_p_area_0_2 - c_p_area_0_2_2w
diff_area_p_0_2_1m <- nc_p_area_0_2 - c_p_area_0_2_1m
diff_area_p_0_2_2m <- nc_p_area_0_2 - c_p_area_0_2_2m

#Age group <3-5> 

nc_p_area_3_5 <- sum(fraction.infected_3_5_p$V1)
c_p_area_3_5_1w <- sum(fraction.infected_3_5_p$V2)
c_p_area_3_5_2w <- sum(fraction.infected_3_5_p$V3)
c_p_area_3_5_1m <- sum(fraction.infected_3_5_p$V4)
c_p_area_3_5_2m <- sum(fraction.infected_3_5_p$V5)
diff_area_p_3_5_1w <- nc_p_area_3_5 - c_p_area_3_5_1w
diff_area_p_3_5_2w <- nc_p_area_3_5 - c_p_area_3_5_2w
diff_area_p_3_5_1m <- nc_p_area_3_5 - c_p_area_3_5_1m
diff_area_p_3_5_2m <- nc_p_area_3_5 - c_p_area_3_5_2m

#Age group <6-12> 

nc_p_area_6_12 <- sum(fraction.infected_6_12_p$V1)
c_p_area_6_12_1w <- sum(fraction.infected_6_12_p$V2)
c_p_area_6_12_2w <- sum(fraction.infected_6_12_p$V3)
c_p_area_6_12_1m <- sum(fraction.infected_6_12_p$V4)
c_p_area_6_12_2m <- sum(fraction.infected_6_12_p$V5)
diff_area_p_6_12_1w <- nc_p_area_6_12 - c_p_area_6_12_1w
diff_area_p_6_12_2w <- nc_p_area_6_12 - c_p_area_6_12_2w
diff_area_p_6_12_1m <- nc_p_area_6_12 - c_p_area_6_12_1m
diff_area_p_6_12_2m <- nc_p_area_6_12 - c_p_area_6_12_2m

#Age group <13-16> 

nc_p_area_13_16 <- sum(fraction.infected_13_16_p$V1)
c_p_area_13_16_1w <- sum(fraction.infected_13_16_p$V2)
c_p_area_13_16_2w <- sum(fraction.infected_13_16_p$V3)
c_p_area_13_16_1m <- sum(fraction.infected_13_16_p$V4)
c_p_area_13_16_2m <- sum(fraction.infected_13_16_p$V5)
diff_area_p_13_16_1w <- nc_p_area_13_16 - c_p_area_13_16_1w
diff_area_p_13_16_2w <- nc_p_area_13_16 - c_p_area_13_16_2w
diff_area_p_13_16_1m <- nc_p_area_13_16 - c_p_area_13_16_1m
diff_area_p_13_16_2m <- nc_p_area_13_16 - c_p_area_13_16_2m

#Age group <17-18> 

nc_p_area_17_18 <- sum(fraction.infected_17_18_p$V1)
c_p_area_17_18_1w <- sum(fraction.infected_17_18_p$V2)
c_p_area_17_18_2w <- sum(fraction.infected_17_18_p$V3)
c_p_area_17_18_1m <- sum(fraction.infected_17_18_p$V4)
c_p_area_17_18_2m <- sum(fraction.infected_17_18_p$V5)
diff_area_p_17_18_1w <- nc_p_area_17_18 - c_p_area_17_18_1w
diff_area_p_17_18_2w <- nc_p_area_17_18 - c_p_area_17_18_2w
diff_area_p_17_18_1m <- nc_p_area_17_18 - c_p_area_17_18_1m
diff_area_p_17_18_2m <- nc_p_area_17_18 - c_p_area_17_18_2m

#Age group <19-64> 

nc_p_area_19_64 <- sum(fraction.infected_19_64_p$V1)
c_p_area_19_64_1w <- sum(fraction.infected_19_64_p$V2)
c_p_area_19_64_2w <- sum(fraction.infected_19_64_p$V3)
c_p_area_19_64_1m <- sum(fraction.infected_19_64_p$V4)
c_p_area_19_64_2m <- sum(fraction.infected_19_64_p$V5)
diff_area_p_19_64_1w <- nc_p_area_19_64 - c_p_area_19_64_1w
diff_area_p_19_64_2w <- nc_p_area_19_64 - c_p_area_19_64_2w
diff_area_p_19_64_1m <- nc_p_area_19_64 - c_p_area_19_64_1m
diff_area_p_19_64_2m <- nc_p_area_19_64 - c_p_area_19_64_2m

#Age group <65+> 

nc_p_area_65 <- sum(fraction.infected_65_p$V1)
c_p_area_65_1w <- sum(fraction.infected_65_p$V2)
c_p_area_65_2w <- sum(fraction.infected_65_p$V3)
c_p_area_65_1m <- sum(fraction.infected_65_p$V4)
c_p_area_65_2m <- sum(fraction.infected_65_p$V5)
diff_area_p_65_1w <- nc_p_area_65 - c_p_area_65_1w
diff_area_p_65_2w <- nc_p_area_65 - c_p_area_65_2w
diff_area_p_65_1m <- nc_p_area_65 - c_p_area_65_1m
diff_area_p_65_2m <- nc_p_area_65 - c_p_area_65_2m

#Results in a table 
Total_Reduction_p_results <- data.frame(
  Total_infected_no_school_closure = c(nc_p_area_0_2,nc_p_area_3_5,nc_p_area_6_12,nc_p_area_13_16,nc_p_area_17_18,nc_p_area_19_64,nc_p_area_65),
  Total_infected_school_closure_1_week = c(c_p_area_0_2_1w,c_p_area_3_5_1w,c_p_area_6_12_1w,c_p_area_13_16_1w,c_p_area_17_18_1w,c_p_area_19_64_1w,c_p_area_65_1w),
  Reduction_1_week = c(diff_area_p_0_2_1w,diff_area_p_3_5_1w,diff_area_p_6_12_1w,diff_area_p_13_16_1w,diff_area_p_17_18_1w,diff_area_p_19_64_1w,diff_area_p_65_1w),
  Reduction_percentage_1_week = c(diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_65_1w*100/nc_p_area_65),
  Total_infected_school_closure_2_weeks = c(c_p_area_0_2_2w,c_p_area_3_5_2w,c_p_area_6_12_2w,c_p_area_13_16_2w,c_p_area_17_18_2w,c_p_area_19_64_2w,c_p_area_65_2w),
  Reduction_2_weeks = c(diff_area_p_0_2_2w,diff_area_p_3_5_2w,diff_area_p_6_12_2w,diff_area_p_13_16_2w,diff_area_p_17_18_2w,diff_area_p_19_64_2w,diff_area_p_65_2w),
  Reduction_percentage_2_weeks = c(diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_65_2w*100/nc_p_area_65),
  Total_infected_school_closure_1_month = c(c_p_area_0_2_1m,c_p_area_3_5_1m,c_p_area_6_12_1m,c_p_area_13_16_1m,c_p_area_17_18_1m,c_p_area_19_64_1m,c_p_area_65_1m),
  Reduction_1_month = c(diff_area_p_0_2_1m,diff_area_p_3_5_1m,diff_area_p_6_12_1m,diff_area_p_13_16_1m,diff_area_p_17_18_1m,diff_area_p_19_64_1m,diff_area_p_65_1m),
  Reduction_percentage_1_month = c(diff_area_p_0_2_1m*100/nc_p_area_0_2,diff_area_p_3_5_1m*100/nc_p_area_3_5,diff_area_p_6_12_1m*100/nc_p_area_6_12,diff_area_p_13_16_1m*100/nc_p_area_13_16,diff_area_p_17_18_1m*100/nc_p_area_17_18,diff_area_p_19_64_1m*100/nc_p_area_19_64,diff_area_p_65_1m*100/nc_p_area_65),
  Total_infected_school_closure_2_months = c(c_p_area_0_2_2m,c_p_area_3_5_2m,c_p_area_6_12_2m,c_p_area_13_16_2m,c_p_area_17_18_2m,c_p_area_19_64_2m,c_p_area_65_2m),
  Reduction_2_months = c(diff_area_p_0_2_2m,diff_area_p_3_5_2m,diff_area_p_6_12_2m,diff_area_p_13_16_2m,diff_area_p_17_18_2m,diff_area_p_19_64_2m,diff_area_p_65_2m),
  Reduction_percentage_2_months = c(diff_area_p_0_2_2m*100/nc_p_area_0_2,diff_area_p_3_5_2m*100/nc_p_area_3_5,diff_area_p_6_12_2m*100/nc_p_area_6_12,diff_area_p_13_16_2m*100/nc_p_area_13_16,diff_area_p_17_18_2m*100/nc_p_area_17_18,diff_area_p_19_64_2m*100/nc_p_area_19_64,diff_area_p_65_2m*100/nc_p_area_65),
  row.names = c("0-2","3-5","6-12","13-16","17-18","19-64","65+")
)

pander(Total_Reduction_p_results)

```

If we plot the evolution of the percentage of reduction when we change the beginning of school closure, we obtain the following graphic: 

```{r,fig.width=8,fig.height=8,fig.show='hold'}

#Graphic of evolution of percentage of reduction 

Percentage_reduction_p <- data.frame(
  Date_beginning_closure = c(7,14,30,60),
  Reduction_percentage_0_2 = c(diff_area_p_0_2_1w*100/nc_p_area_0_2,diff_area_p_0_2_2w*100/nc_p_area_0_2,diff_area_p_0_2_1m*100/nc_p_area_0_2,diff_area_p_0_2_2m*100/nc_p_area_0_2),
  Reduction_percentage_3_5 = c(diff_area_p_3_5_1w*100/nc_p_area_3_5,diff_area_p_3_5_2w*100/nc_p_area_3_5,diff_area_p_3_5_1m*100/nc_p_area_3_5,diff_area_p_3_5_2m*100/nc_p_area_3_5),
  Reduction_percentage_6_12 = c(diff_area_p_6_12_1w*100/nc_p_area_6_12,diff_area_p_6_12_2w*100/nc_p_area_6_12,diff_area_p_6_12_1m*100/nc_p_area_6_12,diff_area_p_6_12_2m*100/nc_p_area_6_12),
  Reduction_percentage_13_16 = c(diff_area_p_13_16_1w*100/nc_p_area_13_16,diff_area_p_13_16_2w*100/nc_p_area_13_16,diff_area_p_13_16_1m*100/nc_p_area_13_16,diff_area_p_13_16_2m*100/nc_p_area_13_16),
  Reduction_percentage_17_18 = c(diff_area_p_17_18_1w*100/nc_p_area_17_18,diff_area_p_17_18_2w*100/nc_p_area_17_18,diff_area_p_17_18_1m*100/nc_p_area_17_18,diff_area_p_17_18_2m*100/nc_p_area_17_18),
  Reduction_percentage_19_64 = c(diff_area_p_19_64_1w*100/nc_p_area_19_64,diff_area_p_19_64_2w*100/nc_p_area_19_64,diff_area_p_19_64_1m*100/nc_p_area_19_64,diff_area_p_19_64_2m*100/nc_p_area_19_64),
  Reduction_percentage_65 = c(diff_area_p_65_1w*100/nc_p_area_65,diff_area_p_65_2w*100/nc_p_area_65,diff_area_p_65_1m*100/nc_p_area_65,diff_area_p_65_2m*100/nc_p_area_65),
  row.names = c("3 days","1 week","2 weeks","1 month")
  )

ggplot( data=Percentage_reduction_p ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_0_2, colour = "Age group 0-2") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_3_5, colour = "Age group 3-5") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_6_12, colour = "Age group 6-12") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_13_16, colour = "Age group 13-16") ) +
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) +
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_17_18, colour = "Age group 17-18") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_19_64, colour = "Age group 19-64") ) + 
  geom_point( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  geom_line( aes(x=Date_beginning_closure, y=Reduction_percentage_65, colour = "Age group 65+") ) + 
  scale_colour_manual("", 
                      breaks = c("Age group 0-2" ,"Age group 3-5","Age group 6-12","Age group 13-16","Age group 17-18","Age group 19-64","Age group 65+"),
                      values = c("red","darkred","blue","green3","darkviolet","turquoise4","royalblue","violet")) +
  xlab( "Number of days between beginning of the epidemy and beginning of school closure" )+
  ylab( "Percentage of reduction" )+
  labs(title = "Variation of percentage of reduction of different age groups with the beginning of school closure")

```

We can see with these figures that school closure must be realised as quickly as possible as it becomes rapidly inefficient. Indeed, for a majority of age groups, a school closure 2 weeks after the beginning of the epidemy will only reduce the number of people affected by 1% and a school closure after a month is completely ineficient. 

We can conclude that the best beginning date for school closure is right after the beginning of the epidemy. However, this measure demands time to be put in place and one week after the beginning of the epidemy will probably be the fastest school closure possible. 


#  Verification of the pertinence of the model for the contact matrix 

```{r}

#Comparison for age group <0-2> 

poly_0_2_school <- polymod_uk_school[!(polymod_uk_school$V1>3),]
poly_0_2_hol <- polymod_uk_holiday[!(polymod_uk_holiday$V1>3),]
tot_0_2_school <- sum(rowSums(poly_0_2_school[,3:9]))
tot_0_2_hol <- sum(rowSums(poly_0_2_hol[,3:9]))
reduc_0_2 <- (tot_0_2_school-tot_0_2_hol)*100/tot_0_2_school

#Comparison for age group <3-5> 

poly_3_5_school <- polymod_uk_school[(!(polymod_uk_school$V1<3) & ! (polymod_uk_school$V1>5)),]
poly_3_5_hol <- polymod_uk_holiday[(!(polymod_uk_holiday$V1<3) & ! (polymod_uk_holiday$V1>5)),]
tot_3_5_school <- sum(rowSums(poly_3_5_school[,3:9]))
tot_3_5_hol <- sum(rowSums(poly_3_5_hol[,3:9]))
reduc_3_5 <- (tot_3_5_school-tot_3_5_hol)*100/tot_3_5_school

#Comparison for age group <6-12> 

poly_6_12_school <- polymod_uk_school[(!(polymod_uk_school$V1<6) & ! (polymod_uk_school$V1>12)),]
poly_6_12_hol <- polymod_uk_holiday[(!(polymod_uk_holiday$V1<6) & ! (polymod_uk_holiday$V1>12)),]
tot_6_12_school <- sum(rowSums(poly_6_12_school[,3:9]))
tot_6_12_hol <- sum(rowSums(poly_6_12_hol[,3:9]))
reduc_6_12 <- (tot_6_12_school-tot_6_12_hol)*100/tot_6_12_school

#Comparison for age group <13-16>

poly_13_16_school <- polymod_uk_school[(!(polymod_uk_school$V1<13) & ! (polymod_uk_school$V1>16)),]
poly_13_16_hol <- polymod_uk_holiday[(!(polymod_uk_holiday$V1<13) & ! (polymod_uk_holiday$V1>16)),]
tot_13_16_school <- sum(rowSums(poly_13_16_school[,3:9]))
tot_13_16_hol <- sum(rowSums(poly_13_16_hol[,3:9]))
reduc_13_16 <- (tot_13_16_school-tot_13_16_hol)*100/tot_13_16_school

#Comparison for age group <17-18>

poly_17_18_school <- polymod_uk_school[(!(polymod_uk_school$V1<17) & ! (polymod_uk_school$V1>18)),]
poly_17_18_hol <- polymod_uk_holiday[(!(polymod_uk_holiday$V1<17) & ! (polymod_uk_holiday$V1>18)),]
tot_17_18_school <- sum(rowSums(poly_17_18_school[,3:9]))
tot_17_18_hol <- sum(rowSums(poly_17_18_hol[,3:9]))
reduc_17_18 <- (tot_17_18_school-tot_17_18_hol)*100/tot_17_18_school

#Comparison for age group 19-64 

poly_19_64_school <- polymod_uk_school[(!(polymod_uk_school$V1<19) & ! (polymod_uk_school$V1>64)),]
poly_19_64_hol <- polymod_uk_holiday[(!(polymod_uk_holiday$V1<19) & ! (polymod_uk_holiday$V1>64)),]
tot_19_64_school <- sum(rowSums(poly_19_64_school[,3:9]))
tot_19_64_hol <- sum(rowSums(poly_19_64_hol[,3:9]))
reduc_19_64 <- (tot_19_64_school-tot_19_64_hol)*100/tot_19_64_school

#Comparison for age group <65+>  

poly_65_school <- polymod_uk_school[!(polymod_uk_school$V1<65),]
poly_65_hol <- polymod_uk_holiday[!(polymod_uk_holiday$V1<65),]
tot_65_school <- sum(rowSums(poly_65_school[,3:9]))
tot_65_hol <- sum(rowSums(poly_65_hol[,3:9]))
reduc_65 <- (tot_65_school-tot_65_hol)*100/tot_65_school

#Results of the comparison 

Reduc_results <- data.frame(
  Age_group_0_2 = c(tot_0_2_school,tot_0_2_hol,reduc_0_2),
  Age_group_3_5 = c(tot_3_5_school,tot_3_5_hol,reduc_3_5),
  Age_group_6_12 = c(tot_6_12_school,tot_6_12_hol,reduc_6_12),
  Age_group_13_16 = c(tot_13_16_school,tot_13_16_hol,reduc_13_16),
  Age_group_17_18 = c(tot_17_18_school,tot_17_18_hol,reduc_17_18),
  Age_group_19_64 = c(tot_19_64_school,tot_19_64_hol,reduc_19_64),
  Age_group_65 = c(tot_65_school,tot_65_hol,reduc_65),
  row.names = c("Non-holiday contacts","Holiday contacts", "Percentage of reduction of contacts during the holidays")
)

pander(Reduc_results)

```


